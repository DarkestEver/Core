{"version":3,"sources":["../../src/Extensions/extensions-index.js"],"names":["extensionsTable","initialize","$","each","attr","globalRootUrl","DataTable","lengthChange","paging","columns","orderable","searchable","order","language","SemanticLocalization","dataTableLocalisation","appendTo","on","e","id","target","closest","window","location","clipboard","ClipboardJS","popup","trigger","setTimeout","clearSelection","console","error","action","checkbox","onChecked","number","api","url","onSuccess","response","success","removeClass","onUnchecked","addClass","extensionsStatusLoopWorker","timeOut","timeOutHandle","green","grey","DebuggerInfo","restartWorker","clearTimeout","timeoutHandle","worker","PbxApi","GetPeersStatus","cbRefreshExtensionsStatus","length","htmlTable","key","value","state","UpdateContent","index","obj","result","grep","find","html","toUpperCase","document","ready"],"mappings":"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","sourcesContent":["/*\n * Copyright (C) MIKO LLC - All Rights Reserved\n * Unauthorized copying of this file, via any medium is strictly prohibited\n * Proprietary and confidential\n * Written by Nikolay Beketov, 5 2018\n *\n */\n\n/* global globalRootUrl, ClipboardJS, PbxApi, SemanticLocalization, DebuggerInfo */\n\nconst extensionsTable = {\n\tinitialize() {\n\t\t$('.avatar').each(function () {\n\t\t\tif ($(this).attr('src') === '') {\n\t\t\t\t$(this).attr('src', `${globalRootUrl}public/img/unknownPerson.jpg`);\n\t\t\t}\n\t\t});\n\n\t\t$('#extensions-table').DataTable({\n\t\t\tlengthChange: false,\n\t\t\tpaging: false,\n\t\t\tcolumns: [\n\t\t\t\t{orderable: false, searchable: false},\n\t\t\t\tnull,\n\t\t\t\tnull,\n\t\t\t\tnull,\n\t\t\t\tnull,\n\t\t\t\t// { orderable: false, searchable: false },\n\t\t\t\t{orderable: false, searchable: false},\n\t\t\t],\n\t\t\torder: [1, 'asc'],\n\t\t\tlanguage: SemanticLocalization.dataTableLocalisation,\n\t\t});\n\n\t\t$('#add-new-button').appendTo($('div.eight.column:eq(0)'));\n\n\t\t$('.extension-row td').on('dblclick', (e) => {\n\t\t\tconst id = $(e.target).closest('tr').attr('id');\n\t\t\twindow.location = `${globalRootUrl}extensions/modify/${id}`;\n\t\t});\n\t\tconst clipboard = new ClipboardJS('.clipboard');\n\t\t$('.clipboard').popup({\n\t\t\ton: 'manual',\n\t\t});\n\t\tclipboard.on('success', (e) => {\n\t\t\t$(e.trigger).popup('show');\n\t\t\tsetTimeout(() => {\n\t\t\t\t$(e.trigger).popup('hide');\n\t\t\t}, 1500);\n\t\t\te.clearSelection();\n\t\t});\n\n\t\tclipboard.on('error', (e) => {\n\t\t\tconsole.error('Action:', e.action);\n\t\t\tconsole.error('Trigger:', e.trigger);\n\t\t});\n\t\t$('.extension-row .checkbox')\n\t\t\t.checkbox({\n\t\t\t\tonChecked() {\n\t\t\t\t\tconst number = $(this).attr('data-value');\n\t\t\t\t\t$.api({\n\t\t\t\t\t\turl: `${globalRootUrl}extensions/enable/${number}`,\n\t\t\t\t\t\ton: 'now',\n\t\t\t\t\t\tonSuccess(response) {\n\t\t\t\t\t\t\tif (response.success) {\n\t\t\t\t\t\t\t\t$(`#${number} .disability`).removeClass('disabled');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tonUnchecked() {\n\t\t\t\t\tconst number = $(this).attr('data-value');\n\t\t\t\t\t$.api({\n\t\t\t\t\t\turl: `${globalRootUrl}extensions/disable/${number}`,\n\t\t\t\t\t\ton: 'now',\n\t\t\t\t\t\tonSuccess(response) {\n\t\t\t\t\t\t\tif (response.success) {\n\t\t\t\t\t\t\t\t$(`#${number} .disability`).addClass('disabled');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t});\n\t},\n\n};\n\n\nconst extensionsStatusLoopWorker = {\n\ttimeOut: 3000,\n\ttimeOutHandle: '',\n\tgreen: '<div class=\"ui green empty circular label\" style=\"width: 1px;height: 1px;\"></div>',\n\tgrey: '<div class=\"ui grey empty circular label\" style=\"width: 1px;height: 1px;\"></div>',\n\tinitialize() {\n\t\t// Запустим обновление статуса провайдера\n\t\tDebuggerInfo.initialize();\n\t\textensionsStatusLoopWorker.restartWorker();\n\t},\n\trestartWorker() {\n\t\twindow.clearTimeout(extensionsStatusLoopWorker.timeoutHandle);\n\t\textensionsStatusLoopWorker.worker();\n\t},\n\tworker() {\n\t\twindow.clearTimeout(extensionsStatusLoopWorker.timeoutHandle);\n\t\tPbxApi.GetPeersStatus(extensionsStatusLoopWorker.cbRefreshExtensionsStatus);\n\t},\n\tcbRefreshExtensionsStatus(response) {\n\t\textensionsStatusLoopWorker.timeoutHandle =\n\t\t\twindow.setTimeout(extensionsStatusLoopWorker.worker, extensionsStatusLoopWorker.timeOut);\n\t\tif (response.length === 0 || response === false) return;\n\t\tlet htmlTable = '<table class=\"ui very compact table\">';\n\t\t$.each(response, (key, value) => {\n\t\t\thtmlTable += '<tr>';\n\t\t\thtmlTable += `<td>${value.id}</td>`;\n\t\t\thtmlTable += `<td>${value.state}</td>`;\n\t\t\thtmlTable += '</tr>';\n\t\t});\n\t\thtmlTable += '</table>';\n\t\tDebuggerInfo.UpdateContent(htmlTable);\n\t\t$('.extension-row').each((index, obj) => {\n\t\t\tconst number = $(obj).attr('data-value');\n\t\t\tconst result = $.grep(response, e => e.id === number);\n\t\t\tif (result.length === 0) {\n\t\t\t\t// not found\n\t\t\t\t$(obj).find('.extension-status').html(extensionsStatusLoopWorker.grey);\n\t\t\t} else if (result[0].state.toUpperCase() === 'OK') {\n\t\t\t\t$(obj).find('.extension-status').html(extensionsStatusLoopWorker.green);\n\t\t\t} else {\n\t\t\t\t$(obj).find('.extension-status').html(extensionsStatusLoopWorker.grey);\n\t\t\t}\n\t\t});\n\t},\n};\n\n\n$(document).ready(() => {\n\textensionsTable.initialize();\n\textensionsStatusLoopWorker.initialize();\n});\n\n"],"file":"extensions-index.js"}