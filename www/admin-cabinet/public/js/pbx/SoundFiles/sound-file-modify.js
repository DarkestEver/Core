"use strict";

/*
 * Copyright (C) MIKO LLC - All Rights Reserved
 * Unauthorized copying of this file, via any medium is strictly prohibited
 * Proprietary and confidential
 * Written by Nikolay Beketov, 12 2019
 *
 */

/* global globalRootUrl,globalTranslate, MediaStreamRecorder, StereoAudioRecorder, Form, PbxApi */
var sndPlayer = {
  slider: document.getElementById('audio-player'),
  duration: 0,
  // Duration of audio clip
  $pButton: $('#play-button'),
  // play button
  $slider: $('#play-slider'),
  $playerSegment: $('#audio-player-segment'),
  initialize: function () {
    function initialize() {
      // play button event listenter
      sndPlayer.$pButton.on('click', function (e) {
        e.preventDefault();
        sndPlayer.play();
      }); // timeupdate event listener

      sndPlayer.slider.addEventListener('timeupdate', sndPlayer.cbTimeUpdate, false); // Gets audio file duration

      sndPlayer.slider.addEventListener('canplaythrough', sndPlayer.cbCanPlayThrough, false);
      sndPlayer.$slider.range({
        min: 0,
        max: 100,
        start: 0,
        onChange: sndPlayer.cbOnSliderChange
      });
    }

    return initialize;
  }(),
  UpdateSource: function () {
    function UpdateSource(newSource) {
      sndPlayer.slider.getElementsByTagName('source')[0].src = newSource;
      sndPlayer.slider.pause();
      sndPlayer.slider.load();
      sndPlayer.slider.oncanplaythrough = sndPlayer.cbCanPlayThrough;
    }

    return UpdateSource;
  }(),
  cbCanPlayThrough: function () {
    function cbCanPlayThrough() {
      sndPlayer.duration = sndPlayer.slider.duration;
      console.log("New duration ".concat(sndPlayer.slider.readyState));

      if (sndPlayer.duration > 0) {
        sndPlayer.$slider.range('set value', 0);
        sndPlayer.$playerSegment.show();
      } else {
        sndPlayer.$playerSegment.hide();
      }
    }

    return cbCanPlayThrough;
  }(),
  cbOnSliderChange: function () {
    function cbOnSliderChange(newVal, meta) {
      if (meta.triggeredByUser && Number.isFinite(sndPlayer.slider.duration)) {
        sndPlayer.slider.removeEventListener('timeupdate', sndPlayer.cbTimeUpdate, false);
        sndPlayer.slider.currentTime = sndPlayer.slider.duration * newVal / 100;
        sndPlayer.slider.addEventListener('timeupdate', sndPlayer.cbTimeUpdate, false);
      }
    }

    return cbOnSliderChange;
  }(),
  // timeUpdate
  // Synchronizes playhead position with current point in audio
  cbTimeUpdate: function () {
    function cbTimeUpdate() {
      if (Number.isFinite(sndPlayer.slider.duration)) {
        var percent = sndPlayer.slider.currentTime / sndPlayer.slider.duration;
        var rangePosition = Math.round(percent * 100);
        sndPlayer.$slider.range('set value', rangePosition);

        if (sndPlayer.slider.currentTime === sndPlayer.duration) {
          sndPlayer.$pButton.html('<i class="icon play"></i>');
        }
      }
    }

    return cbTimeUpdate;
  }(),
  // Play and Pause
  play: function () {
    function play() {
      // start music
      if (sndPlayer.slider.paused && sndPlayer.slider.duration) {
        sndPlayer.slider.play(); // remove play, add pause

        sndPlayer.$pButton.html('<i class="icon pause"></i>');
      } else {
        // pause music
        sndPlayer.slider.pause(); // remove pause, add play

        sndPlayer.$pButton.html('<i class="icon play"></i>');
      }
    }

    return play;
  }()
};
var soundFileModify = {
  trashBin: [],
  $soundUploadButton: $('#upload-sound-file'),
  $soundFileInput: $('#file'),
  $soundFileName: $('#name'),
  $audioPlayer: $('#audio-player'),
  $submitButton: $('#submitbutton'),
  blob: window.URL || window.webkitURL,
  $formObj: $('#sound-file-form'),
  validateRules: {
    description: {
      identifier: 'name',
      rules: [{
        type: 'empty',
        prompt: globalTranslate.sf_ValidationFileNameIsEmpty
      }]
    },
    path: {
      identifier: 'path',
      rules: [{
        type: 'empty',
        prompt: globalTranslate.sf_ValidationFileNotSelected
      }]
    }
  },
  initialize: function () {
    function initialize() {
      $('.category-select').dropdown();
      soundFileModify.initializeForm();
      soundFileModify.$soundUploadButton.on('click', function (e) {
        e.preventDefault();
        $('input:file', $(e.target).parents()).click();
      });
      soundFileModify.$soundFileInput.on('change', function (e) {
        var file = e.target.files[0];
        if (file === undefined) return;
        soundFileModify.$soundFileName.val(file.name.replace(/\.[^/.]+$/, ''));
        soundFileModify.blob = window.URL || window.webkitURL;
        var fileURL = soundFileModify.blob.createObjectURL(file);
        sndPlayer.UpdateSource(fileURL);
        soundFileModify.$formObj.addClass('loading');
        PbxApi.SystemUploadAudioFile(file, soundFileModify.cbAfterUploadFile);
      });

      if (window.location.protocol !== 'https:' && window.location.hostname !== 'localhost') {
        $('#only-https-field').addClass('disabled');
      }

      if (window.navigator.userAgent.indexOf('MSIE ') > 0) {
        $('#only-https-field').addClass('disabled');
      }
    }

    return initialize;
  }(),
  cbAfterUploadFile: function () {
    function cbAfterUploadFile(filename) {
      soundFileModify.trashBin.push(soundFileModify.$formObj.form('get value', 'path'));
      soundFileModify.$formObj.form('set value', 'path', filename);
      soundFileModify.$soundFileName.trigger('change');
      sndPlayer.UpdateSource("/pbxcore/api/cdr/playback?view=".concat(filename));
      soundFileModify.$submitButton.removeClass('loading');
      soundFileModify.$formObj.removeClass('loading');
    }

    return cbAfterUploadFile;
  }(),
  cbBeforeSendForm: function () {
    function cbBeforeSendForm(settings) {
      var result = settings;
      result.data = soundFileModify.$formObj.form('get values');
      return result;
    }

    return cbBeforeSendForm;
  }(),
  cbAfterSendForm: function () {
    function cbAfterSendForm() {
      soundFileModify.trashBin.forEach(function (filepath) {
        if (filepath) PbxApi.SystemRemoveAudioFile(filepath);
      });
    }

    return cbAfterSendForm;
  }(),
  initializeForm: function () {
    function initializeForm() {
      Form.$formObj = soundFileModify.$formObj;
      Form.url = "".concat(globalRootUrl, "sound-files/save");
      Form.validateRules = soundFileModify.validateRules;
      Form.cbBeforeSendForm = soundFileModify.cbBeforeSendForm;
      Form.cbAfterSendForm = soundFileModify.cbAfterSendForm;
      Form.initialize();
    }

    return initializeForm;
  }()
};
var webkitRecorder = {
  $recordLabel: $('#record-label'),
  $recordButton: $('#start-record-button'),
  $stopButton: $('#stop-record-button'),
  $selectAudioInput: $('#select-audio-button'),
  $audioPlayer: $('#audio-player'),
  audioInputMenu: document.getElementById('audio-input-select'),
  chunks: [],
  mediaRecorder: '',
  initialize: function () {
    function initialize() {
      webkitRecorder.$stopButton.addClass('disabled');
      webkitRecorder.$recordButton.on('click', function (e) {
        e.preventDefault();
        webkitRecorder.chunks = [];
        var constraints = {
          audio: true
        };

        if (webkitRecorder.audioInputMenu.getElementsByClassName('selected').length > 0) {
          var audioSource = webkitRecorder.audioInputMenu.getElementsByClassName('selected')[0].id;
          constraints = {
            audio: {
              deviceId: audioSource ? {
                exact: audioSource
              } : undefined
            }
          };
        }

        console.log(constraints);
        webkitRecorder.captureUserMedia(constraints, webkitRecorder.cbOnSuccess, webkitRecorder.gotDevices, webkitRecorder.onError);
      });
      webkitRecorder.$stopButton.on('click', function (e) {
        e.preventDefault();
        webkitRecorder.mediaRecorder.stop();
      });
      webkitRecorder.$selectAudioInput.dropdown();
    }

    return initialize;
  }(),
  captureUserMedia: function () {
    function captureUserMedia(mediaConstraints, successCallback, gotDevicesCallBack, errorCallback) {
      navigator.mediaDevices.getUserMedia(mediaConstraints).then(successCallback).then(gotDevicesCallBack)["catch"](errorCallback);
    }

    return captureUserMedia;
  }(),
  gotDevices: function () {
    function gotDevices(deviceInfos) {
      if (webkitRecorder.audioInputMenu.getElementsByTagName('div').length > 0) return;

      for (var i = 0; i !== deviceInfos.length; i += 1) {
        var deviceInfo = deviceInfos[i];
        var option = document.createElement('div');
        option.className = 'item';
        option.id = deviceInfo.deviceId;

        if (deviceInfo.kind === 'audioinput') {
          option.innerHTML = deviceInfo.label || "microphone ".concat(webkitRecorder.audioInputMenu.length + 1);
          webkitRecorder.audioInputMenu.appendChild(option);
        }
      }

      if (webkitRecorder.audioInputMenu.getElementsByTagName('div').length > 0) {
        webkitRecorder.$selectAudioInput.removeClass('disabled');
      }
    }

    return gotDevices;
  }(),
  cbOnSuccess: function () {
    function cbOnSuccess(stream) {
      try {
        webkitRecorder.mediaRecorder = new MediaStreamRecorder(stream);
        webkitRecorder.mediaRecorder.stream = stream;
        webkitRecorder.mediaRecorder.recorderType = StereoAudioRecorder;
        webkitRecorder.mediaRecorder.mimeType = 'audio/wav';
        webkitRecorder.mediaRecorder.audioChannels = 1; // webkitRecorder.mediaRecorder = new MediaRecorder(stream);

        webkitRecorder.mediaRecorder.onstop = webkitRecorder.cbOnStopMediaRecorder;
        webkitRecorder.mediaRecorder.ondataavailable = webkitRecorder.cbOnDataAvailable;
        webkitRecorder.mediaRecorder.start(300000);
        console.log('recorder started');
        webkitRecorder.$recordLabel.addClass('red');
        webkitRecorder.$stopButton.removeClass('disabled');
        webkitRecorder.$recordButton.addClass('disabled');
        return navigator.mediaDevices.enumerateDevices();
      } catch (e) {
        console.error('MediaStreamRecorder is not supported by this browser.\n\n' + 'Try Firefox 29 or later, or Chrome 47 or later, with Enable experimental Web Platform features enabled from chrome://flags.');
        console.error('Exception while creating MediaRecorder:', e);
        webkitRecorder.$recordButton.addClass('disabled');
      }

      return false;
    }

    return cbOnSuccess;
  }(),
  cbOnError: function () {
    function cbOnError(err) {
      console.log("The following error occured: ".concat(err));
    }

    return cbOnError;
  }(),
  cbOnStopMediaRecorder: function () {
    function cbOnStopMediaRecorder() {
      console.log('data available after MediaStreamRecorder.stop() called.');
      soundFileModify.blob = new Blob(webkitRecorder.chunks);
      console.log('recorder stopped');
      var fileURL = URL.createObjectURL(soundFileModify.blob);
      sndPlayer.UpdateSource(fileURL);
      var blobFile = new File([webkitRecorder.chunks[0]], 'blob');
      PbxApi.SystemUploadAudioFile(blobFile, soundFileModify.cbAfterUploadFile);
      webkitRecorder.$recordLabel.removeClass('red');
      webkitRecorder.$stopButton.addClass('disabled');
      webkitRecorder.$recordButton.removeClass('disabled');
      soundFileModify.$soundFileInput.val('');
    }

    return cbOnStopMediaRecorder;
  }(),
  cbOnDataAvailable: function () {
    function cbOnDataAvailable(e) {
      webkitRecorder.chunks.push(e);
    }

    return cbOnDataAvailable;
  }()
};
$(document).ready(function () {
  sndPlayer.initialize();
  soundFileModify.initialize();
  webkitRecorder.initialize();
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9Tb3VuZEZpbGVzL3NvdW5kLWZpbGUtbW9kaWZ5LmpzIl0sIm5hbWVzIjpbInNuZFBsYXllciIsInNsaWRlciIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJkdXJhdGlvbiIsIiRwQnV0dG9uIiwiJCIsIiRzbGlkZXIiLCIkcGxheWVyU2VnbWVudCIsImluaXRpYWxpemUiLCJvbiIsImUiLCJwcmV2ZW50RGVmYXVsdCIsInBsYXkiLCJhZGRFdmVudExpc3RlbmVyIiwiY2JUaW1lVXBkYXRlIiwiY2JDYW5QbGF5VGhyb3VnaCIsInJhbmdlIiwibWluIiwibWF4Iiwic3RhcnQiLCJvbkNoYW5nZSIsImNiT25TbGlkZXJDaGFuZ2UiLCJVcGRhdGVTb3VyY2UiLCJuZXdTb3VyY2UiLCJnZXRFbGVtZW50c0J5VGFnTmFtZSIsInNyYyIsInBhdXNlIiwibG9hZCIsIm9uY2FucGxheXRocm91Z2giLCJjb25zb2xlIiwibG9nIiwicmVhZHlTdGF0ZSIsInNob3ciLCJoaWRlIiwibmV3VmFsIiwibWV0YSIsInRyaWdnZXJlZEJ5VXNlciIsIk51bWJlciIsImlzRmluaXRlIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsImN1cnJlbnRUaW1lIiwicGVyY2VudCIsInJhbmdlUG9zaXRpb24iLCJNYXRoIiwicm91bmQiLCJodG1sIiwicGF1c2VkIiwic291bmRGaWxlTW9kaWZ5IiwidHJhc2hCaW4iLCIkc291bmRVcGxvYWRCdXR0b24iLCIkc291bmRGaWxlSW5wdXQiLCIkc291bmRGaWxlTmFtZSIsIiRhdWRpb1BsYXllciIsIiRzdWJtaXRCdXR0b24iLCJibG9iIiwid2luZG93IiwiVVJMIiwid2Via2l0VVJMIiwiJGZvcm1PYmoiLCJ2YWxpZGF0ZVJ1bGVzIiwiZGVzY3JpcHRpb24iLCJpZGVudGlmaWVyIiwicnVsZXMiLCJ0eXBlIiwicHJvbXB0IiwiZ2xvYmFsVHJhbnNsYXRlIiwic2ZfVmFsaWRhdGlvbkZpbGVOYW1lSXNFbXB0eSIsInBhdGgiLCJzZl9WYWxpZGF0aW9uRmlsZU5vdFNlbGVjdGVkIiwiZHJvcGRvd24iLCJpbml0aWFsaXplRm9ybSIsInRhcmdldCIsInBhcmVudHMiLCJjbGljayIsImZpbGUiLCJmaWxlcyIsInVuZGVmaW5lZCIsInZhbCIsIm5hbWUiLCJyZXBsYWNlIiwiZmlsZVVSTCIsImNyZWF0ZU9iamVjdFVSTCIsImFkZENsYXNzIiwiUGJ4QXBpIiwiU3lzdGVtVXBsb2FkQXVkaW9GaWxlIiwiY2JBZnRlclVwbG9hZEZpbGUiLCJsb2NhdGlvbiIsInByb3RvY29sIiwiaG9zdG5hbWUiLCJuYXZpZ2F0b3IiLCJ1c2VyQWdlbnQiLCJpbmRleE9mIiwiZmlsZW5hbWUiLCJwdXNoIiwiZm9ybSIsInRyaWdnZXIiLCJyZW1vdmVDbGFzcyIsImNiQmVmb3JlU2VuZEZvcm0iLCJzZXR0aW5ncyIsInJlc3VsdCIsImRhdGEiLCJjYkFmdGVyU2VuZEZvcm0iLCJmb3JFYWNoIiwiZmlsZXBhdGgiLCJTeXN0ZW1SZW1vdmVBdWRpb0ZpbGUiLCJGb3JtIiwidXJsIiwiZ2xvYmFsUm9vdFVybCIsIndlYmtpdFJlY29yZGVyIiwiJHJlY29yZExhYmVsIiwiJHJlY29yZEJ1dHRvbiIsIiRzdG9wQnV0dG9uIiwiJHNlbGVjdEF1ZGlvSW5wdXQiLCJhdWRpb0lucHV0TWVudSIsImNodW5rcyIsIm1lZGlhUmVjb3JkZXIiLCJjb25zdHJhaW50cyIsImF1ZGlvIiwiZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSIsImxlbmd0aCIsImF1ZGlvU291cmNlIiwiaWQiLCJkZXZpY2VJZCIsImV4YWN0IiwiY2FwdHVyZVVzZXJNZWRpYSIsImNiT25TdWNjZXNzIiwiZ290RGV2aWNlcyIsIm9uRXJyb3IiLCJzdG9wIiwibWVkaWFDb25zdHJhaW50cyIsInN1Y2Nlc3NDYWxsYmFjayIsImdvdERldmljZXNDYWxsQmFjayIsImVycm9yQ2FsbGJhY2siLCJtZWRpYURldmljZXMiLCJnZXRVc2VyTWVkaWEiLCJ0aGVuIiwiZGV2aWNlSW5mb3MiLCJpIiwiZGV2aWNlSW5mbyIsIm9wdGlvbiIsImNyZWF0ZUVsZW1lbnQiLCJjbGFzc05hbWUiLCJraW5kIiwiaW5uZXJIVE1MIiwibGFiZWwiLCJhcHBlbmRDaGlsZCIsInN0cmVhbSIsIk1lZGlhU3RyZWFtUmVjb3JkZXIiLCJyZWNvcmRlclR5cGUiLCJTdGVyZW9BdWRpb1JlY29yZGVyIiwibWltZVR5cGUiLCJhdWRpb0NoYW5uZWxzIiwib25zdG9wIiwiY2JPblN0b3BNZWRpYVJlY29yZGVyIiwib25kYXRhYXZhaWxhYmxlIiwiY2JPbkRhdGFBdmFpbGFibGUiLCJlbnVtZXJhdGVEZXZpY2VzIiwiZXJyb3IiLCJjYk9uRXJyb3IiLCJlcnIiLCJCbG9iIiwiYmxvYkZpbGUiLCJGaWxlIiwicmVhZHkiXSwibWFwcGluZ3MiOiI7O0FBQUE7Ozs7Ozs7O0FBUUE7QUFFQSxJQUFNQSxTQUFTLEdBQUc7QUFDakJDLEVBQUFBLE1BQU0sRUFBRUMsUUFBUSxDQUFDQyxjQUFULENBQXdCLGNBQXhCLENBRFM7QUFFakJDLEVBQUFBLFFBQVEsRUFBRSxDQUZPO0FBRUo7QUFDYkMsRUFBQUEsUUFBUSxFQUFFQyxDQUFDLENBQUMsY0FBRCxDQUhNO0FBR1k7QUFDN0JDLEVBQUFBLE9BQU8sRUFBRUQsQ0FBQyxDQUFDLGNBQUQsQ0FKTztBQUtqQkUsRUFBQUEsY0FBYyxFQUFFRixDQUFDLENBQUMsdUJBQUQsQ0FMQTtBQU1qQkcsRUFBQUEsVUFOaUI7QUFBQSwwQkFNSjtBQUNaO0FBQ0FULE1BQUFBLFNBQVMsQ0FBQ0ssUUFBVixDQUFtQkssRUFBbkIsQ0FBc0IsT0FBdEIsRUFBK0IsVUFBQ0MsQ0FBRCxFQUFPO0FBQ3JDQSxRQUFBQSxDQUFDLENBQUNDLGNBQUY7QUFDQVosUUFBQUEsU0FBUyxDQUFDYSxJQUFWO0FBQ0EsT0FIRCxFQUZZLENBTVo7O0FBQ0FiLE1BQUFBLFNBQVMsQ0FBQ0MsTUFBVixDQUFpQmEsZ0JBQWpCLENBQWtDLFlBQWxDLEVBQWdEZCxTQUFTLENBQUNlLFlBQTFELEVBQXdFLEtBQXhFLEVBUFksQ0FTWjs7QUFD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LGlCQXhHc0I7QUFBQSwrQkF3R0pqSixDQXhHSSxFQXdHRDtBQUNwQmtHLE1BQUFBLGNBQWMsQ0FBQ00sTUFBZixDQUFzQnJCLElBQXRCLENBQTJCbkYsQ0FBM0I7QUFDQTs7QUExR3FCO0FBQUE7QUFBQSxDQUF2QjtBQThHQUwsQ0FBQyxDQUFDSixRQUFELENBQUQsQ0FBWWtLLEtBQVosQ0FBa0IsWUFBTTtBQUN2QnBLLEVBQUFBLFNBQVMsQ0FBQ1MsVUFBVjtBQUNBdUMsRUFBQUEsZUFBZSxDQUFDdkMsVUFBaEI7QUFDQW9HLEVBQUFBLGNBQWMsQ0FBQ3BHLFVBQWY7QUFDQSxDQUpEIiwic291cmNlc0NvbnRlbnQiOlsiLypcbiAqIENvcHlyaWdodCAoQykgTUlLTyBMTEMgLSBBbGwgUmlnaHRzIFJlc2VydmVkXG4gKiBVbmF1dGhvcml6ZWQgY29weWluZyBvZiB0aGlzIGZpbGUsIHZpYSBhbnkgbWVkaXVtIGlzIHN0cmljdGx5IHByb2hpYml0ZWRcbiAqIFByb3ByaWV0YXJ5IGFuZCBjb25maWRlbnRpYWxcbiAqIFdyaXR0ZW4gYnkgTmlrb2xheSBCZWtldG92LCAxMiAyMDE5XG4gKlxuICovXG5cbi8qIGdsb2JhbCBnbG9iYWxSb290VXJsLGdsb2JhbFRyYW5zbGF0ZSwgTWVkaWFTdHJlYW1SZWNvcmRlciwgU3RlcmVvQXVkaW9SZWNvcmRlciwgRm9ybSwgUGJ4QXBpICovXG5cbmNvbnN0IHNuZFBsYXllciA9IHtcblx0c2xpZGVyOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYXVkaW8tcGxheWVyJyksXG5cdGR1cmF0aW9uOiAwLCAvLyBEdXJhdGlvbiBvZiBhdWRpbyBjbGlwXG5cdCRwQnV0dG9uOiAkKCcjcGxheS1idXR0b24nKSwgLy8gcGxheSBidXR0b25cblx0JHNsaWRlcjogJCgnI3BsYXktc2xpZGVyJyksXG5cdCRwbGF5ZXJTZWdtZW50OiAkKCcjYXVkaW8tcGxheWVyLXNlZ21lbnQnKSxcblx0aW5pdGlhbGl6ZSgpIHtcblx0XHQvLyBwbGF5IGJ1dHRvbiBldmVudCBsaXN0ZW50ZXJcblx0XHRzbmRQbGF5ZXIuJHBCdXR0b24ub24oJ2NsaWNrJywgKGUpID0+IHtcblx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdHNuZFBsYXllci5wbGF5KCk7XG5cdFx0fSk7XG5cdFx0Ly8gdGltZXVwZGF0ZSBldmVudCBsaXN0ZW5lclxuXHRcdHNuZFBsYXllci5zbGlkZXIuYWRkRXZlbnRMaXN0ZW5lcigndGltZXVwZGF0ZScsIHNuZFBsYXllci5jYlRpbWVVcGRhdGUsIGZhbHNlKTtcblxuXHRcdC8vIEdldHMgYXVkaW8gZmlsZSBkdXJhdGlvblxuXHRcdHNuZFBsYXllci5zbGlkZXIuYWRkRXZlbnRMaXN0ZW5lcignY2FucGxheXRocm91Z2gnLCBzbmRQbGF5ZXIuY2JDYW5QbGF5VGhyb3VnaCwgZmFsc2UpO1xuXG5cdFx0c25kUGxheWVyLiRzbGlkZXIucmFuZ2Uoe1xuXHRcdFx0bWluOiAwLFxuXHRcdFx0bWF4OiAxMDAsXG5cdFx0XHRzdGFydDogMCxcblx0XHRcdG9uQ2hhbmdlOiBzbmRQbGF5ZXIuY2JPblNsaWRlckNoYW5nZSxcblx0XHR9KTtcblx0fSxcblx0VXBkYXRlU291cmNlKG5ld1NvdXJjZSkge1xuXHRcdHNuZFBsYXllci5zbGlkZXIuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3NvdXJjZScpWzBdLnNyYyA9IG5ld1NvdXJjZTtcblx0XHRzbmRQbGF5ZXIuc2xpZGVyLnBhdXNlKCk7XG5cdFx0c25kUGxheWVyLnNsaWRlci5sb2FkKCk7XG5cdFx0c25kUGxheWVyLnNsaWRlci5vbmNhbnBsYXl0aHJvdWdoID0gc25kUGxheWVyLmNiQ2FuUGxheVRocm91Z2g7XG5cdH0sXG5cdGNiQ2FuUGxheVRocm91Z2goKSB7XG5cdFx0c25kUGxheWVyLmR1cmF0aW9uID0gc25kUGxheWVyLnNsaWRlci5kdXJhdGlvbjtcblx0XHRjb25zb2xlLmxvZyhgTmV3IGR1cmF0aW9uICR7c25kUGxheWVyLnNsaWRlci5yZWFkeVN0YXRlfWApO1xuXHRcdGlmIChzbmRQbGF5ZXIuZHVyYXRpb24gPiAwKSB7XG5cdFx0XHRzbmRQbGF5ZXIuJHNsaWRlci5yYW5nZSgnc2V0IHZhbHVlJywgMCk7XG5cdFx0XHRzbmRQbGF5ZXIuJHBsYXllclNlZ21lbnQuc2hvdygpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRzbmRQbGF5ZXIuJHBsYXllclNlZ21lbnQuaGlkZSgpO1xuXHRcdH1cblx0fSxcblxuXHRjYk9uU2xpZGVyQ2hhbmdlKG5ld1ZhbCwgbWV0YSkge1xuXHRcdGlmIChtZXRhLnRyaWdnZXJlZEJ5VXNlciAmJiBOdW1iZXIuaXNGaW5pdGUoc25kUGxheWVyLnNsaWRlci5kdXJhdGlvbikpIHtcblx0XHRcdHNuZFBsYXllci5zbGlkZXIucmVtb3ZlRXZlbnRMaXN0ZW5lcigndGltZXVwZGF0ZScsIHNuZFBsYXllci5jYlRpbWVVcGRhdGUsIGZhbHNlKTtcblx0XHRcdHNuZFBsYXllci5zbGlkZXIuY3VycmVudFRpbWUgPSAoc25kUGxheWVyLnNsaWRlci5kdXJhdGlvbiAqIG5ld1ZhbCkgLyAxMDA7XG5cdFx0XHRzbmRQbGF5ZXIuc2xpZGVyLmFkZEV2ZW50TGlzdGVuZXIoJ3RpbWV1cGRhdGUnLCBzbmRQbGF5ZXIuY2JUaW1lVXBkYXRlLCBmYWxzZSk7XG5cdFx0fVxuXHR9LFxuXHQvLyB0aW1lVXBkYXRlXG5cdC8vIFN5bmNocm9uaXplcyBwbGF5aGVhZCBwb3NpdGlvbiB3aXRoIGN1cnJlbnQgcG9pbnQgaW4gYXVkaW9cblx0Y2JUaW1lVXBkYXRlKCkge1xuXHRcdGlmIChOdW1iZXIuaXNGaW5pdGUoc25kUGxheWVyLnNsaWRlci5kdXJhdGlvbikpIHtcblx0XHRcdGNvbnN0IHBlcmNlbnQgPSBzbmRQbGF5ZXIuc2xpZGVyLmN1cnJlbnRUaW1lIC8gc25kUGxheWVyLnNsaWRlci5kdXJhdGlvbjtcblx0XHRcdGNvbnN0IHJhbmdlUG9zaXRpb24gPSBNYXRoLnJvdW5kKChwZXJjZW50KSAqIDEwMCk7XG5cdFx0XHRzbmRQbGF5ZXIuJHNsaWRlci5yYW5nZSgnc2V0IHZhbHVlJywgcmFuZ2VQb3NpdGlvbik7XG5cdFx0XHRpZiAoc25kUGxheWVyLnNsaWRlci5jdXJyZW50VGltZSA9PT0gc25kUGxheWVyLmR1cmF0aW9uKSB7XG5cdFx0XHRcdHNuZFBsYXllci4kcEJ1dHRvbi5odG1sKCc8aSBjbGFzcz1cImljb24gcGxheVwiPjwvaT4nKTtcblx0XHRcdH1cblx0XHR9XG5cdH0sXG5cblx0Ly8gUGxheSBhbmQgUGF1c2Vcblx0cGxheSgpIHtcblx0XHQvLyBzdGFydCBtdXNpY1xuXHRcdGlmIChzbmRQbGF5ZXIuc2xpZGVyLnBhdXNlZCAmJiBzbmRQbGF5ZXIuc2xpZGVyLmR1cmF0aW9uKSB7XG5cdFx0XHRzbmRQbGF5ZXIuc2xpZGVyLnBsYXkoKTtcblx0XHRcdC8vIHJlbW92ZSBwbGF5LCBhZGQgcGF1c2Vcblx0XHRcdHNuZFBsYXllci4kcEJ1dHRvbi5odG1sKCc8aSBjbGFzcz1cImljb24gcGF1c2VcIj48L2k+Jyk7XG5cdFx0fSBlbHNlIHsgLy8gcGF1c2UgbXVzaWNcblx0XHRcdHNuZFBsYXllci5zbGlkZXIucGF1c2UoKTtcblx0XHRcdC8vIHJlbW92ZSBwYXVzZSwgYWRkIHBsYXlcblx0XHRcdHNuZFBsYXllci4kcEJ1dHRvbi5odG1sKCc8aSBjbGFzcz1cImljb24gcGxheVwiPjwvaT4nKTtcblx0XHR9XG5cdH0sXG5cbn07XG5cbmNvbnN0IHNvdW5kRmlsZU1vZGlmeSA9IHtcblx0dHJhc2hCaW46IFtdLFxuXHQkc291bmRVcGxvYWRCdXR0b246ICQoJyN1cGxvYWQtc291bmQtZmlsZScpLFxuXHQkc291bmRGaWxlSW5wdXQ6ICQoJyNmaWxlJyksXG5cdCRzb3VuZEZpbGVOYW1lOiAkKCcjbmFtZScpLFxuXHQkYXVkaW9QbGF5ZXI6ICQoJyNhdWRpby1wbGF5ZXInKSxcblx0JHN1Ym1pdEJ1dHRvbjogJCgnI3N1Ym1pdGJ1dHRvbicpLFxuXHRibG9iOiB3aW5kb3cuVVJMIHx8IHdpbmRvdy53ZWJraXRVUkwsXG5cdCRmb3JtT2JqOiAkKCcjc291bmQtZmlsZS1mb3JtJyksXG5cdHZhbGlkYXRlUnVsZXM6IHtcblx0XHRkZXNjcmlwdGlvbjoge1xuXHRcdFx0aWRlbnRpZmllcjogJ25hbWUnLFxuXHRcdFx0cnVsZXM6IFtcblx0XHRcdFx0e1xuXHRcdFx0XHRcdHR5cGU6ICdlbXB0eScsXG5cdFx0XHRcdFx0cHJvbXB0OiBnbG9iYWxUcmFuc2xhdGUuc2ZfVmFsaWRhdGlvbkZpbGVOYW1lSXNFbXB0eSxcblx0XHRcdFx0fSxcblx0XHRcdF0sXG5cdFx0fSxcblx0XHRwYXRoOiB7XG5cdFx0XHRpZGVudGlmaWVyOiAncGF0aCcsXG5cdFx0XHRydWxlczogW1xuXHRcdFx0XHR7XG5cdFx0XHRcdFx0dHlwZTogJ2VtcHR5Jyxcblx0XHRcdFx0XHRwcm9tcHQ6IGdsb2JhbFRyYW5zbGF0ZS5zZl9WYWxpZGF0aW9uRmlsZU5vdFNlbGVjdGVkLFxuXHRcdFx0XHR9LFxuXHRcdFx0XSxcblx0XHR9LFxuXHR9LFxuXHRpbml0aWFsaXplKCkge1xuXHRcdCQoJy5jYXRlZ29yeS1zZWxlY3QnKS5kcm9wZG93bigpO1xuXHRcdHNvdW5kRmlsZU1vZGlmeS5pbml0aWFsaXplRm9ybSgpO1xuXHRcdHNvdW5kRmlsZU1vZGlmeS4kc291bmRVcGxvYWRCdXR0b24ub24oJ2NsaWNrJywgKGUpID0+IHtcblx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdCQoJ2lucHV0OmZpbGUnLCAkKGUudGFyZ2V0KS5wYXJlbnRzKCkpLmNsaWNrKCk7XG5cdFx0fSk7XG5cblx0XHRzb3VuZEZpbGVNb2RpZnkuJHNvdW5kRmlsZUlucHV0Lm9uKCdjaGFuZ2UnLCAoZSkgPT4ge1xuXHRcdFx0Y29uc3QgZmlsZSA9IGUudGFyZ2V0LmZpbGVzWzBdO1xuXHRcdFx0aWYgKGZpbGUgPT09IHVuZGVmaW5lZCkgcmV0dXJuO1xuXHRcdFx0c291bmRGaWxlTW9kaWZ5LiRzb3VuZEZpbGVOYW1lLnZhbChmaWxlLm5hbWUucmVwbGFjZSgvXFwuW14vLl0rJC8sICcnKSk7XG5cdFx0XHRzb3VuZEZpbGVNb2RpZnkuYmxvYiA9IHdpbmRvdy5VUkwgfHwgd2luZG93LndlYmtpdFVSTDtcblx0XHRcdGNvbnN0IGZpbGVVUkwgPSBzb3VuZEZpbGVNb2RpZnkuYmxvYi5jcmVhdGVPYmplY3RVUkwoZmlsZSk7XG5cdFx0XHRzbmRQbGF5ZXIuVXBkYXRlU291cmNlKGZpbGVVUkwpO1xuXHRcdFx0c291bmRGaWxlTW9kaWZ5LiRmb3JtT2JqLmFkZENsYXNzKCdsb2FkaW5nJyk7XG5cdFx0XHRQYnhBcGkuU3lzdGVtVXBsb2FkQXVkaW9GaWxlKGZpbGUsIHNvdW5kRmlsZU1vZGlmeS5jYkFmdGVyVXBsb2FkRmlsZSk7XG5cdFx0fSk7XG5cblx0XHRpZiAod2luZG93LmxvY2F0aW9uLnByb3RvY29sICE9PSAnaHR0cHM6JyAmJiB3aW5kb3cubG9jYXRpb24uaG9zdG5hbWUgIT09ICdsb2NhbGhvc3QnKSB7XG5cdFx0XHQkKCcjb25seS1odHRwcy1maWVsZCcpLmFkZENsYXNzKCdkaXNhYmxlZCcpO1xuXHRcdH1cblx0XHRpZiAod2luZG93Lm5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZignTVNJRSAnKSA+IDApIHtcblx0XHRcdCQoJyNvbmx5LWh0dHBzLWZpZWxkJykuYWRkQ2xhc3MoJ2Rpc2FibGVkJyk7XG5cdFx0fVxuXHR9LFxuXHRjYkFmdGVyVXBsb2FkRmlsZShmaWxlbmFtZSkge1xuXHRcdHNvdW5kRmlsZU1vZGlmeS50cmFzaEJpbi5wdXNoKHNvdW5kRmlsZU1vZGlmeS4kZm9ybU9iai5mb3JtKCdnZXQgdmFsdWUnLCAncGF0aCcpKTtcblx0XHRzb3VuZEZpbGVNb2RpZnkuJGZvcm1PYmouZm9ybSgnc2V0IHZhbHVlJywgJ3BhdGgnLCBmaWxlbmFtZSk7XG5cdFx0c291bmRGaWxlTW9kaWZ5LiRzb3VuZEZpbGVOYW1lLnRyaWdnZXIoJ2NoYW5nZScpO1xuXHRcdHNuZFBsYXllci5VcGRhdGVTb3VyY2UoYC9wYnhjb3JlL2FwaS9jZHIvcGxheWJhY2s/dmlldz0ke2ZpbGVuYW1lfWApO1xuXHRcdHNvdW5kRmlsZU1vZGlmeS4kc3VibWl0QnV0dG9uLnJlbW92ZUNsYXNzKCdsb2FkaW5nJyk7XG5cdFx0c291bmRGaWxlTW9kaWZ5LiRmb3JtT2JqLnJlbW92ZUNsYXNzKCdsb2FkaW5nJyk7XG5cdH0sXG5cdGNiQmVmb3JlU2VuZEZvcm0oc2V0dGluZ3MpIHtcblx0XHRjb25zdCByZXN1bHQgPSBzZXR0aW5ncztcblx0XHRyZXN1bHQuZGF0YSA9IHNvdW5kRmlsZU1vZGlmeS4kZm9ybU9iai5mb3JtKCdnZXQgdmFsdWVzJyk7XG5cdFx0cmV0dXJuIHJlc3VsdDtcblx0fSxcblx0Y2JBZnRlclNlbmRGb3JtKCkge1xuXHRcdHNvdW5kRmlsZU1vZGlmeS50cmFzaEJpbi5mb3JFYWNoKChmaWxlcGF0aCkgPT4ge1xuXHRcdFx0aWYgKGZpbGVwYXRoKSBQYnhBcGkuU3lzdGVtUmVtb3ZlQXVkaW9GaWxlKGZpbGVwYXRoKTtcblx0XHR9KTtcblx0fSxcblx0aW5pdGlhbGl6ZUZvcm0oKSB7XG5cdFx0Rm9ybS4kZm9ybU9iaiA9IHNvdW5kRmlsZU1vZGlmeS4kZm9ybU9iajtcblx0XHRGb3JtLnVybCA9IGAke2dsb2JhbFJvb3RVcmx9c291bmQtZmlsZXMvc2F2ZWA7XG5cdFx0Rm9ybS52YWxpZGF0ZVJ1bGVzID0gc291bmRGaWxlTW9kaWZ5LnZhbGlkYXRlUnVsZXM7XG5cdFx0Rm9ybS5jYkJlZm9yZVNlbmRGb3JtID0gc291bmRGaWxlTW9kaWZ5LmNiQmVmb3JlU2VuZEZvcm07XG5cdFx0Rm9ybS5jYkFmdGVyU2VuZEZvcm0gPSBzb3VuZEZpbGVNb2RpZnkuY2JBZnRlclNlbmRGb3JtO1xuXHRcdEZvcm0uaW5pdGlhbGl6ZSgpO1xuXHR9LFxufTtcblxuXG5jb25zdCB3ZWJraXRSZWNvcmRlciA9IHtcblx0JHJlY29yZExhYmVsOiAkKCcjcmVjb3JkLWxhYmVsJyksXG5cdCRyZWNvcmRCdXR0b246ICQoJyNzdGFydC1yZWNvcmQtYnV0dG9uJyksXG5cdCRzdG9wQnV0dG9uOiAkKCcjc3RvcC1yZWNvcmQtYnV0dG9uJyksXG5cdCRzZWxlY3RBdWRpb0lucHV0OiAkKCcjc2VsZWN0LWF1ZGlvLWJ1dHRvbicpLFxuXHQkYXVkaW9QbGF5ZXI6ICQoJyNhdWRpby1wbGF5ZXInKSxcblx0YXVkaW9JbnB1dE1lbnU6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhdWRpby1pbnB1dC1zZWxlY3QnKSxcblx0Y2h1bmtzOiBbXSxcblx0bWVkaWFSZWNvcmRlcjogJycsXG5cdGluaXRpYWxpemUoKSB7XG5cdFx0d2Via2l0UmVjb3JkZXIuJHN0b3BCdXR0b24uYWRkQ2xhc3MoJ2Rpc2FibGVkJyk7XG5cblx0XHR3ZWJraXRSZWNvcmRlci4kcmVjb3JkQnV0dG9uLm9uKCdjbGljaycsIChlKSA9PiB7XG5cdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHR3ZWJraXRSZWNvcmRlci5jaHVua3MgPSBbXTtcblx0XHRcdGxldCBjb25zdHJhaW50cyA9IHtcblx0XHRcdFx0YXVkaW86IHRydWUsXG5cdFx0XHR9O1xuXHRcdFx0aWYgKHdlYmtpdFJlY29yZGVyLmF1ZGlvSW5wdXRNZW51LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ3NlbGVjdGVkJykubGVuZ3RoID4gMCkge1xuXHRcdFx0XHRjb25zdCBhdWRpb1NvdXJjZSA9IHdlYmtpdFJlY29yZGVyLmF1ZGlvSW5wdXRNZW51LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ3NlbGVjdGVkJylbMF0uaWQ7XG5cdFx0XHRcdGNvbnN0cmFpbnRzID0ge1xuXHRcdFx0XHRcdGF1ZGlvOiB7ZGV2aWNlSWQ6IGF1ZGlvU291cmNlID8ge2V4YWN0OiBhdWRpb1NvdXJjZX0gOiB1bmRlZmluZWR9LFxuXHRcdFx0XHR9O1xuXHRcdFx0fVxuXHRcdFx0Y29uc29sZS5sb2coY29uc3RyYWludHMpO1xuXHRcdFx0d2Via2l0UmVjb3JkZXIuY2FwdHVyZVVzZXJNZWRpYShcblx0XHRcdFx0Y29uc3RyYWludHMsXG5cdFx0XHRcdHdlYmtpdFJlY29yZGVyLmNiT25TdWNjZXNzLFxuXHRcdFx0XHR3ZWJraXRSZWNvcmRlci5nb3REZXZpY2VzLFxuXHRcdFx0XHR3ZWJraXRSZWNvcmRlci5vbkVycm9yLFxuXHRcdFx0KTtcblx0XHR9KTtcblx0XHR3ZWJraXRSZWNvcmRlci4kc3RvcEJ1dHRvbi5vbignY2xpY2snLCAoZSkgPT4ge1xuXHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0d2Via2l0UmVjb3JkZXIubWVkaWFSZWNvcmRlci5zdG9wKCk7XG5cdFx0fSk7XG5cblx0XHR3ZWJraXRSZWNvcmRlci4kc2VsZWN0QXVkaW9JbnB1dC5kcm9wZG93bigpO1xuXHR9LFxuXHRjYXB0dXJlVXNlck1lZGlhKG1lZGlhQ29uc3RyYWludHMsIHN1Y2Nlc3NDYWxsYmFjaywgZ290RGV2aWNlc0NhbGxCYWNrLCBlcnJvckNhbGxiYWNrKSB7XG5cdFx0bmF2aWdhdG9yXG5cdFx0XHQubWVkaWFEZXZpY2VzLmdldFVzZXJNZWRpYShtZWRpYUNvbnN0cmFpbnRzKVxuXHRcdFx0LnRoZW4oc3VjY2Vzc0NhbGxiYWNrKVxuXHRcdFx0LnRoZW4oZ290RGV2aWNlc0NhbGxCYWNrKVxuXHRcdFx0LmNhdGNoKGVycm9yQ2FsbGJhY2spO1xuXHR9LFxuXHRnb3REZXZpY2VzKGRldmljZUluZm9zKSB7XG5cdFx0aWYgKHdlYmtpdFJlY29yZGVyLmF1ZGlvSW5wdXRNZW51LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdkaXYnKS5sZW5ndGggPiAwKSByZXR1cm47XG5cdFx0Zm9yIChsZXQgaSA9IDA7IGkgIT09IGRldmljZUluZm9zLmxlbmd0aDsgaSArPSAxKSB7XG5cdFx0XHRjb25zdCBkZXZpY2VJbmZvID0gZGV2aWNlSW5mb3NbaV07XG5cdFx0XHRjb25zdCBvcHRpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcblx0XHRcdG9wdGlvbi5jbGFzc05hbWUgPSAnaXRlbSc7XG5cdFx0XHRvcHRpb24uaWQgPSBkZXZpY2VJbmZvLmRldmljZUlkO1xuXHRcdFx0aWYgKGRldmljZUluZm8ua2luZCA9PT0gJ2F1ZGlvaW5wdXQnKSB7XG5cdFx0XHRcdG9wdGlvbi5pbm5lckhUTUwgPSBkZXZpY2VJbmZvLmxhYmVsIHx8XG5cdFx0XHRcdFx0YG1pY3JvcGhvbmUgJHt3ZWJraXRSZWNvcmRlci5hdWRpb0lucHV0TWVudS5sZW5ndGggKyAxfWA7XG5cdFx0XHRcdHdlYmtpdFJlY29yZGVyLmF1ZGlvSW5wdXRNZW51LmFwcGVuZENoaWxkKG9wdGlvbik7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdGlmICh3ZWJraXRSZWNvcmRlci5hdWRpb0lucHV0TWVudS5nZXRFbGVtZW50c0J5VGFnTmFtZSgnZGl2JykubGVuZ3RoID4gMCkge1xuXHRcdFx0d2Via2l0UmVjb3JkZXIuJHNlbGVjdEF1ZGlvSW5wdXQucmVtb3ZlQ2xhc3MoJ2Rpc2FibGVkJyk7XG5cdFx0fVxuXHR9LFxuXHRjYk9uU3VjY2VzcyhzdHJlYW0pIHtcblx0XHR0cnkge1xuXHRcdFx0d2Via2l0UmVjb3JkZXIubWVkaWFSZWNvcmRlciA9IG5ldyBNZWRpYVN0cmVhbVJlY29yZGVyKHN0cmVhbSk7XG5cdFx0XHR3ZWJraXRSZWNvcmRlci5tZWRpYVJlY29yZGVyLnN0cmVhbSA9IHN0cmVhbTtcblx0XHRcdHdlYmtpdFJlY29yZGVyLm1lZGlhUmVjb3JkZXIucmVjb3JkZXJUeXBlID0gU3RlcmVvQXVkaW9SZWNvcmRlcjtcblx0XHRcdHdlYmtpdFJlY29yZGVyLm1lZGlhUmVjb3JkZXIubWltZVR5cGUgPSAnYXVkaW8vd2F2Jztcblx0XHRcdHdlYmtpdFJlY29yZGVyLm1lZGlhUmVjb3JkZXIuYXVkaW9DaGFubmVscyA9IDE7XG5cblx0XHRcdC8vIHdlYmtpdFJlY29yZGVyLm1lZGlhUmVjb3JkZXIgPSBuZXcgTWVkaWFSZWNvcmRlcihzdHJlYW0pO1xuXHRcdFx0d2Via2l0UmVjb3JkZXIubWVkaWFSZWNvcmRlci5vbnN0b3AgPSB3ZWJraXRSZWNvcmRlci5jYk9uU3RvcE1lZGlhUmVjb3JkZXI7XG5cdFx0XHR3ZWJraXRSZWNvcmRlci5tZWRpYVJlY29yZGVyLm9uZGF0YWF2YWlsYWJsZSA9IHdlYmtpdFJlY29yZGVyLmNiT25EYXRhQXZhaWxhYmxlO1xuXHRcdFx0d2Via2l0UmVjb3JkZXIubWVkaWFSZWNvcmRlci5zdGFydCgzMDAwMDApO1xuXHRcdFx0Y29uc29sZS5sb2coJ3JlY29yZGVyIHN0YXJ0ZWQnKTtcblx0XHRcdHdlYmtpdFJlY29yZGVyLiRyZWNvcmRMYWJlbC5hZGRDbGFzcygncmVkJyk7XG5cdFx0XHR3ZWJraXRSZWNvcmRlci4kc3RvcEJ1dHRvbi5yZW1vdmVDbGFzcygnZGlzYWJsZWQnKTtcblx0XHRcdHdlYmtpdFJlY29yZGVyLiRyZWNvcmRCdXR0b24uYWRkQ2xhc3MoJ2Rpc2FibGVkJyk7XG5cdFx0XHRyZXR1cm4gbmF2aWdhdG9yLm1lZGlhRGV2aWNlcy5lbnVtZXJhdGVEZXZpY2VzKCk7XG5cdFx0fSBjYXRjaCAoZSkge1xuXHRcdFx0Y29uc29sZS5lcnJvcignTWVkaWFTdHJlYW1SZWNvcmRlciBpcyBub3Qgc3VwcG9ydGVkIGJ5IHRoaXMgYnJvd3Nlci5cXG5cXG4nICtcblx0XHRcdFx0J1RyeSBGaXJlZm94IDI5IG9yIGxhdGVyLCBvciBDaHJvbWUgNDcgb3IgbGF0ZXIsIHdpdGggRW5hYmxlIGV4cGVyaW1lbnRhbCBXZWIgUGxhdGZvcm0gZmVhdHVyZXMgZW5hYmxlZCBmcm9tIGNocm9tZTovL2ZsYWdzLicpO1xuXHRcdFx0Y29uc29sZS5lcnJvcignRXhjZXB0aW9uIHdoaWxlIGNyZWF0aW5nIE1lZGlhUmVjb3JkZXI6JywgZSk7XG5cdFx0XHR3ZWJraXRSZWNvcmRlci4kcmVjb3JkQnV0dG9uLmFkZENsYXNzKCdkaXNhYmxlZCcpO1xuXHRcdH1cblx0XHRyZXR1cm4gZmFsc2U7XG5cdH0sXG5cdGNiT25FcnJvcihlcnIpIHtcblx0XHRjb25zb2xlLmxvZyhgVGhlIGZvbGxvd2luZyBlcnJvciBvY2N1cmVkOiAke2Vycn1gKTtcblx0fSxcblx0Y2JPblN0b3BNZWRpYVJlY29yZGVyKCkge1xuXHRcdGNvbnNvbGUubG9nKCdkYXRhIGF2YWlsYWJsZSBhZnRlciBNZWRpYVN0cmVhbVJlY29yZGVyLnN0b3AoKSBjYWxsZWQuJyk7XG5cdFx0c291bmRGaWxlTW9kaWZ5LmJsb2IgPSBuZXcgQmxvYih3ZWJraXRSZWNvcmRlci5jaHVua3MpO1xuXHRcdGNvbnNvbGUubG9nKCdyZWNvcmRlciBzdG9wcGVkJyk7XG5cdFx0Y29uc3QgZmlsZVVSTCA9IFVSTC5jcmVhdGVPYmplY3RVUkwoc291bmRGaWxlTW9kaWZ5LmJsb2IpO1xuXHRcdHNuZFBsYXllci5VcGRhdGVTb3VyY2UoZmlsZVVSTCk7XG5cdFx0Y29uc3QgYmxvYkZpbGUgPSBuZXcgRmlsZShbd2Via2l0UmVjb3JkZXIuY2h1bmtzWzBdXSwgJ2Jsb2InKTtcblx0XHRQYnhBcGkuU3lzdGVtVXBsb2FkQXVkaW9GaWxlKGJsb2JGaWxlLCBzb3VuZEZpbGVNb2RpZnkuY2JBZnRlclVwbG9hZEZpbGUpO1xuXHRcdHdlYmtpdFJlY29yZGVyLiRyZWNvcmRMYWJlbC5yZW1vdmVDbGFzcygncmVkJyk7XG5cdFx0d2Via2l0UmVjb3JkZXIuJHN0b3BCdXR0b24uYWRkQ2xhc3MoJ2Rpc2FibGVkJyk7XG5cdFx0d2Via2l0UmVjb3JkZXIuJHJlY29yZEJ1dHRvbi5yZW1vdmVDbGFzcygnZGlzYWJsZWQnKTtcblx0XHRzb3VuZEZpbGVNb2RpZnkuJHNvdW5kRmlsZUlucHV0LnZhbCgnJyk7XG5cdH0sXG5cdGNiT25EYXRhQXZhaWxhYmxlKGUpIHtcblx0XHR3ZWJraXRSZWNvcmRlci5jaHVua3MucHVzaChlKTtcblx0fSxcbn07XG5cblxuJChkb2N1bWVudCkucmVhZHkoKCkgPT4ge1xuXHRzbmRQbGF5ZXIuaW5pdGlhbGl6ZSgpO1xuXHRzb3VuZEZpbGVNb2RpZnkuaW5pdGlhbGl6ZSgpO1xuXHR3ZWJraXRSZWNvcmRlci5pbml0aWFsaXplKCk7XG59KTtcbiJdfQ==