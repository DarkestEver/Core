{"version":3,"sources":["../../src/SoundFiles/sound-file-modify.js"],"names":["sndPlayer","slider","document","getElementById","duration","$pButton","$","$slider","$playerSegment","initialize","on","e","preventDefault","play","addEventListener","cbTimeUpdate","cbCanPlayThrough","range","min","max","start","onChange","cbOnSliderChange","UpdateSource","newSource","getElementsByTagName","src","pause","load","oncanplaythrough","console","log","readyState","show","hide","newVal","meta","triggeredByUser","isFinite","removeEventListener","currentTime","percent","rangePosition","Math","round","html","paused","soundFileModify","trashBin","$soundUploadButton","$soundFileInput","$soundFileName","$audioPlayer","$submitButton","blob","window","URL","webkitURL","$formObj","validateRules","description","identifier","rules","type","prompt","globalTranslate","sf_ValidationFileNameIsEmpty","path","sf_ValidationFileNotSelected","dropdown","initializeForm","target","parents","click","file","files","undefined","val","name","replace","fileURL","createObjectURL","PbxApi","SystemUploadAudioFile","cbAfterUploadFile","location","protocol","hostname","addClass","navigator","userAgent","indexOf","filename","removeClass","push","form","trigger","cbBeforeSendForm","settings","result","data","cbAfterSendForm","forEach","filepath","SystemRemoveAudioFile","Form","url","globalRootUrl","webkitRecorder","$recordLabel","$recordButton","$stopButton","$selectAudioInput","audioInputMenu","chunks","mediaRecorder","constraints","audio","getElementsByClassName","length","audioSource","id","deviceId","exact","captureUserMedia","cbOnSuccess","gotDevices","onError","stop","mediaConstraints","successCallback","gotDevicesCallBack","errorCallback","mediaDevices","getUserMedia","then","deviceInfos","i","deviceInfo","option","createElement","className","kind","innerHTML","label","appendChild","stream","MediaStreamRecorder","recorderType","StereoAudioRecorder","mimeType","audioChannels","onstop","cbOnStopMediaRecorder","ondataavailable","cbOnDataAvailable","enumerateDevices","error","cbOnError","err","Blob","blobFile","File","ready"],"mappings":"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","sourcesContent":["/*\n * Copyright (C) MIKO LLC - All Rights Reserved\n * Unauthorized copying of this file, via any medium is strictly prohibited\n * Proprietary and confidential\n * Written by Nikolay Beketov, 5 2018\n *\n */\n\n/* global globalRootUrl,globalTranslate, MediaStreamRecorder, StereoAudioRecorder, Form, PbxApi */\n\nconst sndPlayer = {\n\tslider: document.getElementById('audio-player'),\n\tduration: 0, // Duration of audio clip\n\t$pButton: $('#play-button'), // play button\n\t$slider: $('#play-slider'),\n\t$playerSegment: $('#audio-player-segment'),\n\tinitialize() {\n\t\t// play button event listenter\n\t\tsndPlayer.$pButton.on('click', (e) => {\n\t\t\te.preventDefault();\n\t\t\tsndPlayer.play();\n\t\t});\n\t\t// timeupdate event listener\n\t\tsndPlayer.slider.addEventListener('timeupdate', sndPlayer.cbTimeUpdate, false);\n\n\t\t// Gets audio file duration\n\t\tsndPlayer.slider.addEventListener('canplaythrough', sndPlayer.cbCanPlayThrough, false);\n\n\t\tsndPlayer.$slider.range({\n\t\t\tmin: 0,\n\t\t\tmax: 100,\n\t\t\tstart: 0,\n\t\t\tonChange: sndPlayer.cbOnSliderChange,\n\t\t});\n\t},\n\tUpdateSource(newSource) {\n\t\tsndPlayer.slider.getElementsByTagName('source')[0].src = newSource;\n\t\tsndPlayer.slider.pause();\n\t\tsndPlayer.slider.load();\n\t\tsndPlayer.slider.oncanplaythrough = sndPlayer.cbCanPlayThrough;\n\t},\n\tcbCanPlayThrough() {\n\t\tsndPlayer.duration = sndPlayer.slider.duration;\n\t\tconsole.log(`New duration ${sndPlayer.slider.readyState}`);\n\t\tif (sndPlayer.duration > 0) {\n\t\t\tsndPlayer.$slider.range('set value', 0);\n\t\t\tsndPlayer.$playerSegment.show();\n\t\t} else {\n\t\t\tsndPlayer.$playerSegment.hide();\n\t\t}\n\t},\n\n\tcbOnSliderChange(newVal, meta) {\n\t\tif (meta.triggeredByUser && isFinite(sndPlayer.slider.duration)) {\n\t\t\tsndPlayer.slider.removeEventListener('timeupdate', sndPlayer.cbTimeUpdate, false);\n\t\t\tsndPlayer.slider.currentTime = (sndPlayer.slider.duration * newVal) / 100;\n\t\t\tsndPlayer.slider.addEventListener('timeupdate', sndPlayer.cbTimeUpdate, false);\n\t\t}\n\t},\n\t// timeUpdate\n\t// Synchronizes playhead position with current point in audio\n\tcbTimeUpdate() {\n\t\tif (isFinite(sndPlayer.slider.duration)) {\n\t\t\tconst percent = sndPlayer.slider.currentTime / sndPlayer.slider.duration;\n\t\t\tconst rangePosition = Math.round((percent) * 100);\n\t\t\tsndPlayer.$slider.range('set value', rangePosition);\n\t\t\tif (sndPlayer.slider.currentTime === sndPlayer.duration) {\n\t\t\t\tsndPlayer.$pButton.html('<i class=\"icon play\"></i>');\n\t\t\t}\n\t\t}\n\t},\n\n\t// Play and Pause\n\tplay() {\n\t\t// start music\n\t\tif (sndPlayer.slider.paused && sndPlayer.slider.duration) {\n\t\t\tsndPlayer.slider.play();\n\t\t\t// remove play, add pause\n\t\t\tsndPlayer.$pButton.html('<i class=\"icon pause\"></i>');\n\t\t} else { // pause music\n\t\t\tsndPlayer.slider.pause();\n\t\t\t// remove pause, add play\n\t\t\tsndPlayer.$pButton.html('<i class=\"icon play\"></i>');\n\t\t}\n\t},\n\n};\n\nconst soundFileModify = {\n\ttrashBin: [],\n\t$soundUploadButton: $('#upload-sound-file'),\n\t$soundFileInput: $('#file'),\n\t$soundFileName: $('#name'),\n\t$audioPlayer: $('#audio-player'),\n\t$submitButton: $('#submitbutton'),\n\tblob: window.URL || window.webkitURL,\n\t$formObj: $('#sound-file-form'),\n\tvalidateRules: {\n\t\tdescription: {\n\t\t\tidentifier: 'name',\n\t\t\trules: [\n\t\t\t\t{\n\t\t\t\t\ttype: 'empty',\n\t\t\t\t\tprompt: globalTranslate.sf_ValidationFileNameIsEmpty,\n\t\t\t\t},\n\t\t\t],\n\t\t},\n\t\tpath: {\n\t\t\tidentifier: 'path',\n\t\t\trules: [\n\t\t\t\t{\n\t\t\t\t\ttype: 'empty',\n\t\t\t\t\tprompt: globalTranslate.sf_ValidationFileNotSelected,\n\t\t\t\t},\n\t\t\t],\n\t\t},\n\t},\n\tinitialize() {\n\t\t$('.category-select').dropdown();\n\t\tsoundFileModify.initializeForm();\n\t\tsoundFileModify.$soundUploadButton.on('click', (e) => {\n\t\t\te.preventDefault();\n\t\t\t$('input:file', $(e.target).parents()).click();\n\t\t});\n\n\t\tsoundFileModify.$soundFileInput.on('change', (e) => {\n\t\t\tconst file = e.target.files[0];\n\t\t\tif (file === undefined) return;\n\t\t\tsoundFileModify.$soundFileName.val(file.name.replace(/\\.[^/.]+$/, ''));\n\t\t\tsoundFileModify.blob = window.URL || window.webkitURL;\n\t\t\tconst fileURL = soundFileModify.blob.createObjectURL(file);\n\t\t\tsndPlayer.UpdateSource(fileURL);\n\t\t\tPbxApi.SystemUploadAudioFile(file, soundFileModify.cbAfterUploadFile);\n\t\t});\n\n\t\tif (window.location.protocol !== 'https:' && window.location.hostname !== 'localhost') {\n\t\t\t$('#only-https-field').addClass('disabled');\n\t\t}\n\t\tif (window.navigator.userAgent.indexOf('MSIE ') > 0) {\n\t\t\t$('#only-https-field').addClass('disabled');\n\t\t}\n\t},\n\tcbAfterUploadFile(filename) {\n\t\tsoundFileModify.$submitButton.removeClass('loading');\n\t\tsoundFileModify.trashBin.push(soundFileModify.$formObj.form('get value', 'path'));\n\t\tsoundFileModify.$formObj.form('set value', 'path', filename);\n\t\tsoundFileModify.$soundFileName.trigger('change');\n\t\tsndPlayer.UpdateSource(`/pbxcore/api/cdr/playback?view=${filename}`);\n\t},\n\tcbBeforeSendForm(settings) {\n\t\tconst result = settings;\n\t\tresult.data = soundFileModify.$formObj.form('get values');\n\t\treturn result;\n\t},\n\tcbAfterSendForm() {\n\t\tsoundFileModify.trashBin.forEach((filepath) => {\n\t\t\tif (filepath) PbxApi.SystemRemoveAudioFile(filepath);\n\t\t});\n\t},\n\tinitializeForm() {\n\t\tForm.$formObj = soundFileModify.$formObj;\n\t\tForm.url = `${globalRootUrl}sound-files/save`;\n\t\tForm.validateRules = soundFileModify.validateRules;\n\t\tForm.cbBeforeSendForm = soundFileModify.cbBeforeSendForm;\n\t\tForm.cbAfterSendForm = soundFileModify.cbAfterSendForm;\n\t\tForm.initialize();\n\t},\n};\n\n\nconst webkitRecorder = {\n\t$recordLabel: $('#record-label'),\n\t$recordButton: $('#start-record-button'),\n\t$stopButton: $('#stop-record-button'),\n\t$selectAudioInput: $('#select-audio-button'),\n\t$audioPlayer: $('#audio-player'),\n\taudioInputMenu: document.getElementById('audio-input-select'),\n\tchunks: [],\n\tmediaRecorder: '',\n\tinitialize() {\n\t\twebkitRecorder.$stopButton.addClass('disabled');\n\n\t\twebkitRecorder.$recordButton.on('click', (e) => {\n\t\t\te.preventDefault();\n\t\t\twebkitRecorder.chunks = [];\n\t\t\tlet constraints = {\n\t\t\t\taudio: true,\n\t\t\t};\n\t\t\tif (webkitRecorder.audioInputMenu.getElementsByClassName('selected').length > 0) {\n\t\t\t\tconst audioSource = webkitRecorder.audioInputMenu.getElementsByClassName('selected')[0].id;\n\t\t\t\tconstraints = {\n\t\t\t\t\taudio: {deviceId: audioSource ? {exact: audioSource} : undefined},\n\t\t\t\t};\n\t\t\t}\n\t\t\tconsole.log(constraints);\n\t\t\twebkitRecorder.captureUserMedia(\n\t\t\t\tconstraints,\n\t\t\t\twebkitRecorder.cbOnSuccess,\n\t\t\t\twebkitRecorder.gotDevices,\n\t\t\t\twebkitRecorder.onError,\n\t\t\t);\n\t\t});\n\t\twebkitRecorder.$stopButton.on('click', (e) => {\n\t\t\te.preventDefault();\n\t\t\twebkitRecorder.mediaRecorder.stop();\n\t\t});\n\n\t\twebkitRecorder.$selectAudioInput.dropdown();\n\t},\n\tcaptureUserMedia(mediaConstraints, successCallback, gotDevicesCallBack, errorCallback) {\n\t\tnavigator\n\t\t\t.mediaDevices.getUserMedia(mediaConstraints)\n\t\t\t.then(successCallback)\n\t\t\t.then(gotDevicesCallBack)\n\t\t\t.catch(errorCallback);\n\t},\n\tgotDevices(deviceInfos) {\n\t\tif (webkitRecorder.audioInputMenu.getElementsByTagName('div').length > 0) return;\n\t\tfor (let i = 0; i !== deviceInfos.length; i += 1) {\n\t\t\tconst deviceInfo = deviceInfos[i];\n\t\t\tconst option = document.createElement('div');\n\t\t\toption.className = 'item';\n\t\t\toption.id = deviceInfo.deviceId;\n\t\t\tif (deviceInfo.kind === 'audioinput') {\n\t\t\t\toption.innerHTML = deviceInfo.label ||\n\t\t\t\t\t`microphone ${webkitRecorder.audioInputMenu.length + 1}`;\n\t\t\t\twebkitRecorder.audioInputMenu.appendChild(option);\n\t\t\t}\n\t\t}\n\t\tif (webkitRecorder.audioInputMenu.getElementsByTagName('div').length > 0) {\n\t\t\twebkitRecorder.$selectAudioInput.removeClass('disabled');\n\t\t}\n\t},\n\tcbOnSuccess(stream) {\n\t\ttry {\n\t\t\twebkitRecorder.mediaRecorder = new MediaStreamRecorder(stream);\n\t\t\twebkitRecorder.mediaRecorder.stream = stream;\n\t\t\twebkitRecorder.mediaRecorder.recorderType = StereoAudioRecorder;\n\t\t\twebkitRecorder.mediaRecorder.mimeType = 'audio/wav';\n\t\t\twebkitRecorder.mediaRecorder.audioChannels = 1;\n\n\t\t\t// webkitRecorder.mediaRecorder = new MediaRecorder(stream);\n\t\t\twebkitRecorder.mediaRecorder.onstop = webkitRecorder.cbOnStopMediaRecorder;\n\t\t\twebkitRecorder.mediaRecorder.ondataavailable = webkitRecorder.cbOnDataAvailable;\n\t\t\twebkitRecorder.mediaRecorder.start(300000);\n\t\t\tconsole.log('recorder started');\n\t\t\twebkitRecorder.$recordLabel.addClass('red');\n\t\t\twebkitRecorder.$stopButton.removeClass('disabled');\n\t\t\twebkitRecorder.$recordButton.addClass('disabled');\n\t\t\treturn navigator.mediaDevices.enumerateDevices();\n\t\t} catch (e) {\n\t\t\tconsole.error('MediaStreamRecorder is not supported by this browser.\\n\\n' +\n\t\t\t\t'Try Firefox 29 or later, or Chrome 47 or later, with Enable experimental Web Platform features enabled from chrome://flags.');\n\t\t\tconsole.error('Exception while creating MediaRecorder:', e);\n\t\t\twebkitRecorder.$recordButton.addClass('disabled');\n\t\t}\n\t\treturn false;\n\t},\n\tcbOnError(err) {\n\t\tconsole.log(`The following error occured: ${err}`);\n\t},\n\tcbOnStopMediaRecorder() {\n\t\tconsole.log('data available after MediaStreamRecorder.stop() called.');\n\t\tsoundFileModify.blob = new Blob(webkitRecorder.chunks);\n\t\tconsole.log('recorder stopped');\n\t\tconst fileURL = URL.createObjectURL(soundFileModify.blob);\n\t\tsndPlayer.UpdateSource(fileURL);\n\t\tconst blobFile = new File([webkitRecorder.chunks[0]], 'blob');\n\t\tPbxApi.SystemUploadAudioFile(blobFile, soundFileModify.cbAfterUploadFile);\n\t\twebkitRecorder.$recordLabel.removeClass('red');\n\t\twebkitRecorder.$stopButton.addClass('disabled');\n\t\twebkitRecorder.$recordButton.removeClass('disabled');\n\t\tsoundFileModify.$soundFileInput.val('');\n\t},\n\tcbOnDataAvailable(e) {\n\t\twebkitRecorder.chunks.push(e);\n\t},\n};\n\n\n$(document).ready(() => {\n\tsndPlayer.initialize();\n\tsoundFileModify.initialize();\n\twebkitRecorder.initialize();\n});\n"],"file":"sound-file-modify.js"}