{"version":3,"sources":["../../src/Providers/provider-modify.js"],"names":["$","fn","form","settings","rules","username","noregister","length","provider","$formObj","providerType","val","validateRules","description","identifier","type","prompt","globalTranslate","pr_ValidationProviderNameIsEmpty","host","pr_ValidationProviderHostIsEmpty","pr_ValidationProviderLoginIsEmpty","port","pr_ValidationProviderPortRange","initialize","checkbox","accordion","dropdown","onChange","removeClass","addClass","initializeForm","cbBeforeSendForm","result","data","cbAfterSendForm","Form","url","globalRootUrl","providersStatusLoopWorker","timeOut","timeOutHandle","$status","DebuggerInfo","restartWorker","window","clearTimeout","timeoutHandle","worker","PbxApi","GetSipProvidersStatuses","cbRefreshProvidersStatus","GetIaxProvidersStatuses","response","setTimeout","htmlTable","each","key","value","id","state","UpdateContent","uniqid","grep","e","respid","toUpperCase","undefined","hasClass","html","pr_Online","pr_WithoutRegistration","pr_Offline","document","ready"],"mappings":"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","sourcesContent":["/*\n * Copyright (C) MIKO LLC - All Rights Reserved\n * Unauthorized copying of this file, via any medium is strictly prohibited\n * Proprietary and confidential\n * Written by Nikolay Beketov, 6 2018\n *\n */\n\n/* global globalRootUrl,globalTranslate, PbxApi, Form, DebuggerInfo */\n\n// custom form validation rule\n$.fn.form.settings.rules.username = function (noregister, username) {\n\tif (username.length === 0 && noregister !== 'on') return false;\n\treturn true;\n};\n\nconst provider = {\n\t$formObj: $('#save-provider-form'),\n\tproviderType: $('#providerType').val(),\n\tvalidateRules: {\n\t\tdescription: {\n\t\t\tidentifier: 'description',\n\t\t\trules: [\n\t\t\t\t{\n\t\t\t\t\ttype: 'empty',\n\t\t\t\t\tprompt: globalTranslate.pr_ValidationProviderNameIsEmpty,\n\t\t\t\t},\n\t\t\t],\n\t\t},\n\t\thost: {\n\t\t\tidentifier: 'host',\n\t\t\trules: [\n\t\t\t\t{\n\t\t\t\t\ttype: 'empty',\n\t\t\t\t\tprompt: globalTranslate.pr_ValidationProviderHostIsEmpty,\n\t\t\t\t},\n\t\t\t],\n\t\t},\n\t\tusername: {\n\t\t\tidentifier: 'username',\n\t\t\trules: [\n\t\t\t\t{\n\t\t\t\t\ttype: 'username[noregister, username]',\n\t\t\t\t\tprompt: globalTranslate.pr_ValidationProviderLoginIsEmpty,\n\t\t\t\t},\n\t\t\t],\n\t\t},\n\t\tport: {\n\t\t\tidentifier: 'port',\n\t\t\trules: [\n\t\t\t\t{\n\t\t\t\t\ttype: 'integer[1..65535]',\n\t\t\t\t\tprompt: globalTranslate.pr_ValidationProviderPortRange,\n\t\t\t\t},\n\t\t\t],\n\t\t},\n\t},\n\tinitialize() {\n\t\t$('.codecs, .checkbox').checkbox();\n\t\t$('.ui.accordion').accordion();\n\t\t$('.dropdown').dropdown();\n\t\t$('#qualify').checkbox({\n\t\t\tonChange() {\n\t\t\t\tif ($('#qualify').checkbox('is checked')) {\n\t\t\t\t\t$('#qualify-freq').removeClass('disabled');\n\t\t\t\t} else {\n\t\t\t\t\t$('#qualify-freq').addClass('disabled');\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\t\tprovider.initializeForm();\n\t},\n\tcbBeforeSendForm(settings) {\n\t\tconst result = settings;\n\t\tresult.data = provider.$formObj.form('get values');\n\t\treturn result;\n\t},\n\tcbAfterSendForm() {\n\n\t},\n\tinitializeForm() {\n\t\tForm.$formObj = provider.$formObj;\n\t\tswitch (provider.providerType) {\n\t\t\tcase 'SIP':\n\t\t\t\tForm.url = `${globalRootUrl}providers/save/sip`;\n\t\t\t\tbreak;\n\t\t\tcase 'IAX':\n\t\t\t\tForm.url = `${globalRootUrl}providers/save/iax`;\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\treturn;\n\t\t}\n\t\tForm.validateRules = provider.validateRules;\n\t\tForm.cbBeforeSendForm = provider.cbBeforeSendForm;\n\t\tForm.cbAfterSendForm = provider.cbAfterSendForm;\n\t\tForm.initialize();\n\t},\n};\n\nconst providersStatusLoopWorker = {\n\ttimeOut: 3000,\n\ttimeOutHandle: '',\n\t$status: $('#status'),\n\tinitialize() {\n\t\t// Запустим обновление статуса провайдера\n\t\tDebuggerInfo.initialize();\n\t\tprovidersStatusLoopWorker.restartWorker();\n\t},\n\trestartWorker() {\n\t\twindow.clearTimeout(providersStatusLoopWorker.timeoutHandle);\n\t\tprovidersStatusLoopWorker.worker();\n\t},\n\tworker() {\n\t\twindow.clearTimeout(providersStatusLoopWorker.timeoutHandle);\n\t\tswitch (provider.providerType) {\n\t\t\tcase 'SIP':\n\t\t\t\tPbxApi.GetSipProvidersStatuses(providersStatusLoopWorker.cbRefreshProvidersStatus);\n\t\t\t\tbreak;\n\t\t\tcase 'IAX':\n\t\t\t\tPbxApi.GetIaxProvidersStatuses(providersStatusLoopWorker.cbRefreshProvidersStatus);\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t}\n\t},\n\tcbRefreshProvidersStatus(response) {\n\t\tprovidersStatusLoopWorker.timeoutHandle =\n\t\t\twindow.setTimeout(providersStatusLoopWorker.worker, providersStatusLoopWorker.timeOut);\n\t\tif (response.length === 0 || response === false) return;\n\t\tlet htmlTable = '<table class=\"ui very compact table\">';\n\t\t$.each(response, (key, value) => {\n\t\t\thtmlTable += '<tr>';\n\t\t\thtmlTable += `<td>${value.id}</td>`;\n\t\t\thtmlTable += `<td>${value.state}</td>`;\n\t\t\thtmlTable += '</tr>';\n\t\t});\n\t\thtmlTable += '</table>';\n\t\tDebuggerInfo.UpdateContent(htmlTable);\n\t\tconst uniqid = provider.$formObj.form('get value', 'uniqid');\n\t\tconst result = $.grep(response, (e) => {\n\t\t\tconst respid = e.id;\n\t\t\treturn respid.toUpperCase() === uniqid.toUpperCase();\n\t\t});\n\t\tif (result.length === 0) {\n\t\t\t// not found\n\t\t\tprovidersStatusLoopWorker.$status.removeClass('green').removeClass('yellow').addClass('grey');\n\t\t} else if (result[0] !== undefined && result[0].state.toUpperCase() === 'REGISTERED') {\n\t\t\tprovidersStatusLoopWorker.$status.removeClass('grey').removeClass('yellow').addClass('green');\n\t\t} else if (result[0] !== undefined && result[0].state.toUpperCase() === 'OK') {\n\t\t\tprovidersStatusLoopWorker.$status.removeClass('grey').removeClass('green').addClass('yellow');\n\t\t} else {\n\t\t\tprovidersStatusLoopWorker.$status.removeClass('green').removeClass('yellow').addClass('grey');\n\t\t}\n\n\t\tif (providersStatusLoopWorker.$status.hasClass('green')) {\n\t\t\tprovidersStatusLoopWorker.$status.html(globalTranslate.pr_Online);\n\t\t} else if (providersStatusLoopWorker.$status.hasClass('yellow')) {\n\t\t\tprovidersStatusLoopWorker.$status.html(globalTranslate.pr_WithoutRegistration);\n\t\t} else {\n\t\t\tprovidersStatusLoopWorker.$status.html(globalTranslate.pr_Offline);\n\t\t}\n\t},\n};\n\n\n$(document).ready(() => {\n\tprovider.initialize();\n\tprovidersStatusLoopWorker.initialize();\n});\n"],"file":"provider-modify.js"}