{"version":3,"sources":["../../src/Providers/providers-index.js"],"names":["providers","$deleteModalForm","$","initialize","modal","checkbox","onChecked","uniqid","closest","attr","api","url","globalRootUrl","on","urlData","type","onSuccess","response","success","removeClass","onUnchecked","addClass","e","id","target","window","location","preventDefault","linksExist","closable","onDeny","onApprove","providersStatusLoopWorker","timeOut","timeOutHandle","providerStatuses","DebuggerInfo","previousStatuses","sessionStorage","getItem","JSON","parse","restartWorker","clearTimeout","timeoutHandle","worker","PbxApi","GetSipProvidersStatuses","cbRefreshProvidersStatus","GetIaxProvidersStatuses","setTimeout","length","each","key","value","state","undefined","toUpperCase","setItem","stringify","refreshVisualisation","htmlTable","UpdateContent","green","grey","yellow","index","obj","find","html","text","document","ready"],"mappings":"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","sourcesContent":["/*\n * Copyright (C) MIKO LLC - All Rights Reserved\n * Unauthorized copying of this file, via any medium is strictly prohibited\n * Proprietary and confidential\n * Written by Nikolay Beketov, 5 2018\n *\n */\n\n/* global globalRootUrl, PbxApi, DebuggerInfo */\n\nconst providers = {\n\t$deleteModalForm: $('#delete-modal-form'),\n\tinitialize() {\n\t\tproviders.$deleteModalForm.modal();\n\t\t$('.provider-row .checkbox')\n\t\t\t.checkbox({\n\t\t\t\tonChecked() {\n\t\t\t\t\tconst uniqid = $(this).closest('tr').attr('id');\n\t\t\t\t\t$.api({\n\t\t\t\t\t\turl: `${globalRootUrl}providers/enable/{type}/{uniqid}`,\n\t\t\t\t\t\ton: 'now',\n\t\t\t\t\t\turlData: {\n\t\t\t\t\t\t\ttype: $(this).closest('tr').attr('data-value'),\n\t\t\t\t\t\t\tuniqid,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tonSuccess(response) {\n\t\t\t\t\t\t\tif (response.success) {\n\t\t\t\t\t\t\t\t$(`#${uniqid} .disability`).removeClass('disabled');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tonUnchecked() {\n\t\t\t\t\tconst uniqid = $(this).closest('tr').attr('id');\n\t\t\t\t\t$.api({\n\t\t\t\t\t\turl: `${globalRootUrl}providers/disable/{type}/{uniqid}`,\n\t\t\t\t\t\ton: 'now',\n\t\t\t\t\t\turlData: {\n\t\t\t\t\t\t\ttype: $(this).closest('tr').attr('data-value'),\n\t\t\t\t\t\t\tuniqid,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tonSuccess(response) {\n\t\t\t\t\t\t\tif (response.success) {\n\t\t\t\t\t\t\t\t$(`#${uniqid} .disability`).addClass('disabled');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t});\n\n\t\t$('.provider-row td').on('dblclick', (e) => {\n\t\t\tconst id = $(e.target).closest('tr').attr('id');\n\t\t\tconst type = $(e.target).closest('tr').attr('data-value');\n\t\t\twindow.location = `${globalRootUrl}providers/modify${type}/${id}`;\n\t\t});\n\n\t\t$('body').on('click', '.provider-row a.delete', (e) => {\n\t\t\te.preventDefault();\n\t\t\tconst linksExist = $(e.target).closest('tr').attr('data-links');\n\t\t\tif (linksExist === 'true') {\n\t\t\t\tproviders.$deleteModalForm\n\t\t\t\t\t.modal({\n\t\t\t\t\t\tclosable: false,\n\t\t\t\t\t\tonDeny: () => true,\n\t\t\t\t\t\tonApprove: () => {\n\t\t\t\t\t\t\twindow.location = $(e.target).closest('a').attr('href');\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t},\n\t\t\t\t\t})\n\t\t\t\t\t.modal('show');\n\t\t\t} else {\n\t\t\t\twindow.location = $(e.target).closest('a').attr('href');\n\t\t\t}\n\n\t\t});\n\t},\n};\nconst providersStatusLoopWorker = {\n\ttimeOut: 3000,\n\ttimeOutHandle: '',\n\tproviderStatuses: {},\n\tinitialize() {\n\t\t// Запустим обновление статуса провайдера\n\t\tDebuggerInfo.initialize();\n\t\tconst previousStatuses = sessionStorage.getItem('ProviderStatuses');\n\t\tif (previousStatuses !== null) {\n\t\t\tprovidersStatusLoopWorker.providerStatuses = JSON.parse(previousStatuses);\n\t\t}\n\t\tprovidersStatusLoopWorker.restartWorker();\n\t},\n\trestartWorker() {\n\t\twindow.clearTimeout(providersStatusLoopWorker.timeoutHandle);\n\t\tprovidersStatusLoopWorker.worker();\n\t},\n\tworker() {\n\t\twindow.clearTimeout(providersStatusLoopWorker.timeoutHandle);\n\t\tPbxApi.GetSipProvidersStatuses(providersStatusLoopWorker.cbRefreshProvidersStatus);\n\t\tPbxApi.GetIaxProvidersStatuses(providersStatusLoopWorker.cbRefreshProvidersStatus);\n\t},\n\t/**\n\t * Накопление информации о статусах провайдеров\n\t */\n\tcbRefreshProvidersStatus(response) {\n\t\tprovidersStatusLoopWorker.timeoutHandle =\n\t\t\twindow.setTimeout(providersStatusLoopWorker.worker, providersStatusLoopWorker.timeOut);\n\t\tif (response.length === 0 || response === false) return;\n\t\t$.each(response, (key, value) => {\n\t\t\tif (value.state !== undefined) {\n\t\t\t\tprovidersStatusLoopWorker.providerStatuses[value.id] = value.state.toUpperCase();\n\t\t\t}\n\t\t});\n\t\tsessionStorage.setItem('ProviderStatuses', JSON.stringify(providersStatusLoopWorker.providerStatuses));\n\t\tprovidersStatusLoopWorker.refreshVisualisation();\n\t},\n\t/**\n\t * Обновление информации в таблице провайдеров\n\t */\n\trefreshVisualisation() {\n\t\tlet htmlTable = '<table class=\"ui very compact table\">';\n\t\t$.each(providersStatusLoopWorker.providerStatuses, (key, value) => {\n\t\t\thtmlTable += '<tr>';\n\t\t\thtmlTable += `<td>${key}</td>`;\n\t\t\thtmlTable += `<td>${value}</td>`;\n\t\t\thtmlTable += '</tr>';\n\t\t});\n\t\thtmlTable += '</table>';\n\t\tDebuggerInfo.UpdateContent(htmlTable);\n\t\tconst green = '<a class=\"ui green empty circular label \"></a>';\n\t\tconst grey = '<a class=\"ui grey empty circular label \"></a>';\n\t\tconst yellow = '<a class=\"ui yellow empty circular label \"></a>';\n\t\t$('tr.provider-row').each((index, obj) => {\n\t\t\tconst uniqid = $(obj).attr('id');\n\t\t\tif (providersStatusLoopWorker.providerStatuses[uniqid] !== undefined) {\n\t\t\t\tswitch (providersStatusLoopWorker.providerStatuses[uniqid]) {\n\t\t\t\t\tcase 'REGISTERED':\n\t\t\t\t\t\t$(obj).find('.provider-status').html(green);\n\t\t\t\t\t\t$(obj).find('.failure').text('');\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'OK':\n\t\t\t\t\t\t$(obj).find('.provider-status').html(yellow);\n\t\t\t\t\t\t$(obj).find('.failure').text('');\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'OFF':\n\t\t\t\t\t\t$(obj).find('.provider-status').html(grey);\n\t\t\t\t\t\t$(obj).find('.failure').text('');\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\t$(obj).find('.provider-status').html(grey);\n\t\t\t\t\t\t$(obj).find('.failure').text(providersStatusLoopWorker.providerStatuses[uniqid]);\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t$(obj).find('.provider-status').html(grey);\n\t\t\t}\n\t\t});\n\t},\n};\n\n$(document).ready(() => {\n\tproviders.initialize();\n\tprovidersStatusLoopWorker.initialize();\n});\n"],"file":"providers-index.js"}