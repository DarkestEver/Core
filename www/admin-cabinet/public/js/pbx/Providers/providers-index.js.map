{"version":3,"sources":["../../src/Providers/providers-index.js"],"names":["providers","initialize","$","checkbox","onChecked","uniqid","closest","attr","api","url","globalRootUrl","on","urlData","type","onSuccess","response","success","removeClass","onUnchecked","addClass","e","id","target","window","location","providersStatusLoopWorker","timeOut","timeOutHandle","providerStatuses","DebuggerInfo","previousStatuses","sessionStorage","getItem","JSON","parse","restartWorker","clearTimeout","timeoutHandle","worker","PbxApi","GetSipProvidersStatuses","cbRefreshProvidersStatus","GetIaxProvidersStatuses","setTimeout","length","each","key","value","state","undefined","toUpperCase","setItem","stringify","refreshVisualisation","htmlTable","UpdateContent","green","grey","yellow","index","obj","find","html","text","document","ready"],"mappings":"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","sourcesContent":["/*\n * Copyright (C) MIKO LLC - All Rights Reserved\n * Unauthorized copying of this file, via any medium is strictly prohibited\n * Proprietary and confidential\n * Written by Nikolay Beketov, 5 2018\n *\n */\n\n/* global globalRootUrl, PbxApi, DebuggerInfo */\n\nconst providers = {\n\tinitialize() {\n\t\t$('.provider-row .checkbox')\n\t\t\t.checkbox({\n\t\t\t\tonChecked() {\n\t\t\t\t\tconst uniqid = $(this).closest('tr').attr('id');\n\t\t\t\t\t$.api({\n\t\t\t\t\t\turl: `${globalRootUrl}providers/enable/{type}/{uniqid}`,\n\t\t\t\t\t\ton: 'now',\n\t\t\t\t\t\turlData: {\n\t\t\t\t\t\t\ttype: $(this).closest('tr').attr('data-value'),\n\t\t\t\t\t\t\tuniqid,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tonSuccess(response) {\n\t\t\t\t\t\t\tif (response.success) {\n\t\t\t\t\t\t\t\t$(`#${uniqid} .disability`).removeClass('disabled');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tonUnchecked() {\n\t\t\t\t\tconst uniqid = $(this).closest('tr').attr('id');\n\t\t\t\t\t$.api({\n\t\t\t\t\t\turl: `${globalRootUrl}providers/disable/{type}/{uniqid}`,\n\t\t\t\t\t\ton: 'now',\n\t\t\t\t\t\turlData: {\n\t\t\t\t\t\t\ttype: $(this).closest('tr').attr('data-value'),\n\t\t\t\t\t\t\tuniqid,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tonSuccess(response) {\n\t\t\t\t\t\t\tif (response.success) {\n\t\t\t\t\t\t\t\t$(`#${uniqid} .disability`).addClass('disabled');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t});\n\n\t\t$('.provider-row td').on('dblclick', (e) => {\n\t\t\tconst id = $(e.target).closest('tr').attr('id');\n\t\t\tconst type = $(e.target).closest('tr').attr('data-value');\n\t\t\twindow.location = `${globalRootUrl}providers/modify${type}/${id}`;\n\t\t});\n\t},\n};\nconst providersStatusLoopWorker = {\n\ttimeOut: 3000,\n\ttimeOutHandle: '',\n\tproviderStatuses: {},\n\tinitialize() {\n\t\t// Запустим обновление статуса провайдера\n\t\tDebuggerInfo.initialize();\n\t\tconst previousStatuses = sessionStorage.getItem('ProviderStatuses');\n\t\tif (previousStatuses !== null) {\n\t\t\tprovidersStatusLoopWorker.providerStatuses = JSON.parse(previousStatuses);\n\t\t}\n\t\tprovidersStatusLoopWorker.restartWorker();\n\t},\n\trestartWorker() {\n\t\twindow.clearTimeout(providersStatusLoopWorker.timeoutHandle);\n\t\tprovidersStatusLoopWorker.worker();\n\t},\n\tworker() {\n\t\twindow.clearTimeout(providersStatusLoopWorker.timeoutHandle);\n\t\tPbxApi.GetSipProvidersStatuses(providersStatusLoopWorker.cbRefreshProvidersStatus);\n\t\tPbxApi.GetIaxProvidersStatuses(providersStatusLoopWorker.cbRefreshProvidersStatus);\n\t},\n\t/**\n\t * Накопление информации о статусах провайдеров\n\t */\n\tcbRefreshProvidersStatus(response) {\n\t\tprovidersStatusLoopWorker.timeoutHandle =\n\t\t\twindow.setTimeout(providersStatusLoopWorker.worker, providersStatusLoopWorker.timeOut);\n\t\tif (response.length === 0 || response === false) return;\n\t\t$.each(response, (key, value) => {\n\t\t\tif (value.state !== undefined) {\n\t\t\t\tprovidersStatusLoopWorker.providerStatuses[value.id] = value.state.toUpperCase();\n\t\t\t}\n\t\t});\n\t\tsessionStorage.setItem('ProviderStatuses', JSON.stringify(providersStatusLoopWorker.providerStatuses));\n\t\tprovidersStatusLoopWorker.refreshVisualisation();\n\t},\n\t/**\n\t * Обновление информации в таблице провайдеров\n\t */\n\trefreshVisualisation() {\n\t\tlet htmlTable = '<table class=\"ui very compact table\">';\n\t\t$.each(providersStatusLoopWorker.providerStatuses, (key, value) => {\n\t\t\thtmlTable += '<tr>';\n\t\t\thtmlTable += `<td>${key}</td>`;\n\t\t\thtmlTable += `<td>${value}</td>`;\n\t\t\thtmlTable += '</tr>';\n\t\t});\n\t\thtmlTable += '</table>';\n\t\tDebuggerInfo.UpdateContent(htmlTable);\n\t\tconst green = '<a class=\"ui green empty circular label \"></a>';\n\t\tconst grey = '<a class=\"ui grey empty circular label \"></a>';\n\t\tconst yellow = '<a class=\"ui yellow empty circular label \"></a>';\n\t\t$('tr.provider-row').each((index, obj) => {\n\t\t\tconst uniqid = $(obj).attr('id');\n\t\t\tif (providersStatusLoopWorker.providerStatuses[uniqid] !== undefined) {\n\t\t\t\tswitch (providersStatusLoopWorker.providerStatuses[uniqid]) {\n\t\t\t\t\tcase 'REGISTERED':\n\t\t\t\t\t\t$(obj).find('.provider-status').html(green);\n\t\t\t\t\t\t$(obj).find('.failure').text('');\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'OK':\n\t\t\t\t\t\t$(obj).find('.provider-status').html(yellow);\n\t\t\t\t\t\t$(obj).find('.failure').text('');\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'OFF':\n\t\t\t\t\t\t$(obj).find('.provider-status').html(grey);\n\t\t\t\t\t\t$(obj).find('.failure').text('');\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\t$(obj).find('.provider-status').html(grey);\n\t\t\t\t\t\t$(obj).find('.failure').text(providersStatusLoopWorker.providerStatuses[uniqid]);\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t$(obj).find('.provider-status').html(grey);\n\t\t\t}\n\t\t});\n\t},\n};\n\n$(document).ready(() => {\n\tproviders.initialize();\n\tprovidersStatusLoopWorker.initialize();\n});\n"],"file":"providers-index.js"}