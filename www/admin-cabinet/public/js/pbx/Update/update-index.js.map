{"version":3,"sources":["../../src/Update/update-index.js"],"names":["upgradeStatusLoopWorker","timeOut","timeOutHandle","iterations","initialize","restartWorker","window","clearTimeout","timeoutHandle","worker","PbxApi","SystemGetUpgradeStatus","cbRefreshUpgradeStatus","response","setTimeout","length","d_status","$","closest","find","text","d_status_progress","addClass","removeClass","UserMessage","showError","globalTranslate","upd_DownloadUpgradeError","updatePBX","$formObj","$submitButton","$progressBar","$progressBarLabel","currentVersion","globalPBXVersion","$restoreModalForm","upgradeInProgress","converter","showdown","Converter","modal","on","e","target","parents","click","files","undefined","filename","name","parent","val","preventDefault","hasClass","form","fields","validateRules","onSuccess","closable","onDeny","onApprove","ConfigWorker","stopConfigWorker","data","SystemUpgrade","cbAfterUploadFile","requestData","TYPE","PBXVER","LANGUAGE","globalPBXLanguage","api","url","method","successTest","Object","keys","result","toUpperCase","currentVerison","replace","firmware","forEach","obj","version","AddNewVersionInformation","params","$aLink","updateLink","attr","md5","size","SystemUpgradeOnline","upd_UploadError","progress","percent","parseInt","upd_UploadInProgress","upd_UpgradeInProgress","show","markdownText","decodeURIComponent","description","html","makeHtml","dymanicRow","href","bt_ToolTipUpgradeOnline","bt_ToolTipDownload","append","popup","document","ready"],"mappings":"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","sourcesContent":["/*\n * Copyright (C) MIKO LLC - All Rights Reserved\n * Unauthorized copying of this file, via any medium is strictly prohibited\n * Proprietary and confidential\n * Written by Nikolay Beketov, 7 2018\n *\n */\n\n/* global PbxApi, globalPBXVersion, globalTranslate, ConfigWorker,\nglobalPBXLanguage, globalPBXVersion, showdown, UserMessage */\n\nconst upgradeStatusLoopWorker = {\n\ttimeOut: 1000,\n\ttimeOutHandle: '',\n\titerations: 0,\n\tinitialize() {\n\t\tupgradeStatusLoopWorker.iterations = 0;\n\t\tupgradeStatusLoopWorker.restartWorker();\n\t},\n\trestartWorker() {\n\t\twindow.clearTimeout(upgradeStatusLoopWorker.timeoutHandle);\n\t\tupgradeStatusLoopWorker.worker();\n\t},\n\tworker() {\n\t\twindow.clearTimeout(upgradeStatusLoopWorker.timeoutHandle);\n\t\tPbxApi.SystemGetUpgradeStatus(upgradeStatusLoopWorker.cbRefreshUpgradeStatus);\n\t},\n\tcbRefreshUpgradeStatus(response) {\n\t\tupgradeStatusLoopWorker.iterations += 1;\n\t\tupgradeStatusLoopWorker.timeoutHandle =\n\t\t\twindow.setTimeout(upgradeStatusLoopWorker.worker, upgradeStatusLoopWorker.timeOut);\n\t\tif (response.length === 0 || response === false) return;\n\t\tif (response.d_status === 'DOWNLOAD_IN_PROGRESS') {\n\t\t\t$('i.loading.redo').closest('a').find('.percent').text(`${response.d_status_progress}%`);\n\t\t} else if (response.d_status === 'DOWNLOAD_COMPLETE') {\n\t\t\twindow.clearTimeout(upgradeStatusLoopWorker.timeoutHandle);\n\t\t\t$('i.loading.redo').closest('a').find('.percent').text(`${response.d_status_progress}%`);\n\t\t\t$('i.loading.redo').addClass('sync').removeClass('redo');\n\t\t} else if (response.d_status === 'DOWNLOAD_ERROR') {\n\t\t\twindow.clearTimeout(upgradeStatusLoopWorker.timeoutHandle);\n\t\t\tUserMessage.showError(globalTranslate.upd_DownloadUpgradeError);\n\t\t\t$('i.loading.redo').addClass('redo').removeClass('loading');\n\t\t}\n\t},\n};\n\n\nconst updatePBX = {\n\t$formObj: $('#upgrade-form'),\n\t$submitButton: $('#submitbutton'),\n\t$progressBar: $('#upload-progress-bar'),\n\t$progressBarLabel: $('#upload-progress-bar').find('.label'),\n\tcurrentVersion: globalPBXVersion,\n\t$restoreModalForm: $('#update-modal-form'),\n\tupgradeInProgress: false,\n\tconverter: new showdown.Converter(),\n\tinitialize() {\n\t\tupdatePBX.$restoreModalForm.modal();\n\t\tupdatePBX.$submitButton.addClass('disabled');\n\t\t$('input:text, .ui.button', '.ui.action.input').on('click', (e) => {\n\t\t\t$('input:file', $(e.target).parents()).click();\n\t\t});\n\n\t\t$('input:file', '.ui.action.input').on('change', (e) => {\n\t\t\tif (e.target.files[0] !== undefined) {\n\t\t\t\tconst filename = e.target.files[0].name;\n\t\t\t\t$('input:text', $(e.target).parent()).val(filename);\n\t\t\t\tupdatePBX.$submitButton.removeClass('disabled');\n\t\t\t}\n\t\t});\n\t\tupdatePBX.$submitButton.on('click', (e) => {\n\t\t\te.preventDefault();\n\t\t\tif (updatePBX.$submitButton.hasClass('loading') || updatePBX.upgradeInProgress) return;\n\n\t\t\tupdatePBX.$formObj\n\t\t\t\t.form({\n\t\t\t\t\ton: 'blur',\n\t\t\t\t\tfields: updatePBX.validateRules,\n\t\t\t\t\tonSuccess() {\n\t\t\t\t\t\tupdatePBX.$restoreModalForm\n\t\t\t\t\t\t\t.modal({\n\t\t\t\t\t\t\t\tclosable: false,\n\t\t\t\t\t\t\t\tonDeny: () => true,\n\t\t\t\t\t\t\t\tonApprove: () => {\n\t\t\t\t\t\t\t\t\tConfigWorker.stopConfigWorker();\n\t\t\t\t\t\t\t\t\tupdatePBX.$submitButton.addClass('loading');\n\t\t\t\t\t\t\t\t\tupdatePBX.upgradeInProgress = true;\n\t\t\t\t\t\t\t\t\tconst data = $('input:file')[0].files[0];\n\t\t\t\t\t\t\t\t\tPbxApi.SystemUpgrade(data, updatePBX.cbAfterUploadFile);\n\t\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.modal('show');\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\tupdatePBX.$formObj.form('validate form');\n\t\t});\n\t\tconst requestData = {\n\t\t\tTYPE: 'FIRMWARE',\n\t\t\tPBXVER: globalPBXVersion,\n\t\t\tLANGUAGE: globalPBXLanguage,\n\t\t};\n\t\t$.api({\n\t\t\turl: 'https://update.askozia.ru',\n\t\t\ton: 'now',\n\t\t\tmethod: 'POST',\n\t\t\tdata: requestData,\n\t\t\tsuccessTest(response) {\n\t\t\t\t// test whether a JSON response is valid\n\t\t\t\treturn response !== undefined\n\t\t\t\t\t&& Object.keys(response).length > 0\n\t\t\t\t\t&& response.result.toUpperCase() === 'SUCCESS';\n\t\t\t},\n\t\t\tonSuccess(response) {\n\t\t\t\tconst currentVerison = updatePBX.currentVersion.replace(/\\D/g, '');\n\t\t\t\tresponse.firmware.forEach((obj) => {\n\t\t\t\t\tconst version = obj.version.replace(/\\D/g, '');\n\t\t\t\t\tif (version > currentVerison) {\n\t\t\t\t\t\tupdatePBX.AddNewVersionInformation(obj);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\t$('a.redo').on('click', (e) => {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tif (updatePBX.$submitButton.hasClass('loading') || updatePBX.upgradeInProgress) return;\n\t\t\t\t\tupdatePBX.$restoreModalForm\n\t\t\t\t\t\t.modal({\n\t\t\t\t\t\t\tclosable: false,\n\t\t\t\t\t\t\tonDeny: () => true,\n\t\t\t\t\t\t\tonApprove: () => {\n\t\t\t\t\t\t\t\tConfigWorker.stopConfigWorker();\n\t\t\t\t\t\t\t\tconst params = [];\n\t\t\t\t\t\t\t\tconst $aLink = $(e.target).closest('a');\n\t\t\t\t\t\t\t\tparams.updateLink = $aLink.attr('href');\n\t\t\t\t\t\t\t\tparams.md5 = $aLink.attr('data-md5');\n\t\t\t\t\t\t\t\tparams.size = $aLink.attr('data-size');\n\t\t\t\t\t\t\t\t$aLink.find('i').addClass('loading');\n\t\t\t\t\t\t\t\tupdatePBX.upgradeInProgress = true;\n\t\t\t\t\t\t\t\tPbxApi.SystemUpgradeOnline(params);\n\t\t\t\t\t\t\t\tupgradeStatusLoopWorker.initialize();\n\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.modal('show');\n\t\t\t\t});\n\t\t\t},\n\t\t});\n\t},\n\tcbAfterUploadFile(response) {\n\t\tif (response.length === 0 || response === false) {\n\t\t\tupdatePBX.$submitButton.removeClass('loading');\n\t\t\tupdatePBX.upgradeInProgress = false;\n\t\t\tUserMessage.showError(globalTranslate.upd_UploadError);\n\t\t} else if (response.function === 'upload_progress') {\n\t\t\tupdatePBX.$progressBar.progress({\n\t\t\t\tpercent: parseInt(response.percent, 10),\n\t\t\t});\n\t\t\tif (response.percent < 100) {\n\t\t\t\tupdatePBX.$progressBarLabel.text(globalTranslate.upd_UploadInProgress);\n\t\t\t} else {\n\t\t\t\tupdatePBX.$progressBarLabel.text(globalTranslate.upd_UpgradeInProgress);\n\t\t\t}\n\n\t\t}\n\t},\n\tAddNewVersionInformation(obj) {\n\t\t$('#online-updates-block').show();\n\t\tlet markdownText = decodeURIComponent(obj.description);\n\t\tmarkdownText = markdownText.replace(/<br>/g, '\\r');\n\t\tmarkdownText = markdownText.replace(/<br >/g, '\\r');\n\t\tmarkdownText = markdownText.replace(/\\* \\*/g, '*');\n\t\tmarkdownText = markdownText.replace(/\\*\\*/g, '*');\n\t\tconst html = updatePBX.converter.makeHtml(markdownText);\n\t\tconst dymanicRow = `\n\t\t\t<tr class=\"update-row\">\n\t\t\t<td class=\"center aligned\">${obj.version}</td>\n\t\t\t<td>${html}</td>\n\t\t\t<td class=\"right aligned collapsing\">\n    \t\t<div class=\"ui small basic icon buttons action-buttons\">\n    \t\t\t<a href=\"${obj.href}\" class=\"ui button redo popuped\" \n    \t\t\t\tdata-content = \"${globalTranslate.bt_ToolTipUpgradeOnline}\"\n\t\t\t\t\tdata-md5 =\"${obj.md5}\" data-size =\"${obj.size}\">\n\t\t\t\t\t<i class=\"icon redo blue\"></i>\n\t\t\t\t\t<span class=\"percent\"></span>\n\t\t\t\t</a>\n\t\t\t\t<a href=\"${obj.href}\" class=\"ui button download popuped\" \n\t\t\t\t\tdata-content = \"${globalTranslate.bt_ToolTipDownload}\"\n\t\t\t\t\tdata-md5 =\"${obj.md5}\" data-size =\"${obj.size}\">\n\t\t\t\t\t<i class=\"icon download blue\"></i>\n\t\t\t\t</a>\n    \t\t</div>   \n\t</tr>`;\n\t\t$('#updates-table tbody').append(dymanicRow);\n\t\t$('a.popuped').popup();\n\t},\n};\n\n\n$(document).ready(() => {\n\tupdatePBX.initialize();\n});\n\n"],"file":"update-index.js"}