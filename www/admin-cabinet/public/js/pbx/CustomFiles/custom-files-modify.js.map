{"version":3,"sources":["../../src/CustomFiles/custom-files-modify.js"],"names":["customFile","$formObj","$","$appCode","$appCodeFromServer","editor","viewer","validateRules","name","identifier","rules","type","prompt","globalTranslate","cf_ValidateNameIsEmpty","initialize","dropdown","onChange","hideShowCode","getFileContentFromServer","initializeAce","initializeForm","form","navigateFileStart","show","hide","navigateFileEnd","setValue","getValue","cbGetFileContentFromServer","response","undefined","data","length","fileContent","decodeURIComponent","filePath","mode","filename","needOriginal","PbxApi","GetFileContent","IniMode","ace","require","Mode","edit","setReadOnly","session","setMode","setTheme","resize","cbBeforeSendForm","settings","result","content","cbAfterSendForm","Form","url","globalRootUrl","enableDirrity","document","ready"],"mappings":"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","sourcesContent":["/*\n * Copyright (C) MIKO LLC - All Rights Reserved\n * Unauthorized copying of this file, via any medium is strictly prohibited\n * Proprietary and confidential\n * Written by Nikolay Beketov, 5 2018\n *\n */\n\n/* global globalRootUrl,globalTranslate, ace, Form, PbxApi */\n\nconst customFile = {\n\t$formObj: $('#custom-file-form'),\n\t$appCode: $('#application-code'),\n\t$appCodeFromServer: $('#application-code-readonly'),\n\teditor: '',\n\tviewer: '',\n\tvalidateRules: {\n\t\tname: {\n\t\t\tidentifier: 'filepath',\n\t\t\trules: [\n\t\t\t\t{\n\t\t\t\t\ttype: 'empty',\n\t\t\t\t\tprompt: globalTranslate.cf_ValidateNameIsEmpty,\n\t\t\t\t},\n\t\t\t],\n\t\t},\n\t},\n\tinitialize() {\n\t\t$('.type-select').dropdown({\n\t\t\tonChange() {\n\t\t\t\tcustomFile.hideShowCode();\n\t\t\t\tcustomFile.getFileContentFromServer();\n\t\t\t},\n\t\t});\n\n\t\tcustomFile.initializeAce();\n\t\tcustomFile.initializeForm();\n\t\tcustomFile.getFileContentFromServer();\n\t},\n\thideShowCode() {\n\t\tswitch (customFile.$formObj.form('get value', 'mode')) {\n\t\t\tcase 'none':\n\t\t\t\tcustomFile.viewer.navigateFileStart();\n\t\t\t\tcustomFile.$appCodeFromServer.show();\n\t\t\t\tcustomFile.$appCode.hide();\n\t\t\t\tbreak;\n\t\t\tcase 'append':\n\t\t\t\tcustomFile.$appCodeFromServer.show();\n\t\t\t\tcustomFile.viewer.navigateFileEnd();\n\t\t\t\tcustomFile.editor.setValue(customFile.$formObj.form('get value', 'content'));\n\t\t\t\tcustomFile.$appCode.show();\n\t\t\t\tbreak;\n\t\t\tcase 'override':\n\t\t\t\tcustomFile.editor.navigateFileStart();\n\t\t\t\tcustomFile.$appCodeFromServer.hide();\n\t\t\t\tcustomFile.editor.setValue(customFile.viewer.getValue());\n\t\t\t\tcustomFile.$appCode.show();\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tbreak;\n\t\t}\n\t},\n\tcbGetFileContentFromServer(response) {\n\t\tif (response !== undefined && response.data.length > 0) {\n\t\t\tconst fileContent = decodeURIComponent(response.data);\n\t\t\tcustomFile.viewer.setValue(fileContent);\n\t\t\tcustomFile.hideShowCode();\n\t\t}\n\t},\n\tgetFileContentFromServer() {\n\t\tconst filePath = customFile.$formObj.form('get value', 'filepath');\n\t\tconst mode = customFile.$formObj.form('get value', 'mode') !== 'override';\n\t\tconst data = { filename: filePath, needOriginal: mode };\n\t\tPbxApi.GetFileContent(data, customFile.cbGetFileContentFromServer);\n\t},\n\tinitializeAce() {\n\t\tconst IniMode = ace.require('ace/mode/julia').Mode;\n\t\tcustomFile.viewer = ace.edit('application-code-readonly');\n\t\tcustomFile.viewer.setReadOnly(true);\n\t\tcustomFile.viewer.session.setMode(new IniMode());\n\t\tcustomFile.viewer.setTheme('ace/theme/monokai');\n\t\tcustomFile.viewer.resize();\n\n\t\tcustomFile.editor = ace.edit('application-code');\n\t\tcustomFile.editor.setTheme('ace/theme/monokai');\n\t\tcustomFile.editor.session.setMode(new IniMode());\n\t\tcustomFile.editor.resize();\n\t},\n\tcbBeforeSendForm(settings) {\n\t\tconst result = settings;\n\t\tresult.data = customFile.$formObj.form('get values');\n\t\tswitch (customFile.$formObj.form('get value', 'mode')) {\n\t\t\tcase 'append':\n\t\t\tcase 'override':\n\t\t\t\tresult.data.content = customFile.editor.getValue();\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tresult.data.content = '';\n\t\t}\n\t\treturn result;\n\t},\n\tcbAfterSendForm() {\n\n\t},\n\tinitializeForm() {\n\t\tForm.$formObj = customFile.$formObj;\n\t\tForm.url = `${globalRootUrl}custom-files/save`;\n\t\tForm.validateRules = customFile.validateRules;\n\t\tForm.cbBeforeSendForm = customFile.cbBeforeSendForm;\n\t\tForm.cbAfterSendForm = customFile.cbAfterSendForm;\n\t\tForm.enableDirrity = false;\n\t\tForm.initialize();\n\t},\n};\n\n$(document).ready(() => {\n\tcustomFile.initialize();\n});\n\n"],"file":"custom-files-modify.js"}