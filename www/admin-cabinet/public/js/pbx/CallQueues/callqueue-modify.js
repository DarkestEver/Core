"use strict";

/*
 * Copyright (C) MIKO LLC - All Rights Reserved
 * Unauthorized copying of this file, via any medium is strictly prohibited
 * Proprietary and confidential
 * Written by Nikolay Beketov, 12 2019
 *
 */

/* global globalRootUrl, globalTranslate, Extensions,Form  */
// Проверка нет ли ошибки занятого другой учеткой номера
$.fn.form.settings.rules.existRule = function (value, parameter) {
  return $("#".concat(parameter)).hasClass('hidden');
};

var callQueue = {
  defaultExtension: '',
  $number: $('#extension'),
  $dirrtyField: $('#dirrty'),
  AvailableMembersList: [],
  $formObj: $('#queue-form'),
  $errorMessages: $('#form-error-messages'),
  validateRules: {
    name: {
      identifier: 'name',
      rules: [{
        type: 'empty',
        prompt: globalTranslate.cq_ValidateNameEmpty
      }]
    },
    extension: {
      identifier: 'extension',
      rules: [{
        type: 'empty',
        prompt: globalTranslate.cq_ValidateExtensionEmpty
      }, {
        type: 'existRule[extension-error]',
        prompt: globalTranslate.cq_ValidateExtensionDouble
      }]
    }
  },
  initialize: function () {
    function initialize() {
      Extensions.getPhoneExtensions(callQueue.setAvailableQueueMembers);
      callQueue.defaultExtension = $('#extension').val();
      $('.ui.accordion').accordion();
      $('.dropdown').dropdown();
      $('.checkbox').checkbox();
      $('.periodic-announce-sound-id-select').dropdown({
        onChange: function () {
          function onChange(value) {
            if (parseInt(value, 10) === -1) $(this).dropdown('clear'); // console.log(value);
          }

          return onChange;
        }()
      });
      $('.forwarding-select').dropdown(Extensions.getDropdownSettingsWithEmpty());
      Extensions.fixBugDropdownIcon(); // Динамическая прововерка свободен ли внутренний номер

      callQueue.$number.on('change', function () {
        var newNumber = callQueue.$formObj.form('get value', 'extension');
        Extensions.checkAvailability(callQueue.defaultNumber, newNumber);
      });
      callQueue.initializeDragAndDropExtensionTableRows(); // Удаление строки из таблицы участников очереди

      $('.delete-row-button').on('click', function (e) {
        $(e.target).closest('tr').remove();
        callQueue.reinitializeExtensionSelect();
        callQueue.updateExtensionTableView();
        callQueue.$dirrtyField.val(Math.random());
        callQueue.$dirrtyField.trigger('change');
        e.preventDefault();
        return false;
      });
      callQueue.initializeForm();
    }

    return initialize;
  }(),
  setAvailableQueueMembers: function () {
    function setAvailableQueueMembers(arrResult) {
      $.each(arrResult.results, function (index, extension) {
        callQueue.AvailableMembersList.push({
          number: extension.value,
          callerid: extension.name
        });
      });
      callQueue.reinitializeExtensionSelect();
      callQueue.updateExtensionTableView();
    }

    return setAvailableQueueMembers;
  }(),
  // Вернуть список доступных членов очереди
  getAvailableQueueMembers: function () {
    function getAvailableQueueMembers() {
      var result = [];
      callQueue.AvailableMembersList.forEach(function (member) {
        if ($(".member-row#".concat(member.number)).length === 0) {
          result.push({
            name: member.callerid,
            value: member.number
          });
        }
      }); // result.sort((a, b) => ((a.name > b.name) ? 1 : ((b.name > a.name) ? -1 : 0)));

      return result;
    }

    return getAvailableQueueMembers;
  }(),
  // Пересобрать членов очереди с учетом уже выбранных
  reinitializeExtensionSelect: function () {
    function reinitializeExtensionSelect() {
      $('#extensionselect').dropdown({
        action: 'hide',
        forceSelection: false,
        onChange: function () {
          function onChange(value, text) {
            if (value) {
              var $tr = $('.member-row-tpl').last();
              var $clone = $tr.clone(true);
              $clone.removeClass('member-row-tpl').addClass('member-row').show();
              $clone.attr('id', value);
              $clone.find('.number').html(value);
              $clone.find('.callerid').html(text);

              if ($('.member-row').last().length === 0) {
                $tr.after($clone);
              } else {
                $('.member-row').last().after($clone);
              }

              callQueue.reinitializeExtensionSelect();
              callQueue.updateExtensionTableView();
              callQueue.$dirrtyField.val(Math.random());
              callQueue.$dirrtyField.trigger('change');
            }
          }

          return onChange;
        }(),
        values: callQueue.getAvailableQueueMembers()
      });
    }

    return reinitializeExtensionSelect;
  }(),
  // Включить возможность перетаскивания элементов таблицы участников очереди
  initializeDragAndDropExtensionTableRows: function () {
    function initializeDragAndDropExtensionTableRows() {
      $('#extensionsTable').tableDnD({
        onDragClass: 'hoveringRow',
        dragHandle: '.dragHandle',
        onDrop: function () {
          function onDrop() {
            callQueue.$dirrtyField.val(Math.random());
            callQueue.$dirrtyField.trigger('change');
          }

          return onDrop;
        }()
      });
    }

    return initializeDragAndDropExtensionTableRows;
  }(),
  // Отобразить заглушку если в таблице 0 строк
  updateExtensionTableView: function () {
    function updateExtensionTableView() {
      var dummy = "<tr class=\"dummy\"><td colspan=\"4\" class=\"center aligned\">".concat(globalTranslate.cq_AddQueueMembers, "</td></tr>");

      if ($('.member-row').length === 0) {
        $('#extensionsTable tbody').append(dummy);
      } else {
        $('.dummy').remove();
      }
    }

    return updateExtensionTableView;
  }(),
  cbBeforeSendForm: function () {
    function cbBeforeSendForm(settings) {
      var result = settings;
      result.data = callQueue.$formObj.form('get values');
      var arrMembers = [];
      $('.member-row').each(function (index, obj) {
        if ($(obj).attr('id')) {
          arrMembers.push({
            number: $(obj).attr('id'),
            priority: index
          });
        }
      });

      if (arrMembers.length === 0) {
        result = false;
        callQueue.$errorMessages.html(globalTranslate.cq_ValidateNoExtensions);
        callQueue.$formObj.addClass('error');
      } else {
        result.data.members = JSON.stringify(arrMembers);
      }

      return result;
    }

    return cbBeforeSendForm;
  }(),
  cbAfterSendForm: function () {
    function cbAfterSendForm() {
      callQueue.defaultNumber = callQueue.$number.val();
    }

    return cbAfterSendForm;
  }(),
  initializeForm: function () {
    function initializeForm() {
      Form.$formObj = callQueue.$formObj;
      Form.url = "".concat(globalRootUrl, "call-queues/save");
      Form.validateRules = callQueue.validateRules;
      Form.cbBeforeSendForm = callQueue.cbBeforeSendForm;
      Form.cbAfterSendForm = callQueue.cbAfterSendForm;
      Form.initialize();
    }

    return initializeForm;
  }()
};
$(document).ready(function () {
  callQueue.initialize();
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9DYWxsUXVldWVzL2NhbGxxdWV1ZS1tb2RpZnkuanMiXSwibmFtZXMiOlsiJCIsImZuIiwiZm9ybSIsInNldHRpbmdzIiwicnVsZXMiLCJleGlzdFJ1bGUiLCJ2YWx1ZSIsInBhcmFtZXRlciIsImhhc0NsYXNzIiwiY2FsbFF1ZXVlIiwiZGVmYXVsdEV4dGVuc2lvbiIsIiRudW1iZXIiLCIkZGlycnR5RmllbGQiLCJBdmFpbGFibGVNZW1iZXJzTGlzdCIsIiRmb3JtT2JqIiwiJGVycm9yTWVzc2FnZXMiLCJ2YWxpZGF0ZVJ1bGVzIiwibmFtZSIsImlkZW50aWZpZXIiLCJ0eXBlIiwicHJvbXB0IiwiZ2xvYmFsVHJhbnNsYXRlIiwiY3FfVmFsaWRhdGVOYW1lRW1wdHkiLCJleHRlbnNpb24iLCJjcV9WYWxpZGF0ZUV4dGVuc2lvbkVtcHR5IiwiY3FfVmFsaWRhdGVFeHRlbnNpb25Eb3VibGUiLCJpbml0aWFsaXplIiwiRXh0ZW5zaW9ucyIsImdldFBob25lRXh0ZW5zaW9ucyIsInNldEF2YWlsYWJsZVF1ZXVlTWVtYmVycyIsInZhbCIsImFjY29yZGlvbiIsImRyb3Bkb3duIiwiY2hlY2tib3giLCJvbkNoYW5nZSIsInBhcnNlSW50IiwiZ2V0RHJvcGRvd25TZXR0aW5nc1dpdGhFbXB0eSIsImZpeEJ1Z0Ryb3Bkb3duSWNvbiIsIm9uIiwibmV3TnVtYmVyIiwiY2hlY2tBdmFpbGFiaWxpdHkiLCJkZWZhdWx0TnVtYmVyIiwiaW5pdGlhbGl6ZURyYWdBbmREcm9wRXh0ZW5zaW9uVGFibGVSb3dzIiwiZSIsInRhcmdldCIsImNsb3Nlc3QiLCJyZW1vdmUiLCJyZWluaXRpYWxpemVFeHRlbnNpb25TZWxlY3QiLCJ1cGRhdGVFeHRlbnNpb25UYWJsZVZpZXciLCJNYXRoIiwicmFuZG9tIiwidHJpZ2dlciIsInByZXZlbnREZWZhdWx0IiwiaW5pdGlhbGl6ZUZvcm0iLCJhcnJSZXN1bHQiLCJlYWNoIiwicmVzdWx0cyIsImluZGV4IiwicHVzaCIsIm51bWJlciIsImNhbGxlcmlkIiwiZ2V0QXZhaWxhYmxlUXVldWVNZW1iZXJzIiwicmVzdWx0IiwiZm9yRWFjaCIsIm1lbWJlciIsImxlbmd0aCIsImFjdGlvbiIsImZvcmNlU2VsZWN0aW9uIiwidGV4dCIsIiR0ciIsImxhc3QiLCIkY2xvbmUiLCJjbG9uZSIsInJlbW92ZUNsYXNzIiwiYWRkQ2xhc3MiLCJzaG93IiwiYXR0ciIsImZpbmQiLCJodG1sIiwiYWZ0ZXIiLCJ2YWx1ZXMiLCJ0YWJsZURuRCIsIm9uRHJhZ0NsYXNzIiwiZHJhZ0hhbmRsZSIsIm9uRHJvcCIsImR1bW15IiwiY3FfQWRkUXVldWVNZW1iZXJzIiwiYXBwZW5kIiwiY2JCZWZvcmVTZW5kRm9ybSIsImRhdGEiLCJhcnJNZW1iZXJzIiwib2JqIiwicHJpb3JpdHkiLCJjcV9WYWxpZGF0ZU5vRXh0ZW5zaW9ucyIsIm1lbWJlcnMiLCJKU09OIiwic3RyaW5naWZ5IiwiY2JBZnRlclNlbmRGb3JtIiwiRm9ybSIsInVybCIsImdsb2JhbFJvb3RVcmwiLCJkb2N1bWVudCIsInJlYWR5Il0sIm1hcHBpbmdzIjoiOztBQUFBOzs7Ozs7OztBQVFBO0FBRUE7QUFDQUEsQ0FBQyxDQUFDQyxFQUFGLENBQUtDLElBQUwsQ0FBVUMsUUFBVixDQUFtQkMsS0FBbkIsQ0FBeUJDLFNBQXpCLEdBQXFDLFVBQUNDLEtBQUQsRUFBUUMsU0FBUjtBQUFBLFNBQXNCUCxDQUFDLFlBQUtPLFNBQUwsRUFBRCxDQUFtQkMsUUFBbkIsQ0FBNEIsUUFBNUIsQ0FBdEI7QUFBQSxDQUFyQzs7QUFFQSxJQUFNQyxTQUFTLEdBQUc7QUFDakJDLEVBQUFBLGdCQUFnQixFQUFFLEVBREQ7QUFFakJDLEVBQUFBLE9BQU8sRUFBRVgsQ0FBQyxDQUFDLFlBQUQsQ0FGTztBQUdqQlksRUFBQUEsWUFBWSxFQUFFWixDQUFDLENBQUMsU0FBRCxDQUhFO0FBSWpCYSxFQUFBQSxvQkFBb0IsRUFBRSxFQUpMO0FBS2pCQyxFQUFBQSxRQUFRLEVBQUVkLENBQUMsQ0FBQyxhQUFELENB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QUFDaEI2QyxNQUFBQSxJQUFJLENBQUNwRixRQUFMLEdBQWdCTCxTQUFTLENBQUNLLFFBQTFCO0FBQ0FvRixNQUFBQSxJQUFJLENBQUNDLEdBQUwsYUFBY0MsYUFBZDtBQUNBRixNQUFBQSxJQUFJLENBQUNsRixhQUFMLEdBQXFCUCxTQUFTLENBQUNPLGFBQS9CO0FBQ0FrRixNQUFBQSxJQUFJLENBQUNWLGdCQUFMLEdBQXdCL0UsU0FBUyxDQUFDK0UsZ0JBQWxDO0FBQ0FVLE1BQUFBLElBQUksQ0FBQ0QsZUFBTCxHQUF1QnhGLFNBQVMsQ0FBQ3dGLGVBQWpDO0FBQ0FDLE1BQUFBLElBQUksQ0FBQ3hFLFVBQUw7QUFDQTs7QUFuTGdCO0FBQUE7QUFBQSxDQUFsQjtBQXNMQTFCLENBQUMsQ0FBQ3FHLFFBQUQsQ0FBRCxDQUFZQyxLQUFaLENBQWtCLFlBQU07QUFDdkI3RixFQUFBQSxTQUFTLENBQUNpQixVQUFWO0FBQ0EsQ0FGRCIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4gKiBDb3B5cmlnaHQgKEMpIE1JS08gTExDIC0gQWxsIFJpZ2h0cyBSZXNlcnZlZFxuICogVW5hdXRob3JpemVkIGNvcHlpbmcgb2YgdGhpcyBmaWxlLCB2aWEgYW55IG1lZGl1bSBpcyBzdHJpY3RseSBwcm9oaWJpdGVkXG4gKiBQcm9wcmlldGFyeSBhbmQgY29uZmlkZW50aWFsXG4gKiBXcml0dGVuIGJ5IE5pa29sYXkgQmVrZXRvdiwgMTIgMjAxOVxuICpcbiAqL1xuXG4vKiBnbG9iYWwgZ2xvYmFsUm9vdFVybCwgZ2xvYmFsVHJhbnNsYXRlLCBFeHRlbnNpb25zLEZvcm0gICovXG5cbi8vINCf0YDQvtCy0LXRgNC60LAg0L3QtdGCINC70Lgg0L7RiNC40LHQutC4INC30LDQvdGP0YLQvtCz0L4g0LTRgNGD0LPQvtC5INGD0YfQtdGC0LrQvtC5INC90L7QvNC10YDQsFxuJC5mbi5mb3JtLnNldHRpbmdzLnJ1bGVzLmV4aXN0UnVsZSA9ICh2YWx1ZSwgcGFyYW1ldGVyKSA9PiAkKGAjJHtwYXJhbWV0ZXJ9YCkuaGFzQ2xhc3MoJ2hpZGRlbicpO1xuXG5jb25zdCBjYWxsUXVldWUgPSB7XG5cdGRlZmF1bHRFeHRlbnNpb246ICcnLFxuXHQkbnVtYmVyOiAkKCcjZXh0ZW5zaW9uJyksXG5cdCRkaXJydHlGaWVsZDogJCgnI2RpcnJ0eScpLFxuXHRBdmFpbGFibGVNZW1iZXJzTGlzdDogW10sXG5cdCRmb3JtT2JqOiAkKCcjcXVldWUtZm9ybScpLFxuXHQkZXJyb3JNZXNzYWdlczogJCgnI2Zvcm0tZXJyb3ItbWVzc2FnZXMnKSxcblx0dmFsaWRhdGVSdWxlczoge1xuXHRcdG5hbWU6IHtcblx0XHRcdGlkZW50aWZpZXI6ICduYW1lJyxcblx0XHRcdHJ1bGVzOiBbXG5cdFx0XHRcdHtcblx0XHRcdFx0XHR0eXBlOiAnZW1wdHknLFxuXHRcdFx0XHRcdHByb21wdDogZ2xvYmFsVHJhbnNsYXRlLmNxX1ZhbGlkYXRlTmFtZUVtcHR5LFxuXHRcdFx0XHR9LFxuXHRcdFx0XSxcblx0XHR9LFxuXHRcdGV4dGVuc2lvbjoge1xuXHRcdFx0aWRlbnRpZmllcjogJ2V4dGVuc2lvbicsXG5cdFx0XHRydWxlczogW1xuXHRcdFx0XHR7XG5cdFx0XHRcdFx0dHlwZTogJ2VtcHR5Jyxcblx0XHRcdFx0XHRwcm9tcHQ6IGdsb2JhbFRyYW5zbGF0ZS5jcV9WYWxpZGF0ZUV4dGVuc2lvbkVtcHR5LFxuXHRcdFx0XHR9LFxuXHRcdFx0XHR7XG5cdFx0XHRcdFx0dHlwZTogJ2V4aXN0UnVsZVtleHRlbnNpb24tZXJyb3JdJyxcblx0XHRcdFx0XHRwcm9tcHQ6IGdsb2JhbFRyYW5zbGF0ZS5jcV9WYWxpZGF0ZUV4dGVuc2lvbkRvdWJsZSxcblx0XHRcdFx0fSxcblx0XHRcdF0sXG5cdFx0fSxcblx0fSxcblx0aW5pdGlhbGl6ZSgpIHtcblx0XHRFeHRlbnNpb25zLmdldFBob25lRXh0ZW5zaW9ucyhjYWxsUXVldWUuc2V0QXZhaWxhYmxlUXVldWVNZW1iZXJzKTtcblx0XHRjYWxsUXVldWUuZGVmYXVsdEV4dGVuc2lvbiA9ICQoJyNleHRlbnNpb24nKS52YWwoKTtcblx0XHQkKCcudWkuYWNjb3JkaW9uJykuYWNjb3JkaW9uKCk7XG5cblx0XHQkKCcuZHJvcGRvd24nKS5kcm9wZG93bigpO1xuXG5cdFx0JCgnLmNoZWNrYm94JykuY2hlY2tib3goKTtcblxuXHRcdCQoJy5wZXJpb2RpYy1hbm5vdW5jZS1zb3VuZC1pZC1zZWxlY3QnKS5kcm9wZG93bih7XG5cdFx0XHRvbkNoYW5nZSh2YWx1ZSkge1xuXHRcdFx0XHRpZiAocGFyc2VJbnQodmFsdWUsIDEwKSA9PT0gLTEpICQodGhpcykuZHJvcGRvd24oJ2NsZWFyJyk7XG5cdFx0XHRcdC8vIGNvbnNvbGUubG9nKHZhbHVlKTtcblx0XHRcdH0sXG5cdFx0fSk7XG5cdFx0JCgnLmZvcndhcmRpbmctc2VsZWN0JykuZHJvcGRvd24oRXh0ZW5zaW9ucy5nZXREcm9wZG93blNldHRpbmdzV2l0aEVtcHR5KCkpO1xuXHRcdEV4dGVuc2lvbnMuZml4QnVnRHJvcGRvd25JY29uKCk7XG5cdFx0Ly8g0JTQuNC90LDQvNC40YfQtdGB0LrQsNGPINC/0YDQvtCy0L7QstC10YDQutCwINGB0LLQvtCx0L7QtNC10L0g0LvQuCDQstC90YPRgtGA0LXQvdC90LjQuSDQvdC+0LzQtdGAXG5cdFx0Y2FsbFF1ZXVlLiRudW1iZXIub24oJ2NoYW5nZScsICgpID0+IHtcblx0XHRcdGNvbnN0IG5ld051bWJlciA9IGNhbGxRdWV1ZS4kZm9ybU9iai5mb3JtKCdnZXQgdmFsdWUnLCAnZXh0ZW5zaW9uJyk7XG5cdFx0XHRFeHRlbnNpb25zLmNoZWNrQXZhaWxhYmlsaXR5KGNhbGxRdWV1ZS5kZWZhdWx0TnVtYmVyLCBuZXdOdW1iZXIpO1xuXHRcdH0pO1xuXG5cdFx0Y2FsbFF1ZXVlLmluaXRpYWxpemVEcmFnQW5kRHJvcEV4dGVuc2lvblRhYmxlUm93cygpO1xuXG5cdFx0Ly8g0KPQtNCw0LvQtdC90LjQtSDRgdGC0YDQvtC60Lgg0LjQtyDRgtCw0LHQu9C40YbRiyDRg9GH0LDRgdGC0L3QuNC60L7QsiDQvtGH0LXRgNC10LTQuFxuXHRcdCQoJy5kZWxldGUtcm93LWJ1dHRvbicpLm9uKCdjbGljaycsIChlKSA9PiB7XG5cdFx0XHQkKGUudGFyZ2V0KS5jbG9zZXN0KCd0cicpLnJlbW92ZSgpO1xuXHRcdFx0Y2FsbFF1ZXVlLnJlaW5pdGlhbGl6ZUV4dGVuc2lvblNlbGVjdCgpO1xuXHRcdFx0Y2FsbFF1ZXVlLnVwZGF0ZUV4dGVuc2lvblRhYmxlVmlldygpO1xuXHRcdFx0Y2FsbFF1ZXVlLiRkaXJydHlGaWVsZC52YWwoTWF0aC5yYW5kb20oKSk7XG5cdFx0XHRjYWxsUXVldWUuJGRpcnJ0eUZpZWxkLnRyaWdnZXIoJ2NoYW5nZScpO1xuXHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdH0pO1xuXG5cdFx0Y2FsbFF1ZXVlLmluaXRpYWxpemVGb3JtKCk7XG5cdH0sXG5cdHNldEF2YWlsYWJsZVF1ZXVlTWVtYmVycyhhcnJSZXN1bHQpIHtcblx0XHQkLmVhY2goYXJyUmVzdWx0LnJlc3VsdHMsIChpbmRleCwgZXh0ZW5zaW9uKSA9PiB7XG5cdFx0XHRjYWxsUXVldWUuQXZhaWxhYmxlTWVtYmVyc0xpc3QucHVzaCh7XG5cdFx0XHRcdG51bWJlcjogZXh0ZW5zaW9uLnZhbHVlLFxuXHRcdFx0XHRjYWxsZXJpZDogZXh0ZW5zaW9uLm5hbWUsXG5cdFx0XHR9KTtcblx0XHR9KTtcblx0XHRjYWxsUXVldWUucmVpbml0aWFsaXplRXh0ZW5zaW9uU2VsZWN0KCk7XG5cdFx0Y2FsbFF1ZXVlLnVwZGF0ZUV4dGVuc2lvblRhYmxlVmlldygpO1xuXHR9LFxuXHQvLyDQktC10YDQvdGD0YLRjCDRgdC/0LjRgdC+0Log0LTQvtGB0YLRg9C/0L3Ri9GFINGH0LvQtdC90L7QsiDQvtGH0LXRgNC10LTQuFxuXHRnZXRBdmFpbGFibGVRdWV1ZU1lbWJlcnMoKSB7XG5cdFx0Y29uc3QgcmVzdWx0ID0gW107XG5cdFx0Y2FsbFF1ZXVlLkF2YWlsYWJsZU1lbWJlcnNMaXN0LmZvckVhY2goKG1lbWJlcikgPT4ge1xuXHRcdFx0aWYgKCQoYC5tZW1iZXItcm93IyR7bWVtYmVyLm51bWJlcn1gKS5sZW5ndGggPT09IDApIHtcblx0XHRcdFx0cmVzdWx0LnB1c2goe1xuXHRcdFx0XHRcdG5hbWU6IG1lbWJlci5jYWxsZXJpZCxcblx0XHRcdFx0XHR2YWx1ZTogbWVtYmVyLm51bWJlcixcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdFx0Ly8gcmVzdWx0LnNvcnQoKGEsIGIpID0+ICgoYS5uYW1lID4gYi5uYW1lKSA/IDEgOiAoKGIubmFtZSA+IGEubmFtZSkgPyAtMSA6IDApKSk7XG5cdFx0cmV0dXJuIHJlc3VsdDtcblx0fSxcblx0Ly8g0J/QtdGA0LXRgdC+0LHRgNCw0YLRjCDRh9C70LXQvdC+0LIg0L7Rh9C10YDQtdC00Lgg0YEg0YPRh9C10YLQvtC8INGD0LbQtSDQstGL0LHRgNCw0L3QvdGL0YVcblx0cmVpbml0aWFsaXplRXh0ZW5zaW9uU2VsZWN0KCkge1xuXHRcdCQoJyNleHRlbnNpb25zZWxlY3QnKS5kcm9wZG93bih7XG5cdFx0XHRhY3Rpb246ICdoaWRlJyxcblx0XHRcdGZvcmNlU2VsZWN0aW9uOiBmYWxzZSxcblx0XHRcdG9uQ2hhbmdlKHZhbHVlLCB0ZXh0KSB7XG5cdFx0XHRcdGlmICh2YWx1ZSkge1xuXHRcdFx0XHRcdGNvbnN0ICR0ciA9ICQoJy5tZW1iZXItcm93LXRwbCcpLmxhc3QoKTtcblx0XHRcdFx0XHRjb25zdCAkY2xvbmUgPSAkdHIuY2xvbmUodHJ1ZSk7XG5cdFx0XHRcdFx0JGNsb25lXG5cdFx0XHRcdFx0XHQucmVtb3ZlQ2xhc3MoJ21lbWJlci1yb3ctdHBsJylcblx0XHRcdFx0XHRcdC5hZGRDbGFzcygnbWVtYmVyLXJvdycpXG5cdFx0XHRcdFx0XHQuc2hvdygpO1xuXHRcdFx0XHRcdCRjbG9uZS5hdHRyKCdpZCcsIHZhbHVlKTtcblx0XHRcdFx0XHQkY2xvbmUuZmluZCgnLm51bWJlcicpLmh0bWwodmFsdWUpO1xuXHRcdFx0XHRcdCRjbG9uZS5maW5kKCcuY2FsbGVyaWQnKS5odG1sKHRleHQpO1xuXHRcdFx0XHRcdGlmICgkKCcubWVtYmVyLXJvdycpLmxhc3QoKS5sZW5ndGggPT09IDApIHtcblx0XHRcdFx0XHRcdCR0ci5hZnRlcigkY2xvbmUpO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHQkKCcubWVtYmVyLXJvdycpLmxhc3QoKS5hZnRlcigkY2xvbmUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGNhbGxRdWV1ZS5yZWluaXRpYWxpemVFeHRlbnNpb25TZWxlY3QoKTtcblx0XHRcdFx0XHRjYWxsUXVldWUudXBkYXRlRXh0ZW5zaW9uVGFibGVWaWV3KCk7XG5cdFx0XHRcdFx0Y2FsbFF1ZXVlLiRkaXJydHlGaWVsZC52YWwoTWF0aC5yYW5kb20oKSk7XG5cdFx0XHRcdFx0Y2FsbFF1ZXVlLiRkaXJydHlGaWVsZC50cmlnZ2VyKCdjaGFuZ2UnKTtcblx0XHRcdFx0fVxuXHRcdFx0fSxcblx0XHRcdHZhbHVlczogY2FsbFF1ZXVlLmdldEF2YWlsYWJsZVF1ZXVlTWVtYmVycygpLFxuXG5cdFx0fSk7XG5cdH0sIC8vINCS0LrQu9GO0YfQuNGC0Ywg0LLQvtC30LzQvtC20L3QvtGB0YLRjCDQv9C10YDQtdGC0LDRgdC60LjQstCw0L3QuNGPINGN0LvQtdC80LXQvdGC0L7QsiDRgtCw0LHQu9C40YbRiyDRg9GH0LDRgdGC0L3QuNC60L7QsiDQvtGH0LXRgNC10LTQuFxuXG5cdGluaXRpYWxpemVEcmFnQW5kRHJvcEV4dGVuc2lvblRhYmxlUm93cygpIHtcblx0XHQkKCcjZXh0ZW5zaW9uc1RhYmxlJykudGFibGVEbkQoe1xuXHRcdFx0b25EcmFnQ2xhc3M6ICdob3ZlcmluZ1JvdycsXG5cdFx0XHRkcmFnSGFuZGxlOiAnLmRyYWdIYW5kbGUnLFxuXHRcdFx0b25Ecm9wOiAoKSA9PiB7XG5cdFx0XHRcdGNhbGxRdWV1ZS4kZGlycnR5RmllbGQudmFsKE1hdGgucmFuZG9tKCkpO1xuXHRcdFx0XHRjYWxsUXVldWUuJGRpcnJ0eUZpZWxkLnRyaWdnZXIoJ2NoYW5nZScpO1xuXHRcdFx0fSxcblx0XHR9KTtcblx0fSxcblxuXHQvLyDQntGC0L7QsdGA0LDQt9C40YLRjCDQt9Cw0LPQu9GD0YjQutGDINC10YHQu9C4INCyINGC0LDQsdC70LjRhtC1IDAg0YHRgtGA0L7QulxuXHR1cGRhdGVFeHRlbnNpb25UYWJsZVZpZXcoKSB7XG5cdFx0Y29uc3QgZHVtbXkgPSBgPHRyIGNsYXNzPVwiZHVtbXlcIj48dGQgY29sc3Bhbj1cIjRcIiBjbGFzcz1cImNlbnRlciBhbGlnbmVkXCI+JHtnbG9iYWxUcmFuc2xhdGUuY3FfQWRkUXVldWVNZW1iZXJzfTwvdGQ+PC90cj5gO1xuXG5cdFx0aWYgKCQoJy5tZW1iZXItcm93JykubGVuZ3RoID09PSAwKSB7XG5cdFx0XHQkKCcjZXh0ZW5zaW9uc1RhYmxlIHRib2R5JykuYXBwZW5kKGR1bW15KTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0JCgnLmR1bW15JykucmVtb3ZlKCk7XG5cdFx0fVxuXHR9LFxuXHRjYkJlZm9yZVNlbmRGb3JtKHNldHRpbmdzKSB7XG5cdFx0bGV0IHJlc3VsdCA9IHNldHRpbmdzO1xuXHRcdHJlc3VsdC5kYXRhID0gY2FsbFF1ZXVlLiRmb3JtT2JqLmZvcm0oJ2dldCB2YWx1ZXMnKTtcblx0XHRjb25zdCBhcnJNZW1iZXJzID0gW107XG5cdFx0JCgnLm1lbWJlci1yb3cnKS5lYWNoKChpbmRleCwgb2JqKSA9PiB7XG5cdFx0XHRpZiAoJChvYmopLmF0dHIoJ2lkJykpIHtcblx0XHRcdFx0YXJyTWVtYmVycy5wdXNoKHtcblx0XHRcdFx0XHRudW1iZXI6ICQob2JqKS5hdHRyKCdpZCcpLFxuXHRcdFx0XHRcdHByaW9yaXR5OiBpbmRleCxcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdFx0aWYgKGFyck1lbWJlcnMubGVuZ3RoID09PSAwKSB7XG5cdFx0XHRyZXN1bHQgPSBmYWxzZTtcblx0XHRcdGNhbGxRdWV1ZS4kZXJyb3JNZXNzYWdlcy5odG1sKGdsb2JhbFRyYW5zbGF0ZS5jcV9WYWxpZGF0ZU5vRXh0ZW5zaW9ucyk7XG5cdFx0XHRjYWxsUXVldWUuJGZvcm1PYmouYWRkQ2xhc3MoJ2Vycm9yJyk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJlc3VsdC5kYXRhLm1lbWJlcnMgPSBKU09OLnN0cmluZ2lmeShhcnJNZW1iZXJzKTtcblx0XHR9XG5cblx0XHRyZXR1cm4gcmVzdWx0O1xuXHR9LFxuXHRjYkFmdGVyU2VuZEZvcm0oKSB7XG5cdFx0Y2FsbFF1ZXVlLmRlZmF1bHROdW1iZXIgPSBjYWxsUXVldWUuJG51bWJlci52YWwoKTtcblx0fSxcblx0aW5pdGlhbGl6ZUZvcm0oKSB7XG5cdFx0Rm9ybS4kZm9ybU9iaiA9IGNhbGxRdWV1ZS4kZm9ybU9iajtcblx0XHRGb3JtLnVybCA9IGAke2dsb2JhbFJvb3RVcmx9Y2FsbC1xdWV1ZXMvc2F2ZWA7XG5cdFx0Rm9ybS52YWxpZGF0ZVJ1bGVzID0gY2FsbFF1ZXVlLnZhbGlkYXRlUnVsZXM7XG5cdFx0Rm9ybS5jYkJlZm9yZVNlbmRGb3JtID0gY2FsbFF1ZXVlLmNiQmVmb3JlU2VuZEZvcm07XG5cdFx0Rm9ybS5jYkFmdGVyU2VuZEZvcm0gPSBjYWxsUXVldWUuY2JBZnRlclNlbmRGb3JtO1xuXHRcdEZvcm0uaW5pdGlhbGl6ZSgpO1xuXHR9LFxufTtcblxuJChkb2N1bWVudCkucmVhZHkoKCkgPT4ge1xuXHRjYWxsUXVldWUuaW5pdGlhbGl6ZSgpO1xufSk7XG5cbiJdfQ==