{"version":3,"sources":["../../src/CallQueues/callqueue-modify.js"],"names":["$","fn","form","settings","rules","existRule","value","parameter","hasClass","callQueue","defaultExtension","$number","$dirrtyField","AvailableMembersList","$formObj","$errorMessages","validateRules","name","identifier","type","prompt","globalTranslate","cq_ValidateNameEmpty","extension","cq_ValidateExtensionEmpty","cq_ValidateExtensionDouble","initialize","Extensions","getPhoneExtensions","setAvailableQueueMembers","val","accordion","dropdown","checkbox","onChange","parseInt","getDropdownSettingsWithEmpty","fixBugDropdownIcon","on","newNumber","checkAvailability","defaultNumber","initializeDragAndDropExtensionTableRows","e","target","closest","remove","reinitializeExtensionSelect","updateExtensionTableView","Math","random","trigger","preventDefault","initializeForm","arrResult","each","results","index","push","number","callerid","getAvailableQueueMembers","result","forEach","member","length","action","forceSelection","text","$tr","last","$clone","clone","removeClass","addClass","show","attr","find","html","after","values","tableDnD","onDragClass","dragHandle","onDrop","dummy","cq_AddQueueMembers","append","cbBeforeSendForm","data","arrMembers","obj","priority","cq_ValidateNoExtensions","members","JSON","stringify","cbAfterSendForm","Form","url","globalRootUrl","document","ready"],"mappings":"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","sourcesContent":["/*\n * Copyright (C) MIKO LLC - All Rights Reserved\n * Unauthorized copying of this file, via any medium is strictly prohibited\n * Proprietary and confidential\n * Written by Nikolay Beketov, 5 2018\n *\n */\n\n/* global globalRootUrl, globalTranslate, Extensions,Form  */\n\n// Проверка нет ли ошибки занятого другой учеткой номера\n$.fn.form.settings.rules.existRule = (value, parameter) => $(`#${parameter}`).hasClass('hidden');\n\nconst callQueue = {\n\tdefaultExtension: '',\n\t$number: $('#extension'),\n\t$dirrtyField: $('#dirrty'),\n\tAvailableMembersList: [],\n\t$formObj: $('#queue-form'),\n\t$errorMessages: $('#form-error-messages'),\n\tvalidateRules: {\n\t\tname: {\n\t\t\tidentifier: 'name',\n\t\t\trules: [\n\t\t\t\t{\n\t\t\t\t\ttype: 'empty',\n\t\t\t\t\tprompt: globalTranslate.cq_ValidateNameEmpty,\n\t\t\t\t},\n\t\t\t],\n\t\t},\n\t\textension: {\n\t\t\tidentifier: 'extension',\n\t\t\trules: [\n\t\t\t\t{\n\t\t\t\t\ttype: 'empty',\n\t\t\t\t\tprompt: globalTranslate.cq_ValidateExtensionEmpty,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttype: 'existRule[extension-error]',\n\t\t\t\t\tprompt: globalTranslate.cq_ValidateExtensionDouble,\n\t\t\t\t},\n\t\t\t],\n\t\t},\n\t},\n\tinitialize() {\n\t\tExtensions.getPhoneExtensions(callQueue.setAvailableQueueMembers);\n\t\tcallQueue.defaultExtension = $('#extension').val();\n\t\t$('.ui.accordion').accordion();\n\n\t\t$('.dropdown').dropdown();\n\n\t\t$('.checkbox').checkbox();\n\n\t\t$('.periodic-announce-sound-id-select').dropdown({\n\t\t\tonChange(value) {\n\t\t\t\tif (parseInt(value, 10) === -1) $(this).dropdown('clear');\n\t\t\t\t// console.log(value);\n\t\t\t},\n\t\t});\n\t\t$('.forwarding-select').dropdown(Extensions.getDropdownSettingsWithEmpty());\n\t\tExtensions.fixBugDropdownIcon();\n\t\t// Динамическая прововерка свободен ли внутренний номер\n\t\tcallQueue.$number.on('change', () => {\n\t\t\tconst newNumber = callQueue.$formObj.form('get value', 'extension');\n\t\t\tExtensions.checkAvailability(callQueue.defaultNumber, newNumber);\n\t\t});\n\n\t\tcallQueue.initializeDragAndDropExtensionTableRows();\n\n\t\t// Удаление строки из таблицы участников очереди\n\t\t$('.delete-row-button').on('click', (e) => {\n\t\t\t$(e.target).closest('tr').remove();\n\t\t\tcallQueue.reinitializeExtensionSelect();\n\t\t\tcallQueue.updateExtensionTableView();\n\t\t\tcallQueue.$dirrtyField.val(Math.random());\n\t\t\tcallQueue.$dirrtyField.trigger('change');\n\t\t\te.preventDefault();\n\t\t\treturn false;\n\t\t});\n\n\t\tcallQueue.initializeForm();\n\t},\n\tsetAvailableQueueMembers(arrResult) {\n\t\t$.each(arrResult.results, (index, extension) => {\n\t\t\tcallQueue.AvailableMembersList.push({\n\t\t\t\tnumber: extension.value,\n\t\t\t\tcallerid: extension.name,\n\t\t\t});\n\t\t});\n\t\tcallQueue.reinitializeExtensionSelect();\n\t\tcallQueue.updateExtensionTableView();\n\t},\n\t// Вернуть список доступных членов очереди\n\tgetAvailableQueueMembers() {\n\t\tconst result = [];\n\t\tcallQueue.AvailableMembersList.forEach((member) => {\n\t\t\tif ($(`.member-row#${member.number}`).length === 0) {\n\t\t\t\tresult.push({\n\t\t\t\t\tname: member.callerid,\n\t\t\t\t\tvalue: member.number,\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t\t// result.sort((a, b) => ((a.name > b.name) ? 1 : ((b.name > a.name) ? -1 : 0)));\n\t\treturn result;\n\t},\n\t// Пересобрать членов очереди с учетом уже выбранных\n\treinitializeExtensionSelect() {\n\t\t$('#extensionselect').dropdown({\n\t\t\taction: 'hide',\n\t\t\tforceSelection: false,\n\t\t\tonChange(value, text) {\n\t\t\t\tif (value) {\n\t\t\t\t\tconst $tr = $('.member-row-tpl').last();\n\t\t\t\t\tconst $clone = $tr.clone(true);\n\t\t\t\t\t$clone\n\t\t\t\t\t\t.removeClass('member-row-tpl')\n\t\t\t\t\t\t.addClass('member-row')\n\t\t\t\t\t\t.show();\n\t\t\t\t\t$clone.attr('id', value);\n\t\t\t\t\t$clone.find('.number').html(value);\n\t\t\t\t\t$clone.find('.callerid').html(text);\n\t\t\t\t\tif ($('.member-row').last().length === 0) {\n\t\t\t\t\t\t$tr.after($clone);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$('.member-row').last().after($clone);\n\t\t\t\t\t}\n\n\t\t\t\t\tcallQueue.reinitializeExtensionSelect();\n\t\t\t\t\tcallQueue.updateExtensionTableView();\n\t\t\t\t\tcallQueue.$dirrtyField.val(Math.random());\n\t\t\t\t\tcallQueue.$dirrtyField.trigger('change');\n\t\t\t\t}\n\t\t\t},\n\t\t\tvalues: callQueue.getAvailableQueueMembers(),\n\n\t\t});\n\t}, // Включить возможность перетаскивания элементов таблицы участников очереди\n\n\tinitializeDragAndDropExtensionTableRows() {\n\t\t$('#extensionsTable').tableDnD({\n\t\t\tonDragClass: 'hoveringRow',\n\t\t\tdragHandle: '.dragHandle',\n\t\t\tonDrop: () => {\n\t\t\t\tcallQueue.$dirrtyField.val(Math.random());\n\t\t\t\tcallQueue.$dirrtyField.trigger('change');\n\t\t\t},\n\t\t});\n\t},\n\n\t// Отобразить заглушку если в таблице 0 строк\n\tupdateExtensionTableView() {\n\t\tconst dummy = `<tr class=\"dummy\"><td colspan=\"4\" class=\"center aligned\">${globalTranslate.cq_AddQueueMembers}</td></tr>`;\n\n\t\tif ($('.member-row').length === 0) {\n\t\t\t$('#extensionsTable tbody').append(dummy);\n\t\t} else {\n\t\t\t$('.dummy').remove();\n\t\t}\n\t},\n\tcbBeforeSendForm(settings) {\n\t\tlet result = settings;\n\t\tresult.data = callQueue.$formObj.form('get values');\n\t\tconst arrMembers = [];\n\t\t$('.member-row').each((index, obj) => {\n\t\t\tif ($(obj).attr('id')) {\n\t\t\t\tarrMembers.push({\n\t\t\t\t\tnumber: $(obj).attr('id'),\n\t\t\t\t\tpriority: index,\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t\tif (arrMembers.length === 0) {\n\t\t\tresult = false;\n\t\t\tcallQueue.$errorMessages.html(globalTranslate.cq_ValidateNoExtensions);\n\t\t\tcallQueue.$formObj.addClass('error');\n\t\t} else {\n\t\t\tresult.data.members = JSON.stringify(arrMembers);\n\t\t}\n\n\t\treturn result;\n\t},\n\tcbAfterSendForm() {\n\t\tcallQueue.defaultNumber = callQueue.$number.val();\n\t},\n\tinitializeForm() {\n\t\tForm.$formObj = callQueue.$formObj;\n\t\tForm.url = `${globalRootUrl}call-queues/save`;\n\t\tForm.validateRules = callQueue.validateRules;\n\t\tForm.cbBeforeSendForm = callQueue.cbBeforeSendForm;\n\t\tForm.cbAfterSendForm = callQueue.cbAfterSendForm;\n\t\tForm.initialize();\n\t},\n};\n\n$(document).ready(() => {\n\tcallQueue.initialize();\n});\n\n"],"file":"callqueue-modify.js"}