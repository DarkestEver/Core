{"version":3,"sources":["../../src/IncomingRoutes/incoming-route-index.js"],"names":["$","fn","form","settings","rules","extensionRule","value","val","incomingRoutes","$formObj","validateRules","extension","identifier","type","prompt","globalTranslate","ir_ValidateForwardingToBeFilled","initialize","tableDnD","onDrop","each","index","obj","ruleId","attr","oldPriority","parseInt","newPriority","rowIndex","api","on","url","globalRootUrl","method","data","onDragClass","dragHandle","dropdown","onChange","toggleDisabledFieldClass","initializeForm","Extensions","getDropdownSettingsWithoutEmpty","fixBugDropdownIcon","e","id","target","closest","window","location","show","hide","cbBeforeSendForm","result","cbAfterSendForm","Form","document","ready"],"mappings":"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","sourcesContent":["/*\n * Copyright (C) MIKO LLC - All Rights Reserved\n * Unauthorized copying of this file, via any medium is strictly prohibited\n * Proprietary and confidential\n * Written by Nikolay Beketov, 5 2018\n *\n */\n\n/* global globalRootUrl,globalTranslate, Extensions, Form */\n\n// Если выбран вариант переадресации на номер, а сам номер не выбран\n//\n$.fn.form.settings.rules.extensionRule = function (value) {\n\tif (($('#action').val() === 'extension') &&\n\t\t(value === -1 || value === '')) {\n\t\treturn false;\n\t}\n\treturn true;\n};\n\nconst incomingRoutes = {\n\t$formObj: $('#default-rule-form'),\n\tvalidateRules: {\n\t\textension: {\n\t\t\tidentifier: 'extension',\n\t\t\trules: [\n\t\t\t\t{\n\t\t\t\t\ttype: 'extensionRule',\n\t\t\t\t\tprompt: globalTranslate.ir_ValidateForwardingToBeFilled,\n\t\t\t\t},\n\t\t\t],\n\t\t},\n\t},\n\tinitialize() {\n\t\t$('#routingTable').tableDnD({\n\t\t\tonDrop() {\n\t\t\t\t$('.rule-row').each((index, obj) => {\n\t\t\t\t\tconst ruleId = $(obj).attr('id');\n\t\t\t\t\tconst oldPriority = parseInt($(obj).attr('data-value'), 10);\n\t\t\t\t\tconst newPriority = obj.rowIndex;\n\t\t\t\t\tif (oldPriority !== newPriority) {\n\t\t\t\t\t\t$.api({\n\t\t\t\t\t\t\ton: 'now',\n\t\t\t\t\t\t\turl: `${globalRootUrl}incoming-routes/changePriority/${ruleId}`,\n\t\t\t\t\t\t\tmethod: 'POST',\n\t\t\t\t\t\t\tdata: {newPriority},\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\t\t\tonDragClass: 'hoveringRow',\n\t\t\tdragHandle: '.dragHandle',\n\t\t});\n\t\t$('#action')\n\t\t\t.dropdown({\n\t\t\t\tonChange() {\n\t\t\t\t\tincomingRoutes.toggleDisabledFieldClass();\n\t\t\t\t},\n\t\t\t});\n\n\t\tincomingRoutes.toggleDisabledFieldClass();\n\n\t\tincomingRoutes.initializeForm();\n\t\t$('.forwarding-select').dropdown(Extensions.getDropdownSettingsWithoutEmpty());\n\t\tExtensions.fixBugDropdownIcon();\n\n\t\t$('.rule-row td').on('dblclick', (e) => {\n\t\t\tconst id = $(e.target).closest('tr').attr('id');\n\t\t\twindow.location = `${globalRootUrl}incoming-routes/modify/${id}`;\n\t\t});\n\t},\n\ttoggleDisabledFieldClass() {\n\t\tif (incomingRoutes.$formObj.form('get value', 'action') === 'extension') {\n\t\t\t$('#extension-group').show();\n\t\t} else {\n\t\t\t$('#extension-group').hide();\n\t\t\t$('#extension').dropdown('clear');\n\t\t}\n\t},\n\tcbBeforeSendForm(settings) {\n\t\tconst result = settings;\n\t\tresult.data = incomingRoutes.$formObj.form('get values');\n\t\treturn result;\n\t},\n\tcbAfterSendForm() {\n\n\t},\n\tinitializeForm() {\n\t\tForm.$formObj = incomingRoutes.$formObj;\n\t\tForm.url = `${globalRootUrl}incoming-routes/save`;\n\t\tForm.validateRules = incomingRoutes.validateRules;\n\t\tForm.cbBeforeSendForm = incomingRoutes.cbBeforeSendForm;\n\t\tForm.cbAfterSendForm = incomingRoutes.cbAfterSendForm;\n\t\tForm.initialize();\n\t},\n};\n\n$(document).ready(() => {\n\tincomingRoutes.initialize();\n});\n"],"file":"incoming-route-index.js"}