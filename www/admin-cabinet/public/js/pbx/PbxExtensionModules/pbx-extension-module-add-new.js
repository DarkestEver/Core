"use strict";

/*
 * Copyright (C) MIKO LLC - All Rights Reserved
 * Unauthorized copying of this file, via any medium is strictly prohibited
 * Proprietary and confidential
 * Written by Nikolay Beketov, 12 2019
 *
 */

/* global UserMessage, globalTranslate, PbxApi, upgradeStatusLoopWorker */
var addNewExtension = {
  $uploadButton: $('#add-new-button'),
  $progressBar: $('#upload-progress-bar'),
  $progressBarLabel: $('#upload-progress-bar').find('.label'),
  uploadInProgress: false,
  initialize: function () {
    function initialize() {
      addNewExtension.$progressBar.hide();
      addNewExtension.$uploadButton.on('click', function (e) {
        e.preventDefault();

        if (addNewExtension.$uploadButton.hasClass('loading') || addNewExtension.uploadInProgress) {
          return;
        }

        $('input:file', $(e.target).parents()).click();
      });
      $('input:file').on('change', function (e) {
        if (e.target.files[0] !== undefined) {
          addNewExtension.$progressBar.show();
          var filename = e.target.files[0].name;
          $('input:text', $(e.target).parent()).val(filename);
          addNewExtension.uploadInProgress = true;
          addNewExtension.$uploadButton.addClass('loading');
          var data = $('input:file')[0].files[0];
          PbxApi.SystemUploadModule(data, addNewExtension.cbAfterUploadFile);
        }
      });
    }

    return initialize;
  }(),
  cbAfterUploadFile: function () {
    function cbAfterUploadFile(response) {
      if (response.length === 0 || response === false) {
        addNewExtension.$uploadButton.removeClass('loading');
        addNewExtension.uploadInProgress = false;
        UserMessage.showError(globalTranslate.ext_UploadError);
      } else if (response["function"] === 'upload_progress') {
        addNewExtension.$progressBar.progress({
          percent: parseInt(response.percent, 10)
        });

        if (response.percent < 100) {
          addNewExtension.$progressBarLabel.text(globalTranslate.ext_UploadInProgress);
        } else {
          addNewExtension.$progressBarLabel.text(globalTranslate.ext_InstallationInProgress);
        }
      } else if (response["function"] === 'upload' && PbxApi.successTest(response)) {
        upgradeStatusLoopWorker.initialize(response.uniqid, false);
      } else {
        UserMessage.showMultiString(response.message);
      }
    }

    return cbAfterUploadFile;
  }()
};
$(document).ready(function () {
  addNewExtension.initialize();
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9QYnhFeHRlbnNpb25Nb2R1bGVzL3BieC1leHRlbnNpb24tbW9kdWxlLWFkZC1uZXcuanMiXSwibmFtZXMiOlsiYWRkTmV3RXh0ZW5zaW9uIiwiJHVwbG9hZEJ1dHRvbiIsIiQiLCIkcHJvZ3Jlc3NCYXIiLCIkcHJvZ3Jlc3NCYXJMYWJlbCIsImZpbmQiLCJ1cGxvYWRJblByb2dyZXNzIiwiaW5pdGlhbGl6ZSIsImhpZGUiLCJvbiIsImUiLCJwcmV2ZW50RGVmYXVsdCIsImhhc0NsYXNzIiwidGFyZ2V0IiwicGFyZW50cyIsImNsaWNrIiwiZmlsZXMiLCJ1bmRlZmluZWQiLCJzaG93IiwiZmlsZW5hbWUiLCJuYW1lIiwicGFyZW50IiwidmFsIiwiYWRkQ2xhc3MiLCJkYXRhIiwiUGJ4QXBpIiwiU3lzdGVtVXBsb2FkTW9kdWxlIiwiY2JBZnRlclVwbG9hZEZpbGUiLCJyZXNwb25zZSIsImxlbmd0aCIsInJlbW92ZUNsYXNzIiwiVXNlck1lc3NhZ2UiLCJzaG93RXJyb3IiLCJnbG9iYWxUcmFuc2xhdGUiLCJleHRfVXBsb2FkRXJyb3IiLCJwcm9ncmVzcyIsInBlcmNlbnQiLCJwYXJzZUludCIsInRleHQiLCJleHRfVXBsb2FkSW5Qcm9ncmVzcyIsImV4dF9JbnN0YWxsYXRpb25JblByb2dyZXNzIiwic3VjY2Vzc1Rlc3QiLCJ1cGdyYWRlU3RhdHVzTG9vcFdvcmtlciIsInVuaXFpZCIsInNob3dNdWx0aVN0cmluZyIsIm1lc3NhZ2UiLCJkb2N1bWVudCIsInJlYWR5Il0sIm1hcHBpbmdzIjoiOztBQUFBOzs7Ozs7OztBQVFBO0FBRUEsSUFBTUEsZUFBZSxHQUFHO0FBQ3ZCQyxFQUFBQSxhQUFhLEVBQUVDLENBQUMsQ0FBQyxpQkFBRCxDQURPO0FBRXZCQyxFQUFBQSxZQUFZLEVBQUVELENBQUMsQ0FBQyxzQkFBRCxDQUZRO0FBR3ZCRSxFQUFBQSxpQkFBaUIsRUFBRUYsQ0FBQyxDQUFDLHNCQUFELENBQUQsQ0FBMEJHLElBQTFCLENBQStC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UCxDQUFtQmIsUUFBbkIsQ0FBdEMsRUFBb0U7QUFDMUVjLFFBQUFBLHVCQUF1QixDQUFDbkMsVUFBeEIsQ0FBbUNxQixRQUFRLENBQUNlLE1BQTVDLEVBQW9ELEtBQXBEO0FBQ0EsT0FGTSxNQUVBO0FBQ05aLFFBQUFBLFdBQVcsQ0FBQ2EsZUFBWixDQUE0QmhCLFFBQVEsQ0FBQ2lCLE9BQXJDO0FBQ0E7QUFDRDs7QUEvQ3NCO0FBQUE7QUFBQSxDQUF4QjtBQWtEQTNDLENBQUMsQ0FBQzRDLFFBQUQsQ0FBRCxDQUFZQyxLQUFaLENBQWtCLFlBQU07QUFDdkIvQyxFQUFBQSxlQUFlLENBQUNPLFVBQWhCO0FBQ0EsQ0FGRCIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4gKiBDb3B5cmlnaHQgKEMpIE1JS08gTExDIC0gQWxsIFJpZ2h0cyBSZXNlcnZlZFxuICogVW5hdXRob3JpemVkIGNvcHlpbmcgb2YgdGhpcyBmaWxlLCB2aWEgYW55IG1lZGl1bSBpcyBzdHJpY3RseSBwcm9oaWJpdGVkXG4gKiBQcm9wcmlldGFyeSBhbmQgY29uZmlkZW50aWFsXG4gKiBXcml0dGVuIGJ5IE5pa29sYXkgQmVrZXRvdiwgMTIgMjAxOVxuICpcbiAqL1xuXG4vKiBnbG9iYWwgVXNlck1lc3NhZ2UsIGdsb2JhbFRyYW5zbGF0ZSwgUGJ4QXBpLCB1cGdyYWRlU3RhdHVzTG9vcFdvcmtlciAqLyBcblxuY29uc3QgYWRkTmV3RXh0ZW5zaW9uID0ge1xuXHQkdXBsb2FkQnV0dG9uOiAkKCcjYWRkLW5ldy1idXR0b24nKSxcblx0JHByb2dyZXNzQmFyOiAkKCcjdXBsb2FkLXByb2dyZXNzLWJhcicpLFxuXHQkcHJvZ3Jlc3NCYXJMYWJlbDogJCgnI3VwbG9hZC1wcm9ncmVzcy1iYXInKS5maW5kKCcubGFiZWwnKSxcblx0dXBsb2FkSW5Qcm9ncmVzczogZmFsc2UsXG5cdGluaXRpYWxpemUoKSB7XG5cdFx0YWRkTmV3RXh0ZW5zaW9uLiRwcm9ncmVzc0Jhci5oaWRlKCk7XG5cdFx0YWRkTmV3RXh0ZW5zaW9uLiR1cGxvYWRCdXR0b24ub24oJ2NsaWNrJywgKGUpID0+IHtcblx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdGlmIChcblx0XHRcdFx0YWRkTmV3RXh0ZW5zaW9uLiR1cGxvYWRCdXR0b24uaGFzQ2xhc3MoJ2xvYWRpbmcnKVxuXHRcdFx0XHR8fCBhZGROZXdFeHRlbnNpb24udXBsb2FkSW5Qcm9ncmVzc1xuXHRcdFx0KSB7IHJldHVybjsgfVxuXHRcdFx0JCgnaW5wdXQ6ZmlsZScsICQoZS50YXJnZXQpLnBhcmVudHMoKSkuY2xpY2soKTtcblx0XHR9KTtcblxuXHRcdCQoJ2lucHV0OmZpbGUnKS5vbignY2hhbmdlJywgKGUpID0+IHtcblx0XHRcdGlmIChlLnRhcmdldC5maWxlc1swXSAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0XHRcdGFkZE5ld0V4dGVuc2lvbi4kcHJvZ3Jlc3NCYXIuc2hvdygpO1xuXHRcdFx0XHRjb25zdCBmaWxlbmFtZSA9IGUudGFyZ2V0LmZpbGVzWzBdLm5hbWU7XG5cdFx0XHRcdCQoJ2lucHV0OnRleHQnLCAkKGUudGFyZ2V0KS5wYXJlbnQoKSkudmFsKGZpbGVuYW1lKTtcblx0XHRcdFx0YWRkTmV3RXh0ZW5zaW9uLnVwbG9hZEluUHJvZ3Jlc3MgPSB0cnVlO1xuXHRcdFx0XHRhZGROZXdFeHRlbnNpb24uJHVwbG9hZEJ1dHRvbi5hZGRDbGFzcygnbG9hZGluZycpO1xuXHRcdFx0XHRjb25zdCBkYXRhID0gJCgnaW5wdXQ6ZmlsZScpWzBdLmZpbGVzWzBdO1xuXHRcdFx0XHRQYnhBcGkuU3lzdGVtVXBsb2FkTW9kdWxlKGRhdGEsIGFkZE5ld0V4dGVuc2lvbi5jYkFmdGVyVXBsb2FkRmlsZSk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdH0sXG5cdGNiQWZ0ZXJVcGxvYWRGaWxlKHJlc3BvbnNlKSB7XG5cdFx0aWYgKHJlc3BvbnNlLmxlbmd0aCA9PT0gMCB8fCByZXNwb25zZSA9PT0gZmFsc2UpIHtcblx0XHRcdGFkZE5ld0V4dGVuc2lvbi4kdXBsb2FkQnV0dG9uLnJlbW92ZUNsYXNzKCdsb2FkaW5nJyk7XG5cdFx0XHRhZGROZXdFeHRlbnNpb24udXBsb2FkSW5Qcm9ncmVzcyA9IGZhbHNlO1xuXHRcdFx0VXNlck1lc3NhZ2Uuc2hvd0Vycm9yKGdsb2JhbFRyYW5zbGF0ZS5leHRfVXBsb2FkRXJyb3IpO1xuXHRcdH0gZWxzZSBpZiAocmVzcG9uc2UuZnVuY3Rpb24gPT09ICd1cGxvYWRfcHJvZ3Jlc3MnKSB7XG5cdFx0XHRhZGROZXdFeHRlbnNpb24uJHByb2dyZXNzQmFyLnByb2dyZXNzKHtcblx0XHRcdFx0cGVyY2VudDogcGFyc2VJbnQocmVzcG9uc2UucGVyY2VudCwgMTApLFxuXHRcdFx0fSk7XG5cdFx0XHRpZiAocmVzcG9uc2UucGVyY2VudCA8IDEwMCkge1xuXHRcdFx0XHRhZGROZXdFeHRlbnNpb24uJHByb2dyZXNzQmFyTGFiZWwudGV4dChnbG9iYWxUcmFuc2xhdGUuZXh0X1VwbG9hZEluUHJvZ3Jlc3MpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0YWRkTmV3RXh0ZW5zaW9uLiRwcm9ncmVzc0JhckxhYmVsLnRleHQoZ2xvYmFsVHJhbnNsYXRlLmV4dF9JbnN0YWxsYXRpb25JblByb2dyZXNzKTtcblx0XHRcdH1cblx0XHR9IGVsc2UgaWYgKHJlc3BvbnNlLmZ1bmN0aW9uID09PSAndXBsb2FkJyAmJiBQYnhBcGkuc3VjY2Vzc1Rlc3QocmVzcG9uc2UpKSB7XG5cdFx0XHR1cGdyYWRlU3RhdHVzTG9vcFdvcmtlci5pbml0aWFsaXplKHJlc3BvbnNlLnVuaXFpZCwgZmFsc2UpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRVc2VyTWVzc2FnZS5zaG93TXVsdGlTdHJpbmcocmVzcG9uc2UubWVzc2FnZSk7XG5cdFx0fVxuXHR9LFxufTtcblxuJChkb2N1bWVudCkucmVhZHkoKCkgPT4ge1xuXHRhZGROZXdFeHRlbnNpb24uaW5pdGlhbGl6ZSgpO1xufSk7XG4iXX0=