{"version":3,"sources":["../../src/PbxExtensionModules/pbx-extension-modules-index.js"],"names":["upgradeStatusLoopWorker","extensionModules","$ajaxMessgesDiv","$","$checboxes","updatesUrl","initialize","getModulesUpdates","checkbox","onChecked","uniqid","closest","attr","enableModule","PbxApi","SystemReloadModule","onUnchecked","disableModule","addUpdateButtonToRow","obj","$moduleRow","dymanicButton","href","globalTranslate","ext_UpdateModule","md5","find","prepend","addModuleDescription","show","promoLink","promo_link","undefined","ext_ExternalDescription","dymanicRow","decodeURIComponent","name","description","developer","version","ext_InstallModule","append","requestData","TYPE","LICENSE","globalPBXLicense","PBXVER","globalPBXVersion","LANGUAGE","globalPBXLanguage","api","url","on","method","data","successTest","response","Object","keys","length","result","toUpperCase","onSuccess","modules","forEach","oldVer","text","replace","newVer","e","preventDefault","addClass","params","$aLink","target","removeClass","updateLink","installModule","updateModule","deleteModule","popup","status","SystemDeleteModule","cbAfterDelete","needEnable","SystemInstallModule","cbAfterEnable","remove","globalRootUrl","urlData","success","previousMessage","each","message","index","value","after","cbAfterDisable","reloadModuleAndPage","window","location","ext_DeleteModuleError","timeOut","timeOutHandle","moduleUniqid","iterations","oldPercent","needEnableAfterInstall","restartWorker","clearTimeout","timeoutHandle","worker","SystemGetModuleInstallStatus","cbRefreshModuleStatus","setTimeout","i_status","localStorage","removeItem","d_status","ext_UpdateModuleError","d_status_progress","document","ready"],"mappings":"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","sourcesContent":["/*\n * Copyright (C) MIKO LLC - All Rights Reserved\n * Unauthorized copying of this file, via any medium is strictly prohibited\n * Proprietary and confidential\n * Written by Nikolay Beketov, 7 2018\n *\n */\n\n/* global globalRootUrl, PbxApi, globalTranslate,\n globalPBXLanguage, globalPBXLicense, globalPBXVersion */\n\nlet upgradeStatusLoopWorker = {};\nconst extensionModules = {\n\t$ajaxMessgesDiv: $('#ajax-messages'),\n\t$checboxes: $('.module-row .checkbox'),\n\tupdatesUrl: 'https://update.askozia.ru/',\n\tinitialize() {\n\t\textensionModules.getModulesUpdates();\n\t\textensionModules.$checboxes\n\t\t\t.checkbox({\n\t\t\t\tonChecked() {\n\t\t\t\t\tconst uniqid = $(this).closest('tr').attr('id');\n\t\t\t\t\textensionModules.enableModule(uniqid, PbxApi.SystemReloadModule);\n\t\t\t\t},\n\t\t\t\tonUnchecked() {\n\t\t\t\t\tconst uniqid = $(this).closest('tr').attr('id');\n\t\t\t\t\textensionModules.disableModule(uniqid, PbxApi.SystemReloadModule);\n\t\t\t\t},\n\t\t\t});\n\t},\n\taddUpdateButtonToRow(obj) {\n\t\tconst $moduleRow = $(`tr#${obj.uniqid}`);\n\t\tconst dymanicButton\n\t\t\t= `<a href=\"${obj.href}\" class=\"ui button update popuped\" \n\t\t\tdata-content=\"${globalTranslate.ext_UpdateModule}\"\n\t\t\tdata-uniqid =\"${obj.uniqid}\" \n\t\t\tdata-md5 =\"${obj.md5}\">\n\t\t\t<i class=\"icon redo blue\"></i> \n\t\t\t<span class=\"percent\"></span>\n\t\t\t</a>`;\n\t\t$moduleRow.find('.action-buttons').prepend(dymanicButton);\n\t},\n\taddModuleDescription(obj) {\n\t\t$('#online-updates-block').show();\n\t\tlet promoLink = '';\n\t\tif (obj.promo_link !== undefined && obj.promo_link !== null) {\n\t\t\tpromoLink = `<br><a href=\"${obj.promo_link}\" target=\"_blank\">${globalTranslate.ext_ExternalDescription}</a>`;\n\t\t}\n\t\tconst dymanicRow = `\n\t\t\t<tr class=\"new-module-row\" id=\"${obj.uniqid}\">\n\t\t\t\t\t\t<td>${decodeURIComponent(obj.name)}<br>\n\t\t\t\t\t\t<span class=\"features\">${decodeURIComponent(obj.description)} ${promoLink}</span>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t\t<td>${decodeURIComponent(obj.developer)}</td>\n\t\t\t\t\t\t<td class=\"center aligned\">${obj.version}</td>\n\t\t\t\t\t\t<td class=\"right aligned collapsing\">\n    \t\t\t\t\t\t<div class=\"ui small basic icon buttons action-buttons\">\n    \t\t\t\t\t\t\t<a href=\"${obj.href}\" class=\"ui button download\" \n\t\t\t\t\t\t\t\t\tdata-content=\"${globalTranslate.ext_InstallModule}\"\n\t\t\t\t\t\t\t\t\tdata-uniqid =\"${obj.uniqid}\" \n\t\t\t\t\t\t\t\t\tdata-md5 =\"${obj.md5}\">\n\t\t\t\t\t\t\t\t\t<i class=\"icon download blue\"></i> \n\t\t\t\t\t\t\t\t\t<span class=\"percent\"></span>\n\t\t\t\t\t\t\t\t</a>\n    \t\t\t\t\t\t</div>\n\t\t\t</tr>`;\n\t\t$('#new-modules-table tbody').append(dymanicRow);\n\t},\n\tgetModulesUpdates() {\n\t\tconst requestData = {\n\t\t\tTYPE: 'MODULES',\n\t\t\tLICENSE: globalPBXLicense,\n\t\t\tPBXVER: globalPBXVersion,\n\t\t\tLANGUAGE: globalPBXLanguage,\n\t\t};\n\t\t$.api({\n\t\t\turl: extensionModules.updatesUrl,\n\t\t\ton: 'now',\n\t\t\tmethod: 'POST',\n\t\t\tdata: requestData,\n\t\t\tsuccessTest(response) {\n\t\t\t\t// test whether a JSON response is valid\n\t\t\t\treturn response !== undefined\n\t\t\t\t\t&& Object.keys(response).length > 0\n\t\t\t\t\t&& response.result.toUpperCase() === 'SUCCESS';\n\t\t\t},\n\t\t\tonSuccess(response) {\n\t\t\t\tresponse.modules.forEach((obj) => {\n\t\t\t\t\tconst $moduleRow = $(`tr#${obj.uniqid}`);\n\t\t\t\t\tif ($moduleRow.length > 0) {\n\t\t\t\t\t\tconst oldVer = $moduleRow.find('td.version').text().replace(/\\D/g, '');\n\t\t\t\t\t\tconst newVer = obj.version.replace(/\\D/g, '');\n\n\t\t\t\t\t\tif (oldVer < newVer) {\n\t\t\t\t\t\t\textensionModules.addUpdateButtonToRow(obj);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\textensionModules.addModuleDescription(obj);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\t$('a.download').on('click', (e) => {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\t$('a.button').addClass('disabled');\n\t\t\t\t\tconst params = [];\n\t\t\t\t\tconst $aLink = $(e.target).closest('a');\n\t\t\t\t\t$aLink.removeClass('disabled');\n\t\t\t\t\tparams.updateLink = $aLink.attr('href');\n\t\t\t\t\tparams.uniqid = $aLink.attr('data-uniqid');\n\t\t\t\t\tparams.md5 = $aLink.attr('data-md5');\n\t\t\t\t\t$aLink.find('i').addClass('loading redo').removeClass('download');\n\t\t\t\t\textensionModules.installModule(params, false);\n\t\t\t\t});\n\t\t\t\t$('a.update').on('click', (e) => {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\t$('a.button').addClass('disabled');\n\t\t\t\t\tconst params = [];\n\t\t\t\t\tconst $aLink = $(e.target).closest('a');\n\t\t\t\t\t$aLink.removeClass('disabled');\n\t\t\t\t\tparams.updateLink = $aLink.attr('href');\n\t\t\t\t\tparams.uniqid = $aLink.attr('data-uniqid');\n\t\t\t\t\tparams.md5 = $aLink.attr('data-md5');\n\t\t\t\t\t$aLink.find('i').addClass('loading');\n\t\t\t\t\textensionModules.updateModule(params);\n\t\t\t\t});\n\t\t\t\t$('a.delete').on('click', (e) => {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\t$('a.button').addClass('disabled');\n\t\t\t\t\t$(e.target).closest('a').removeClass('disabled');\n\t\t\t\t\tconst params = [];\n\t\t\t\t\tconst $aLink = $(e.target).closest('tr');\n\t\t\t\t\tparams.uniqid = $aLink.attr('id');\n\t\t\t\t\textensionModules.deleteModule(params);\n\t\t\t\t});\n\t\t\t\t$('a[data-content]').popup();\n\t\t\t},\n\t\t});\n\t},\n\t/**\n\t * Сначала отключим модуль, если получится, то отправим команду на удаление\n\t * и обновим страничку\n\t * @param params - параметры запроса.\n\t */\n\tdeleteModule(params) {\n\t\t// Проверим включен ли модуль, если включен, вырубим его\n\t\tconst status = $(`#${params.uniqid}`).find('.checkbox').checkbox('is checked');\n\t\tif (status === true) {\n\t\t\textensionModules.disableModule(params.uniqid, () => {\n\t\t\t\tPbxApi.SystemDeleteModule(params.uniqid, extensionModules.cbAfterDelete);\n\t\t\t});\n\t\t} else {\n\t\t\tPbxApi.SystemDeleteModule(params.uniqid, extensionModules.cbAfterDelete);\n\t\t}\n\t},\n\t/**\n\t * Сначала отключим модуль, если получится, то отправим команду на обновление\n\t * и обновим страничку\n\t * @param params - параметры запроса\n\t */\n\tupdateModule(params) {\n\t\t// Проверим включен ли модуль, если включен, вырубим его\n\t\tconst status = $(`#${params.uniqid}`).find('.checkbox').checkbox('is checked');\n\t\tif (status === true) {\n\t\t\textensionModules.disableModule(params.uniqid, () => {\n\t\t\t\textensionModules.installModule(params, true);\n\t\t\t});\n\t\t} else {\n\t\t\textensionModules.installModule(params, false);\n\t\t}\n\t},\n\t/**\n\t * Обновление модуля\n\t * @param params - параметры запроса\n\t */\n\tinstallModule(params, needEnable) {\n\t\tPbxApi.SystemInstallModule(params);\n\t\tupgradeStatusLoopWorker.initialize(params.uniqid, needEnable);\n\t},\n\t/**\n\t * Включить модуль, с проверкой ссылочной целостности\n\t * @param params - параметры запроса.\n\t * @param cbAfterEnable - колбек функция\n\t */\n\tenableModule(uniqid, cbAfterEnable) {\n\t\t$('.ui.message.ajax').remove();\n\t\t$.api({\n\t\t\turl: `${globalRootUrl}pbx-extension-modules/enable/{uniqid}`,\n\t\t\ton: 'now',\n\t\t\turlData: {\n\t\t\t\tuniqid,\n\t\t\t},\n\t\t\tonSuccess(response) {\n\t\t\t\tif (response.success) {\n\t\t\t\t\t$(`#${uniqid} .disability`).removeClass('disabled');\n\t\t\t\t\t$(`#${uniqid}`).find('.checkbox').checkbox('set checked');\n\t\t\t\t\tcbAfterEnable(uniqid);\n\t\t\t\t} else {\n\t\t\t\t\t$(`#${uniqid}`).find('.checkbox').checkbox('set unchecked');\n\t\t\t\t\tlet previousMessage = '';\n\t\t\t\t\t$.each(response.message, (index, value) => {\n\t\t\t\t\t\tif (previousMessage !== value) {\n\t\t\t\t\t\t\textensionModules.$ajaxMessgesDiv\n\t\t\t\t\t\t\t\t.after(`<div class=\"ui ${index} message ajax\">${value}</div>`);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tpreviousMessage = value;\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\n\t\t});\n\t},\n\t/**\n\t * Выключить модуль, с проверкой ссылочной целостности\n\t * @param uniqid - ID модуля\n\t * @param cbAfterDisable - колбек функция\n\t */\n\tdisableModule(uniqid, cbAfterDisable) {\n\t\t$('.ui.message.ajax').remove();\n\t\t$.api({\n\t\t\turl: `${globalRootUrl}pbx-extension-modules/disable/{uniqid}`,\n\t\t\ton: 'now',\n\t\t\turlData: {\n\t\t\t\tuniqid,\n\t\t\t},\n\t\t\tonSuccess(response) {\n\t\t\t\tif (response.success) {\n\t\t\t\t\t$(`#${uniqid} .disability`).addClass('disabled');\n\t\t\t\t\t$(`#${uniqid}`).find('.checkbox').checkbox('set unchecked');\n\t\t\t\t\tcbAfterDisable(uniqid);\n\t\t\t\t} else {\n\t\t\t\t\t$(`#${uniqid}`).find('.checkbox').checkbox('set checked');\n\t\t\t\t\tlet previousMessage = '';\n\t\t\t\t\t$.each(response.message, (index, value) => {\n\t\t\t\t\t\tif (previousMessage !== value) {\n\t\t\t\t\t\t\textensionModules.$ajaxMessgesDiv\n\t\t\t\t\t\t\t\t.after(`<div class=\"ui ${index} message ajax\">${value}</div>`);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tpreviousMessage = value;\n\t\t\t\t\t});\n\t\t\t\t\t$(`#${uniqid}`).find('i').removeClass('loading');\n\t\t\t\t}\n\t\t\t},\n\n\t\t});\n\t},\n\t/**\n\t * Перезапуск модуля и перезагрузка страницы\n\t * @param uniqid - ID модуля\n\t */\n\treloadModuleAndPage(uniqid) {\n\t\tPbxApi.SystemReloadModule(uniqid);\n\t\twindow.location = `${globalRootUrl}/pbx-extension-modules/index/`;\n\t},\n\t/**\n\t * Обработчик команды uninstall для модуля\n\t * Если успешно, перегрузим страницу, если нет, то сообщим об ошибке\n\t * @param result - результат удаления модуля\n\t */\n\tcbAfterDelete(result) {\n\t\t$('a.button').removeClass('disabled');\n\t\tif (result) {\n\t\t\twindow.location = `${globalRootUrl}pbx-extension-modules/index/`;\n\t\t} else {\n\t\t\t$('.ui.message.ajax').remove();\n\t\t\textensionModules.$ajaxMessgesDiv.after(`<div class=\"ui error message ajax\">${globalTranslate.ext_DeleteModuleError}</div>`);\n\t\t}\n\t},\n\n};\n\nupgradeStatusLoopWorker = {\n\ttimeOut: 1000,\n\ttimeOutHandle: '',\n\tmoduleUniqid: '',\n\titerations: 0,\n\toldPercent: 0,\n\tneedEnableAfterInstall: false,\n\tinitialize(uniqid, needEnable) {\n\t\tupgradeStatusLoopWorker.moduleUniqid = uniqid;\n\t\tupgradeStatusLoopWorker.iterations = 0;\n\t\tupgradeStatusLoopWorker.needEnableAfterInstall = needEnable;\n\t\tupgradeStatusLoopWorker.restartWorker();\n\t},\n\trestartWorker() {\n\t\twindow.clearTimeout(upgradeStatusLoopWorker.timeoutHandle);\n\t\tupgradeStatusLoopWorker.worker();\n\t},\n\tworker() {\n\t\twindow.clearTimeout(upgradeStatusLoopWorker.timeoutHandle);\n\t\tPbxApi.SystemGetModuleInstallStatus(\n\t\t\tupgradeStatusLoopWorker.moduleUniqid,\n\t\t\tupgradeStatusLoopWorker.cbRefreshModuleStatus,\n\t\t);\n\t},\n\tcbRefreshModuleStatus(response) {\n\t\tupgradeStatusLoopWorker.iterations += 1;\n\t\tupgradeStatusLoopWorker.timeoutHandle =\n\t\t\twindow.setTimeout(upgradeStatusLoopWorker.worker, upgradeStatusLoopWorker.timeOut);\n\t\tif (response.length === 0 || response === false) return;\n\t\tif (response.i_status === true) {\n\t\t\t$('a.button').removeClass('disabled');\n\t\t\tlocalStorage.removeItem('globalTranslateVersion'); // Перезапустим формирование кеша перевода\n\t\t\tif (upgradeStatusLoopWorker.needEnableAfterInstall) {\n\t\t\t\textensionModules.enableModule(\n\t\t\t\t\tupgradeStatusLoopWorker.moduleUniqid,\n\t\t\t\t\textensionModules.reloadModuleAndPage,\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\twindow.location = `${globalRootUrl}pbx-extension-modules/index/`;\n\t\t\t}\n\t\t\twindow.clearTimeout(upgradeStatusLoopWorker.timeoutHandle);\n\t\t}\n\t\tif (upgradeStatusLoopWorker.iterations > 50 || response.d_status === 'DOWNLOAD_ERROR') {\n\t\t\twindow.clearTimeout(upgradeStatusLoopWorker.timeoutHandle);\n\t\t\t$('.ui.message.ajax').remove();\n\t\t\textensionModules.$ajaxMessgesDiv.after(`<div class=\"ui error message ajax\">${globalTranslate.ext_UpdateModuleError}</div>`);\n\t\t\t$(`#${upgradeStatusLoopWorker.moduleUniqid}`).find('i').removeClass('loading');\n\t\t\t$('.new-module-row').find('i').addClass('download').removeClass('redo');\n\t\t\t$('a.button').removeClass('disabled');\n\t\t} else if (response.d_status === 'DOWNLOAD_IN_PROGRESS' || response.d_status === 'DOWNLOAD_COMPLETE') {\n\t\t\tif (upgradeStatusLoopWorker.oldPercent !== response.d_status_progress) {\n\t\t\t\tupgradeStatusLoopWorker.iterations = 0;\n\t\t\t}\n\t\t\t$('i.loading.redo').closest('a').find('.percent').text(`${response.d_status_progress}%`);\n\t\t\tupgradeStatusLoopWorker.oldPercent = response.d_status_progress;\n\t\t}\n\t},\n};\n\n\n$(document).ready(() => {\n\textensionModules.initialize();\n});\n"],"file":"pbx-extension-modules-index.js"}