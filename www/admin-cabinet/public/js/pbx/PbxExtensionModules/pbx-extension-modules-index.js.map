{"version":3,"sources":["../../src/PbxExtensionModules/pbx-extension-modules-index.js"],"names":["licensing","params","undefined","callback","captureFeature","$","api","url","globalRootUrl","on","method","data","licFeatureId","licProductId","successTest","response","Object","keys","length","success","onSuccess","cbAfterFeatureCaptured","onFailure","cbAfterFailureFeatureCaptured","message","UserMessage","showError","globalTranslate","ext_NoLicenseAvailable","removeClass","upgradeStatusLoopWorker","extensionModules","$checkboxes","$deleteModalForm","$keepSettingsCheckbox","initialize","modal","UpdateApi","getModulesUpdates","cbParseModuleUpdates","checkbox","onChecked","uniqid","closest","attr","enableModule","PbxApi","SystemReloadModule","onUnchecked","disableModule","modules","forEach","obj","$moduleRow","oldVer","find","text","newVer","version","versionCompare","addUpdateButtonToRow","$newModuleRow","remove","addModuleDescription","e","preventDefault","addClass","$aLink","target","releaseId","size","action","aLink","cbAfterLicenseCheck","deleteModule","popup","show","promoLink","promo_link","ext_ExternalDescription","dymanicRow","decodeURIComponent","name","description","developer","ext_InstallModule","lic_product_id","lic_feature_id","release_id","append","$currentUpdateButton","dynamicButton","ext_UpdateModule","prepend","GetModuleInstallLink","cbGetModuleInstallLinkSuccess","cbGetModuleInstallLinkFailure","newParams","md5","updateLink","href","updateModule","installModule","ext_GetLinkError","status","needEnable","SystemInstallModule","cbAfterEnable","urlData","showMultiString","cbAfterDisable","reloadModuleAndPage","window","location","closable","onDeny","onApprove","keepSettings","SystemDeleteModule","cbAfterDelete","result","errorMessage","replace","ext_DeleteModuleError","v1","v2","options","lexicographical","zeroExtend","v1parts","split","v2parts","isValidPart","x","test","every","NaN","push","map","Number","i","timeOut","timeOutHandle","moduleUniqid","iterations","oldPercent","needEnableAfterInstall","restartWorker","clearTimeout","timeoutHandle","worker","SystemGetModuleInstallStatus","cbRefreshModuleStatus","setTimeout","i_status","d_status","d_error","ext_UpdateModuleError","d_status_progress","document","ready"],"mappings":"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","sourcesContent":["/*\n * Copyright (C) MIKO LLC - All Rights Reserved\n * Unauthorized copying of this file, via any medium is strictly prohibited\n * Proprietary and confidential\n * Written by Nikolay Beketov, 7 2018\n *\n */\n\n/* global globalRootUrl, PbxApi, globalTranslate, UpdateApi, UserMessage */\n\nconst licensing = {\n\tparams: undefined,\n\tcallback: undefined,\n\tcaptureFeature(params, callback) {\n\t\tlicensing.params = params;\n\t\tlicensing.callback = callback;\n\t\t$.api({\n\t\t\turl: `${globalRootUrl}licensing/captureFeatureForProductId`,\n\t\t\ton: 'now',\n\t\t\tmethod: 'POST',\n\t\t\tdata: {\n\t\t\t\tlicFeatureId: licensing.params.licFeatureId,\n\t\t\t\tlicProductId: licensing.params.licProductId,\n\t\t\t},\n\t\t\tsuccessTest(response) {\n\t\t\t\t// test whether a JSON response is valid\n\t\t\t\treturn response !== undefined\n\t\t\t\t\t&& Object.keys(response).length > 0\n\t\t\t\t\t&& response.success === true;\n\t\t\t},\n\t\t\tonSuccess: licensing.cbAfterFeatureCaptured,\n\t\t\tonFailure: licensing.cbAfterFailureFeatureCaptured,\n\n\t\t});\n\t},\n\tcbAfterFeatureCaptured() {\n\t\tlicensing.callback(licensing.params);\n\t},\n\tcbAfterFailureFeatureCaptured(response) {\n\t\tif (response !== undefined\n\t\t\t&& Object.keys(response).length > 0\n\t\t\t&& response.message.length > 0) {\n\t\t\tUserMessage.showError(response.message);\n\t\t} else {\n\t\t\tUserMessage.showError(globalTranslate.ext_NoLicenseAvailable);\n\t\t}\n\t\t$('a.button').removeClass('disabled');\n\t},\n};\n\nlet upgradeStatusLoopWorker = {};\nconst extensionModules = {\n\t$checkboxes: $('.module-row .checkbox'),\n\t$deleteModalForm: $('#delete-modal-form'),\n\t$keepSettingsCheckbox: $('#keepModuleSettings'),\n\tinitialize() {\n\t\textensionModules.$deleteModalForm.modal();\n\t\tUpdateApi.getModulesUpdates(extensionModules.cbParseModuleUpdates);\n\t\textensionModules.$checkboxes\n\t\t\t.checkbox({\n\t\t\t\tonChecked() {\n\t\t\t\t\tconst uniqid = $(this).closest('tr').attr('id');\n\t\t\t\t\textensionModules.enableModule(uniqid, PbxApi.SystemReloadModule);\n\t\t\t\t},\n\t\t\t\tonUnchecked() {\n\t\t\t\t\tconst uniqid = $(this).closest('tr').attr('id');\n\t\t\t\t\textensionModules.disableModule(uniqid, PbxApi.SystemReloadModule);\n\t\t\t\t},\n\t\t\t});\n\t},\n\t/**\n\t * Обработка списка модулей полученнх с сайта\n\t * @param response\n\t */\n\tcbParseModuleUpdates(response) {\n\t\tresponse.modules.forEach((obj) => {\n\t\t\t// Ищем среди установленных\n\t\t\tconst $moduleRow = $(`tr.module-row#${obj.uniqid}`);\n\t\t\tif ($moduleRow.length > 0) {\n\t\t\t\tconst oldVer = $moduleRow.find('td.version').text();\n\t\t\t\tconst newVer = obj.version;\n\t\t\t\tif (extensionModules.versionCompare(newVer, oldVer) > 0) {\n\t\t\t\t\textensionModules.addUpdateButtonToRow(obj);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tconst $newModuleRow = $(`tr.new-module-row#${obj.uniqid}`);\n\t\t\t\tif ($newModuleRow.length > 0) {\n\t\t\t\t\tconst oldVer = $newModuleRow.find('td.version').text();\n\t\t\t\t\tconst newVer = obj.version;\n\t\t\t\t\tif (extensionModules.versionCompare(newVer, oldVer) > 0) {\n\t\t\t\t\t\t$newModuleRow.remove();\n\t\t\t\t\t\textensionModules.addModuleDescription(obj);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\textensionModules.addModuleDescription(obj);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\t$('a.download').on('click', (e) => {\n\t\t\te.preventDefault();\n\t\t\t$('a.button').addClass('disabled');\n\t\t\tconst params = {};\n\t\t\tconst $aLink = $(e.target).closest('a');\n\t\t\t$aLink.removeClass('disabled');\n\t\t\tparams.uniqid = $aLink.attr('data-uniqid');\n\t\t\tparams.releaseId = $aLink.attr('data-id');\n\t\t\tparams.size = $aLink.attr('data-size');\n\t\t\tparams.licProductId = $aLink.attr('data-productid');\n\t\t\tparams.licFeatureId = $aLink.attr('data-featureid');\n\t\t\tparams.action = 'install';\n\t\t\tparams.aLink = $aLink;\n\n\t\t\tlicensing.captureFeature(params, extensionModules.cbAfterLicenseCheck);\n\t\t});\n\t\t$('a.update').on('click', (e) => {\n\t\t\te.preventDefault();\n\t\t\t$('a.button').addClass('disabled');\n\t\t\tconst params = {};\n\t\t\tconst $aLink = $(e.target).closest('a');\n\t\t\t$aLink.removeClass('disabled');\n\t\t\tparams.licProductId = $aLink.attr('data-productid');\n\t\t\tparams.licFeatureId = $aLink.attr('data-featureid');\n\t\t\tparams.action = 'update';\n\t\t\tparams.releaseId = $aLink.attr('data-id');\n\t\t\tparams.uniqid = $aLink.attr('data-uniqid');\n\t\t\tparams.size = $aLink.attr('data-size');\n\t\t\tparams.aLink = $aLink;\n\t\t\tlicensing.captureFeature(params, extensionModules.cbAfterLicenseCheck);\n\t\t});\n\t\t$('a.delete').on('click', (e) => {\n\t\t\te.preventDefault();\n\t\t\t$('a.button').addClass('disabled');\n\t\t\t$(e.target).closest('a').removeClass('disabled');\n\t\t\tconst params = [];\n\t\t\tconst $aLink = $(e.target).closest('tr');\n\t\t\tparams.uniqid = $aLink.attr('id');\n\t\t\textensionModules.deleteModule(params);\n\t\t});\n\t\t$('a[data-content]').popup();\n\t},\n\t/**\n\t * Добавляет описание доступного модуля\n\t * @param obj\n\t */\n\taddModuleDescription(obj) {\n\t\t$('#online-updates-block').show();\n\t\tlet promoLink = '';\n\t\tif (obj.promo_link !== undefined && obj.promo_link !== null) {\n\t\t\tpromoLink = `<br><a href=\"${obj.promo_link}\" target=\"_blank\">${globalTranslate.ext_ExternalDescription}</a>`;\n\t\t}\n\t\tconst dymanicRow = `\n\t\t\t<tr class=\"new-module-row\" id=\"${obj.uniqid}\">\n\t\t\t\t\t\t<td>${decodeURIComponent(obj.name)}<br>\n\t\t\t\t\t\t<span class=\"features\">${decodeURIComponent(obj.description)} ${promoLink}</span>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t\t<td>${decodeURIComponent(obj.developer)}</td>\n\t\t\t\t\t\t<td class=\"center aligned version\">${obj.version}</td>\n\t\t\t\t\t\t<td class=\"right aligned collapsing\">\n    \t\t\t\t\t\t<div class=\"ui small basic icon buttons action-buttons\">\n    \t\t\t\t\t\t\t<a href=\"#\" class=\"ui button download\" \n\t\t\t\t\t\t\t\t\tdata-content= \"${globalTranslate.ext_InstallModule}\"\n\t\t\t\t\t\t\t\t\tdata-uniqid = \"${obj.uniqid}\"\n\t\t\t\t\t\t\t\t\tdata-size = \"${obj.size}\"\n\t\t\t\t\t\t\t\t\tdata-productId = \"${obj.lic_product_id}\"\n\t\t\t\t\t\t\t\t\tdata-featureId = \"${obj.lic_feature_id}\" \n\t\t\t\t\t\t\t\t\tdata-id =\"${obj.release_id}\">\n\t\t\t\t\t\t\t\t\t<i class=\"icon download blue\"></i> \n\t\t\t\t\t\t\t\t\t<span class=\"percent\"></span>\n\t\t\t\t\t\t\t\t</a>\n    \t\t\t\t\t\t</div>\n\t\t\t</tr>`;\n\t\t$('#new-modules-table tbody').append(dymanicRow);\n\t},\n\n\t/**\n\t * Добавляет кнопку обновления старой версии PBX\n\t * @param obj\n\t */\n\taddUpdateButtonToRow(obj) {\n\t\tconst $moduleRow = $(`tr.module-row#${obj.uniqid}`);\n\t\tconst $currentUpdateButton = $(`tr.module-row#${obj.uniqid}`).find('a.update');\n\t\tif ($currentUpdateButton.length > 0) {\n\t\t\tconst oldVer = $currentUpdateButton.attr('data-ver');\n\t\t\tconst newVer = obj.version;\n\t\t\tif (extensionModules.versionCompare(newVer, oldVer) <= 0) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\t$currentUpdateButton.remove();\n\t\tconst dynamicButton\n\t\t\t= `<a href=\"#\" class=\"ui button update popuped\" \n\t\t\tdata-content=\"${globalTranslate.ext_UpdateModule}\"\n\t\t\tdata-ver =\"${obj.version}\"\n\t\t\tdata-uniqid =\"${obj.uniqid}\" \n\t\t\tdata-productId = \"${obj.lic_product_id}\"\n\t\t\tdata-featureId = \"${obj.lic_feature_id}\" \n\t\t\tdata-id =\"${obj.release_id}\">\n\t\t\t<i class=\"icon redo blue\"></i> \n\t\t\t<span class=\"percent\"></span>\n\t\t\t</a>`;\n\t\t$moduleRow.find('.action-buttons').prepend(dynamicButton);\n\t},\n\t/**\n\t * Если фича захвачена, обращаемся к серверу\n\t * обновлений за получениием дистрибутива\n\t * @param params\n\t * @returns {boolean}\n\t */\n\tcbAfterLicenseCheck(params) {\n\t\tUpdateApi.GetModuleInstallLink(\n\t\t\tparams,\n\t\t\textensionModules.cbGetModuleInstallLinkSuccess,\n\t\t\textensionModules.cbGetModuleInstallLinkFailure,\n\t\t);\n\t},\n\t/**\n\t * Если сайт вернул ссылку на обновление\n\t * @param params\n\t * @param response\n\t */\n\tcbGetModuleInstallLinkSuccess(params, response) {\n\t\tconst newParams = params;\n\t\tresponse.modules.forEach((obj) => {\n\t\t\tnewParams.md5 = obj.md5;\n\t\t\tnewParams.updateLink = obj.href;\n\t\t\tif (newParams.action === 'update') {\n\t\t\t\textensionModules.updateModule(newParams);\n\t\t\t\tparams.aLink.find('i').addClass('loading');\n\t\t\t} else {\n\t\t\t\tparams.aLink.find('i').addClass('loading redo').removeClass('download');\n\t\t\t\textensionModules.installModule(newParams, false);\n\t\t\t}\n\t\t});\n\t},\n\t/**\n\t * Если сайт отказал в обновлении, не захвачена нужная фича\n\t */\n\tcbGetModuleInstallLinkFailure(params) {\n\t\t$('a.button').removeClass('disabled');\n\t\tif (params.action === 'update') {\n\t\t\tparams.aLink.find('i').removeClass('loading');\n\t\t} else {\n\t\t\tparams.aLink.find('i').removeClass('loading redo').addClass('download');\n\t\t}\n\t\tUserMessage.showError(globalTranslate.ext_GetLinkError);\n\t},\n\t/**\n\t * Сначала отключим модуль, если получится, то отправим команду на обновление\n\t * и обновим страничку\n\t * @param params - параметры запроса\n\t */\n\tupdateModule(params) {\n\t\t// Проверим включен ли модуль, если включен, вырубим его\n\t\tconst status = $(`#${params.uniqid}`).find('.checkbox').checkbox('is checked');\n\t\tif (status === true) {\n\t\t\textensionModules.disableModule(params.uniqid, () => {\n\t\t\t\textensionModules.installModule(params, true);\n\t\t\t});\n\t\t} else {\n\t\t\textensionModules.installModule(params, false);\n\t\t}\n\t},\n\t/**\n\t * Обновление модуля\n\t * @param params - параметры запроса\n\t */\n\tinstallModule(params, needEnable) {\n\t\tPbxApi.SystemInstallModule(params);\n\t\tupgradeStatusLoopWorker.initialize(params.uniqid, needEnable);\n\t},\n\t/**\n\t * Включить модуль, с проверкой ссылочной целостности\n\t * @param params - параметры запроса.\n\t * @param cbAfterEnable - колбек функция\n\t */\n\tenableModule(uniqid, cbAfterEnable) {\n\t\t$('.ui.message.ajax').remove();\n\t\t$.api({\n\t\t\turl: `${globalRootUrl}pbx-extension-modules/enable/{uniqid}`,\n\t\t\ton: 'now',\n\t\t\turlData: {\n\t\t\t\tuniqid,\n\t\t\t},\n\t\t\tonSuccess(response) {\n\t\t\t\tif (response.success) {\n\t\t\t\t\t$(`#${uniqid} .disability`).removeClass('disabled');\n\t\t\t\t\t$(`#${uniqid}`).find('.checkbox').checkbox('set checked');\n\t\t\t\t\tcbAfterEnable(uniqid);\n\t\t\t\t} else {\n\t\t\t\t\t$(`#${uniqid}`).find('.checkbox').checkbox('set unchecked');\n\t\t\t\t\tUserMessage.showMultiString(response.message);\n\t\t\t\t}\n\t\t\t},\n\n\t\t});\n\t},\n\t/**\n\t * Выключить модуль, с проверкой ссылочной целостности\n\t * @param uniqid - ID модуля\n\t * @param cbAfterDisable - колбек функция\n\t */\n\tdisableModule(uniqid, cbAfterDisable) {\n\t\t$('.ui.message.ajax').remove();\n\t\t$.api({\n\t\t\turl: `${globalRootUrl}pbx-extension-modules/disable/{uniqid}`,\n\t\t\ton: 'now',\n\t\t\turlData: {\n\t\t\t\tuniqid,\n\t\t\t},\n\t\t\tonSuccess(response) {\n\t\t\t\tif (response.success) {\n\t\t\t\t\t$(`#${uniqid} .disability`).addClass('disabled');\n\t\t\t\t\t$(`#${uniqid}`).find('.checkbox').checkbox('set unchecked');\n\t\t\t\t\tcbAfterDisable(uniqid);\n\t\t\t\t} else {\n\t\t\t\t\t$(`#${uniqid}`).find('.checkbox').checkbox('set checked');\n\t\t\t\t\tUserMessage.showMultiString(response.message);\n\t\t\t\t\t$(`#${uniqid}`).find('i').removeClass('loading');\n\t\t\t\t}\n\t\t\t},\n\n\t\t});\n\t},\n\t/**\n\t * Перезапуск модуля и перезагрузка страницы\n\t * @param uniqid - ID модуля\n\t */\n\treloadModuleAndPage(uniqid) {\n\t\tPbxApi.SystemReloadModule(uniqid);\n\t\twindow.location = `${globalRootUrl}pbx-extension-modules/index/`;\n\t},\n\t/**\n\t * Сначала отключим модуль, если получится, то отправим команду на удаление\n\t * и обновим страничку\n\t * @param params - параметры запроса.\n\t */\n\tdeleteModule(params) {\n\t\t// Cпросим пользователя сохранять ли настройки\n\t\textensionModules.$deleteModalForm\n\t\t\t.modal({\n\t\t\t\tclosable: false,\n\t\t\t\tonDeny: () => {\n\t\t\t\t\t$('a.button').removeClass('disabled');\n\t\t\t\t\treturn true;\n\t\t\t\t},\n\t\t\t\tonApprove: () => {\n\t\t\t\t\t// Проверим включен ли модуль, если включен, вырубим его\n\t\t\t\t\tconst status = $(`#${params.uniqid}`).find('.checkbox').checkbox('is checked');\n\t\t\t\t\tconst keepSettings = extensionModules.$keepSettingsCheckbox.checkbox('is checked');\n\t\t\t\t\tif (status === true) {\n\t\t\t\t\t\textensionModules.disableModule(params.uniqid, () => {\n\t\t\t\t\t\t\tPbxApi.SystemDeleteModule(\n\t\t\t\t\t\t\t\tparams.uniqid,\n\t\t\t\t\t\t\t\tkeepSettings,\n\t\t\t\t\t\t\t\textensionModules.cbAfterDelete,\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tPbxApi.SystemDeleteModule(params.uniqid, keepSettings, extensionModules.cbAfterDelete);\n\t\t\t\t\t}\n\t\t\t\t\treturn true;\n\t\t\t\t},\n\t\t\t})\n\t\t\t.modal('show');\n\t},\n\t/**\n\t * Обработчик команды uninstall для модуля\n\t * Если успешно, перегрузим страницу, если нет, то сообщим об ошибке\n\t * @param result - результат удаления модуля\n\t */\n\tcbAfterDelete(result) {\n\t\t$('a.button').removeClass('disabled');\n\t\tif (result === true) {\n\t\t\twindow.location = `${globalRootUrl}pbx-extension-modules/index/`;\n\t\t} else {\n\t\t\t$('.ui.message.ajax').remove();\n\t\t\tlet errorMessage = (result.data !== undefined) ? result.data : '';\n\t\t\terrorMessage = errorMessage.replace(/\\n/g, '<br>');\n\t\t\tUserMessage.showError(errorMessage, globalTranslate.ext_DeleteModuleError);\n\t\t}\n\t},\n\t/**\n\t * Сравнение версий модулей\n\t * @param v1\n\t * @param v2\n\t * @param options\n\t * @returns {number}\n\t */\n\tversionCompare(v1, v2, options) {\n\t\tconst lexicographical = options && options.lexicographical;\n\t\tconst zeroExtend = options && options.zeroExtend;\n\t\tlet v1parts = v1.split('.');\n\t\tlet v2parts = v2.split('.');\n\n\t\tfunction isValidPart(x) {\n\t\t\treturn (lexicographical ? /^\\d+[A-Za-z]*$/ : /^\\d+$/).test(x);\n\t\t}\n\n\t\tif (!v1parts.every(isValidPart) || !v2parts.every(isValidPart)) {\n\t\t\treturn NaN;\n\t\t}\n\n\t\tif (zeroExtend) {\n\t\t\twhile (v1parts.length < v2parts.length) v1parts.push('0');\n\t\t\twhile (v2parts.length < v1parts.length) v2parts.push('0');\n\t\t}\n\n\t\tif (!lexicographical) {\n\t\t\tv1parts = v1parts.map(Number);\n\t\t\tv2parts = v2parts.map(Number);\n\t\t}\n\n\t\tfor (let i = 0; i < v1parts.length; i += 1) {\n\t\t\tif (v2parts.length === i) {\n\t\t\t\treturn 1;\n\t\t\t}\n\t\t\tif (v1parts[i] === v2parts[i]) {\n\t\t\t\t//\n\t\t\t} else if (v1parts[i] > v2parts[i]) {\n\t\t\t\treturn 1;\n\t\t\t} else {\n\t\t\t\treturn -1;\n\t\t\t}\n\t\t}\n\n\t\tif (v1parts.length !== v2parts.length) {\n\t\t\treturn -1;\n\t\t}\n\n\t\treturn 0;\n\t},\n\n};\n\n\n/**\n * Мониторинг статуса обновления или установки модуля\n *\n */\nupgradeStatusLoopWorker = {\n\ttimeOut: 1000,\n\ttimeOutHandle: '',\n\tmoduleUniqid: '',\n\titerations: 0,\n\toldPercent: 0,\n\tneedEnableAfterInstall: false,\n\tinitialize(uniqid, needEnable) {\n\t\tupgradeStatusLoopWorker.moduleUniqid = uniqid;\n\t\tupgradeStatusLoopWorker.iterations = 0;\n\t\tupgradeStatusLoopWorker.needEnableAfterInstall = needEnable;\n\t\tupgradeStatusLoopWorker.restartWorker();\n\t},\n\trestartWorker() {\n\t\twindow.clearTimeout(upgradeStatusLoopWorker.timeoutHandle);\n\t\tupgradeStatusLoopWorker.worker();\n\t},\n\tworker() {\n\t\twindow.clearTimeout(upgradeStatusLoopWorker.timeoutHandle);\n\t\tPbxApi.SystemGetModuleInstallStatus(\n\t\t\tupgradeStatusLoopWorker.moduleUniqid,\n\t\t\tupgradeStatusLoopWorker.cbRefreshModuleStatus,\n\t\t);\n\t},\n\tcbRefreshModuleStatus(response) {\n\t\tupgradeStatusLoopWorker.iterations += 1;\n\t\tupgradeStatusLoopWorker.timeoutHandle =\n\t\t\twindow.setTimeout(upgradeStatusLoopWorker.worker, upgradeStatusLoopWorker.timeOut);\n\t\tif (response.length === 0 || response === false) return;\n\t\tif (response.i_status === true) {\n\t\t\t$('a.button').removeClass('disabled');\n\t\t\tsetTimeout(() => {\n\t\t\t\tif (upgradeStatusLoopWorker.needEnableAfterInstall) {\n\t\t\t\t\textensionModules.enableModule(\n\t\t\t\t\t\tupgradeStatusLoopWorker.moduleUniqid,\n\t\t\t\t\t\textensionModules.reloadModuleAndPage,\n\t\t\t\t\t);\n\t\t\t\t} else {\n\t\t\t\t\twindow.location = `${globalRootUrl}pbx-extension-modules/index/`;\n\t\t\t\t}\n\t\t\t}, 3000);\n\n\t\t\twindow.clearTimeout(upgradeStatusLoopWorker.timeoutHandle);\n\t\t}\n\t\tif (upgradeStatusLoopWorker.iterations > 50 || response.d_status === 'DOWNLOAD_ERROR') {\n\t\t\twindow.clearTimeout(upgradeStatusLoopWorker.timeoutHandle);\n\t\t\tlet errorMessage = (response.d_error !== undefined) ? response.d_error : '';\n\t\t\terrorMessage = errorMessage.replace(/\\n/g, '<br>');\n\t\t\tUserMessage.showError(errorMessage, globalTranslate.ext_UpdateModuleError);\n\t\t\t$(`#${upgradeStatusLoopWorker.moduleUniqid}`).find('i').removeClass('loading');\n\t\t\t$('.new-module-row').find('i').addClass('download').removeClass('redo');\n\t\t\t$('a.button').removeClass('disabled');\n\t\t} else if (response.d_status === 'DOWNLOAD_IN_PROGRESS' || response.d_status === 'DOWNLOAD_COMPLETE') {\n\t\t\tif (upgradeStatusLoopWorker.oldPercent !== response.d_status_progress) {\n\t\t\t\tupgradeStatusLoopWorker.iterations = 0;\n\t\t\t}\n\t\t\t$('i.loading.redo').closest('a').find('.percent').text(`${response.d_status_progress}%`);\n\t\t\tupgradeStatusLoopWorker.oldPercent = response.d_status_progress;\n\t\t}\n\t},\n};\n\n\n$(document).ready(() => {\n\textensionModules.initialize();\n});\n"],"file":"pbx-extension-modules-index.js"}