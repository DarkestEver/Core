"use strict";

/*
 * Copyright (C) MIKO LLC - All Rights Reserved
 * Unauthorized copying of this file, via any medium is strictly prohibited
 * Proprietary and confidential
 * Written by Nikolay Beketov, 12 2019
 *
 */

/* global globalRootUrl, ivrActions, globalTranslate, Form, Extensions */
$.fn.form.settings.rules.existRule = function () {
  return $('#extension-error').hasClass('hidden');
};

var ivrMenu = {
  $formObj: $('#ivr-menu-form'),
  $number: $('#extension'),
  $dirrtyField: $('#dirrty'),
  $errorMessages: $('#form-error-messages'),
  $rowTemplate: $('#row-template'),
  defaultExtension: '',
  actionsRowsCount: 0,
  validateRules: {
    name: {
      identifier: 'name',
      rules: [{
        type: 'empty',
        prompt: globalTranslate.iv_ValidateNameIsEmpty
      }]
    },
    extension: {
      identifier: 'extension',
      rules: [{
        type: 'empty',
        prompt: globalTranslate.iv_ValidateExtensionIsEmpty
      }, {
        type: 'existRule',
        prompt: globalTranslate.iv_ValidateExtensionIsDouble
      }]
    },
    timeout_extension: {
      identifier: 'timeout_extension',
      rules: [{
        type: 'empty',
        prompt: globalTranslate.iv_ValidateTimeoutExtensionIsEmpty
      }]
    },
    audio_message_id: {
      identifier: 'audio_message_id',
      rules: [{
        type: 'empty',
        prompt: globalTranslate.iv_ValidateAudioFileIsEmpty
      }]
    },
    timeout: {
      identifier: 'timeout',
      rules: [{
        type: 'integer[0..99]',
        prompt: globalTranslate.iv_ValidateTimeoutOutOfRange
      }]
    },
    number_of_repeat: {
      identifier: 'number_of_repeat',
      rules: [{
        type: 'integer[0..99]',
        prompt: globalTranslate.iv_ValidateRepeatNumberOutOfRange
      }]
    }
  },
  initialize: function () {
    function initialize() {
      $('.ui.dropdown').dropdown(); // Динамическая прововерка свободен ли выбранный номер

      ivrMenu.$number.on('change', function () {
        var newNumber = ivrMenu.$formObj.form('get value', 'extension');
        Extensions.checkAvailability(ivrMenu.defaultNumber, newNumber);
      });
      $('#add-new-ivr-action').on('click', function (el) {
        ivrMenu.addNewActionRow();
        ivrMenu.rebuildActionExtensionsDropdown();
        ivrMenu.$dirrtyField.val(Math.random());
        ivrMenu.$dirrtyField.trigger('change');
        el.preventDefault();
      });
      ivrMenu.initializeForm();
      ivrMenu.buildIvrMenuActions();
      ivrMenu.defaultExtension = ivrMenu.$formObj.form('get value', 'extension');
    }

    return initialize;
  }(),
  buildIvrMenuActions: function () {
    function buildIvrMenuActions() {
      var objActions = JSON.parse(ivrActions);
      objActions.forEach(function (element) {
        ivrMenu.addNewActionRow(element);
      });
      if (objActions.length === 0) ivrMenu.addNewActionRow();
      ivrMenu.rebuildActionExtensionsDropdown();
    }

    return buildIvrMenuActions;
  }(),
  addNewFormRules: function () {
    function addNewFormRules(newRowId) {
      var $digitsClass = "digits-".concat(newRowId);
      ivrMenu.validateRules[$digitsClass] = {
        identifier: $digitsClass,
        rules: [{
          type: 'regExp[/^[0-9]{1,7}$/]',
          prompt: globalTranslate.iv_ValidateDigitsIsNotCorrect
        }, {
          type: 'checkDoublesDigits',
          prompt: globalTranslate.iv_ValidateDigitsIsNotCorrect
        }]
      };
      var $extensionClass = "extension-".concat(newRowId);
      ivrMenu.validateRules[$extensionClass] = {
        identifier: $extensionClass,
        rules: [{
          type: 'empty',
          prompt: globalTranslate.iv_ValidateExtensionIsNotCorrect
        }]
      };
    }

    return addNewFormRules;
  }(),
  addNewActionRow: function () {
    function addNewActionRow(paramObj) {
      var param = {
        id: '',
        extension: '',
        extensionRepresent: '',
        digits: ''
      };

      if (paramObj !== undefined) {
        param = paramObj;
      }

      ivrMenu.actionsRowsCount += 1;
      var $actionTemplate = ivrMenu.$rowTemplate.clone();
      $actionTemplate.removeClass('hidden').attr('id', "row-".concat(ivrMenu.actionsRowsCount)).attr('data-value', ivrMenu.actionsRowsCount).attr('style', '');
      $actionTemplate.find('input[name="digits-id"]').attr('id', "digits-".concat(ivrMenu.actionsRowsCount)).attr('name', "digits-".concat(ivrMenu.actionsRowsCount)).attr('value', param.digits);
      $actionTemplate.find('input[name="extension-id"]').attr('id', "extension-".concat(ivrMenu.actionsRowsCount)).attr('name', "extension-".concat(ivrMenu.actionsRowsCount)).attr('value', param.extension);
      $actionTemplate.find('div.delete-action-row').attr('data-value', ivrMenu.actionsRowsCount);

      if (param.extensionRepresent.length > 0) {
        $actionTemplate.find('div.default.text').removeClass('default').html(param.extensionRepresent);
      } else {
        $actionTemplate.find('div.default.text').html(globalTranslate.ex_SelectNumber);
      }

      $('#actions-place').append($actionTemplate);
      ivrMenu.addNewFormRules(ivrMenu.actionsRowsCount);
    }

    return addNewActionRow;
  }(),
  rebuildActionExtensionsDropdown: function () {
    function rebuildActionExtensionsDropdown() {
      $('.forwarding-select').dropdown(Extensions.getDropdownSettingsWithoutEmpty(ivrMenu.cbOnExtensionSelect));
      Extensions.fixBugDropdownIcon();
      $('.delete-action-row').on('click', function (e) {
        e.preventDefault();
        var id = $(this).attr('data-value');
        delete ivrMenu.validateRules["digits-".concat(id)];
        delete ivrMenu.validateRules["extension-".concat(id)];
        $("#row-".concat(id)).remove();
        ivrMenu.$dirrtyField.val(Math.random());
        ivrMenu.$dirrtyField.trigger('change');
      });
    }

    return rebuildActionExtensionsDropdown;
  }(),
  cbBeforeSendForm: function () {
    function cbBeforeSendForm(settings) {
      var result = settings;
      result.data = ivrMenu.$formObj.form('get values');
      var arrActions = [];
      $('.action-row').each(function (index, obj) {
        var rowId = $(obj).attr('data-value');

        if (rowId > 0) {
          arrActions.push({
            digits: ivrMenu.$formObj.form('get value', "digits-".concat(rowId)),
            extension: ivrMenu.$formObj.form('get value', "extension-".concat(rowId))
          });
        }
      });

      if (arrActions.length === 0) {
        result = false;
        ivrMenu.$errorMessages.html(globalTranslate.iv_ValidateNoIVRExtensions);
        ivrMenu.$formObj.addClass('error');
      } else {
        result.data.actions = JSON.stringify(arrActions);
      }

      return result;
    }

    return cbBeforeSendForm;
  }(),

  /**
   * Срабатывает при выборе номера из выпадающего списка
   */
  cbOnExtensionSelect: function () {
    function cbOnExtensionSelect() {
      ivrMenu.$dirrtyField.val(Math.random());
      ivrMenu.$dirrtyField.trigger('change');
    }

    return cbOnExtensionSelect;
  }(),
  cbAfterSendForm: function () {
    function cbAfterSendForm() {}

    return cbAfterSendForm;
  }(),
  initializeForm: function () {
    function initializeForm() {
      Form.$formObj = ivrMenu.$formObj;
      Form.url = "".concat(globalRootUrl, "ivr-menu/save");
      Form.validateRules = ivrMenu.validateRules;
      Form.cbBeforeSendForm = ivrMenu.cbBeforeSendForm;
      Form.cbAfterSendForm = ivrMenu.cbAfterSendForm;
      Form.initialize();
    }

    return initializeForm;
  }()
};

$.fn.form.settings.rules.checkDoublesDigits = function (value) {
  var count = 0;
  $("input[id^='digits']").each(function (index, obj) {
    if (ivrMenu.$formObj.form('get value', "".concat(obj.id)) === value) count += 1;
  });
  return count === 1;
};

$(document).ready(function () {
  ivrMenu.initialize();
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9JdnJNZW51L2l2cm1lbnUtbW9kaWZ5LmpzIl0sIm5hbWVzIjpbIiQiLCJmbiIsImZvcm0iLCJzZXR0aW5ncyIsInJ1bGVzIiwiZXhpc3RSdWxlIiwiaGFzQ2xhc3MiLCJpdnJNZW51IiwiJGZvcm1PYmoiLCIkbnVtYmVyIiwiJGRpcnJ0eUZpZWxkIiwiJGVycm9yTWVzc2FnZXMiLCIkcm93VGVtcGxhdGUiLCJkZWZhdWx0RXh0ZW5zaW9uIiwiYWN0aW9uc1Jvd3NDb3VudCIsInZhbGlkYXRlUnVsZXMiLCJuYW1lIiwiaWRlbnRpZmllciIsInR5cGUiLCJwcm9tcHQiLCJnbG9iYWxUcmFuc2xhdGUiLCJpdl9WYWxpZGF0ZU5hbWVJc0VtcHR5IiwiZXh0ZW5zaW9uIiwiaXZfVmFsaWRhdGVFeHRlbnNpb25Jc0VtcHR5IiwiaXZfVmFsaWRhdGVFeHRlbnNpb25Jc0RvdWJsZSIsInRpbWVvdXRfZXh0ZW5zaW9uIiwiaXZfVmFsaWRhdGVUaW1lb3V0RXh0ZW5zaW9uSXNFbXB0eSIsImF1ZGlvX21lc3NhZ2VfaWQiLCJpdl9WYWxpZGF0ZUF1ZGlvRmlsZUlzRW1wdHkiLCJ0aW1lb3V0IiwiaXZfVmFsaWRhdGVUaW1lb3V0T3V0T2ZSYW5nZSIsIm51bWJlcl9vZl9yZXBlYXQiLCJpdl9WYWxpZGF0ZVJlcGVhdE51bWJlck91dE9mUmFuZ2UiLCJpbml0aWFsaXplIiwiZHJvcGRvd24iLCJvbiIsIm5ld051bWJlciIsIkV4dGVuc2lvbnMiLCJjaGVja0F2YWlsYWJpbGl0eSIsImRlZmF1bHROdW1iZXIiLCJlbCIsImFkZE5ld0FjdGlvblJvdyIsInJlYnVpbGRBY3Rpb25FeHRlbnNpb25zRHJvcGRvd24iLCJ2YWwiLCJNYXRoIiwicmFuZG9tIiwidHJpZ2dlciIsInByZXZlbnREZWZhdWx0IiwiaW5pdGlhbGl6ZUZvcm0iLCJidWlsZEl2ck1lbnVBY3Rpb25zIiwib2JqQWN0aW9ucyIsIkpTT04iLCJwYXJzZSIsIml2ckFjdGlvbnMiLCJmb3JFYWNoIiwiZWxlbWVudCIsImxlbmd0aCIsImFkZE5ld0Zvcm1SdWxlcyIsIm5ld1Jvd0lkIiwiJGRpZ2l0c0NsYXNzIiwiaXZfVmFsaWRhdGVEaWdpdHNJc05vdENvcnJlY3QiLCIkZXh0ZW5zaW9uQ2xhc3MiLCJpdl9WYWxpZGF0ZUV4dGVuc2lvbklzTm90Q29ycmVjdCIsInBhcmFtT2JqIiwicGFyYW0iLCJpZCIsImV4dGVuc2lvblJlcHJlc2VudCIsImRpZ2l0cyIsInVuZGVmaW5lZCIsIiRhY3Rpb25UZW1wbGF0ZSIsImNsb25lIiwicmVtb3ZlQ2xhc3MiLCJhdHRyIiwiZmluZCIsImh0bWwiLCJleF9TZWxlY3ROdW1iZXIiLCJhcHBlbmQiLCJnZXREcm9wZG93blNldHRpbmdzV2l0aG91dEVtcHR5IiwiY2JPbkV4dGVuc2lvblNlbGVjdCIsImZpeEJ1Z0Ryb3Bkb3duSWNvbiIsImUiLCJyZW1vdmUiLCJjYkJlZm9yZVNlbmRGb3JtIiwicmVzdWx0IiwiZGF0YSIsImFyckFjdGlvbnMiLCJlYWNoIiwiaW5kZXgiLCJvYmoiLCJyb3dJZCIsInB1c2giLCJpdl9WYWxpZGF0ZU5vSVZSRXh0ZW5zaW9ucyIsImFkZENsYXNzIiwiYWN0aW9ucyIsInN0cmluZ2lmeSIsImNiQWZ0ZXJTZW5kRm9ybSIsIkZvcm0iLCJ1cmwiLCJnbG9iYWxSb290VXJsIiwiY2hlY2tEb3VibGVzRGlnaXRzIiwidmFsdWUiLCJjb3VudCIsImRvY3VtZW50IiwicmVhZHkiXSwibWFwcGluZ3MiOiI7O0FBQUE7Ozs7Ozs7O0FBUUE7QUFFQUEsQ0FBQyxDQUFDQyxFQUFGLENBQUtDLElBQUwsQ0FBVUMsUUFBVixDQUFtQkMsS0FBbkIsQ0FBeUJDLFNBQXpCLEdBQXFDO0FBQUEsU0FBTUwsQ0FBQyxDQUFDLGtCQUFELENBQUQsQ0FBc0JNLFFBQXRCLENBQStCLFFBQS9CLENBQU47QUFBQSxDQUFyQzs7QUFFQSxJQUFNQyxPQUFPLEdBQUc7QUFDZkMsRUFBQUEsUUFBUSxFQUFFUixDQUFDLENBQUMsZ0JBQUQsQ0FESTtBQUVmUyxFQUFB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QUNDLFFBQXhCO0FBQ0F3RixNQUFBQSxJQUFJLENBQUNDLEdBQUwsYUFBY0MsYUFBZDtBQUNBRixNQUFBQSxJQUFJLENBQUNqRixhQUFMLEdBQXFCUixPQUFPLENBQUNRLGFBQTdCO0FBQ0FpRixNQUFBQSxJQUFJLENBQUNkLGdCQUFMLEdBQXdCM0UsT0FBTyxDQUFDMkUsZ0JBQWhDO0FBQ0FjLE1BQUFBLElBQUksQ0FBQ0QsZUFBTCxHQUF1QnhGLE9BQU8sQ0FBQ3dGLGVBQS9CO0FBQ0FDLE1BQUFBLElBQUksQ0FBQy9ELFVBQUw7QUFDQTs7QUE3TmM7QUFBQTtBQUFBLENBQWhCOztBQWdPQWpDLENBQUMsQ0FBQ0MsRUFBRixDQUFLQyxJQUFMLENBQVVDLFFBQVYsQ0FBbUJDLEtBQW5CLENBQXlCK0Ysa0JBQXpCLEdBQThDLFVBQUNDLEtBQUQsRUFBVztBQUN4RCxNQUFJQyxLQUFLLEdBQUcsQ0FBWjtBQUNBckcsRUFBQUEsQ0FBQyxDQUFDLHFCQUFELENBQUQsQ0FBeUJzRixJQUF6QixDQUE4QixVQUFDQyxLQUFELEVBQVFDLEdBQVIsRUFBZ0I7QUFDN0MsUUFBSWpGLE9BQU8sQ0FBQ0MsUUFBUixDQUFpQk4sSUFBakIsQ0FBc0IsV0FBdEIsWUFBc0NzRixHQUFHLENBQUN2QixFQUExQyxPQUFvRG1DLEtBQXhELEVBQStEQyxLQUFLLElBQUksQ0FBVDtBQUMvRCxHQUZEO0FBSUEsU0FBUUEsS0FBSyxLQUFLLENBQWxCO0FBQ0EsQ0FQRDs7QUFTQXJHLENBQUMsQ0FBQ3NHLFFBQUQsQ0FBRCxDQUFZQyxLQUFaLENBQWtCLFlBQU07QUFDdkJoRyxFQUFBQSxPQUFPLENBQUMwQixVQUFSO0FBQ0EsQ0FGRCIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4gKiBDb3B5cmlnaHQgKEMpIE1JS08gTExDIC0gQWxsIFJpZ2h0cyBSZXNlcnZlZFxuICogVW5hdXRob3JpemVkIGNvcHlpbmcgb2YgdGhpcyBmaWxlLCB2aWEgYW55IG1lZGl1bSBpcyBzdHJpY3RseSBwcm9oaWJpdGVkXG4gKiBQcm9wcmlldGFyeSBhbmQgY29uZmlkZW50aWFsXG4gKiBXcml0dGVuIGJ5IE5pa29sYXkgQmVrZXRvdiwgMTIgMjAxOVxuICpcbiAqL1xuXG4vKiBnbG9iYWwgZ2xvYmFsUm9vdFVybCwgaXZyQWN0aW9ucywgZ2xvYmFsVHJhbnNsYXRlLCBGb3JtLCBFeHRlbnNpb25zICovXG5cbiQuZm4uZm9ybS5zZXR0aW5ncy5ydWxlcy5leGlzdFJ1bGUgPSAoKSA9PiAkKCcjZXh0ZW5zaW9uLWVycm9yJykuaGFzQ2xhc3MoJ2hpZGRlbicpO1xuXG5jb25zdCBpdnJNZW51ID0ge1xuXHQkZm9ybU9iajogJCgnI2l2ci1tZW51LWZvcm0nKSxcblx0JG51bWJlcjogJCgnI2V4dGVuc2lvbicpLFxuXHQkZGlycnR5RmllbGQ6ICQoJyNkaXJydHknKSxcblx0JGVycm9yTWVzc2FnZXM6ICQoJyNmb3JtLWVycm9yLW1lc3NhZ2VzJyksXG5cdCRyb3dUZW1wbGF0ZTogJCgnI3Jvdy10ZW1wbGF0ZScpLFxuXHRkZWZhdWx0RXh0ZW5zaW9uOiAnJyxcblx0YWN0aW9uc1Jvd3NDb3VudDogMCxcblx0dmFsaWRhdGVSdWxlczoge1xuXHRcdG5hbWU6IHtcblx0XHRcdGlkZW50aWZpZXI6ICduYW1lJyxcblx0XHRcdHJ1bGVzOiBbXG5cdFx0XHRcdHtcblx0XHRcdFx0XHR0eXBlOiAnZW1wdHknLFxuXHRcdFx0XHRcdHByb21wdDogZ2xvYmFsVHJhbnNsYXRlLml2X1ZhbGlkYXRlTmFtZUlzRW1wdHksXG5cdFx0XHRcdH0sXG5cdFx0XHRdLFxuXHRcdH0sXG5cdFx0ZXh0ZW5zaW9uOiB7XG5cdFx0XHRpZGVudGlmaWVyOiAnZXh0ZW5zaW9uJyxcblx0XHRcdHJ1bGVzOiBbXG5cdFx0XHRcdHtcblx0XHRcdFx0XHR0eXBlOiAnZW1wdHknLFxuXHRcdFx0XHRcdHByb21wdDogZ2xvYmFsVHJhbnNsYXRlLml2X1ZhbGlkYXRlRXh0ZW5zaW9uSXNFbXB0eSxcblx0XHRcdFx0fSxcblx0XHRcdFx0e1xuXHRcdFx0XHRcdHR5cGU6ICdleGlzdFJ1bGUnLFxuXHRcdFx0XHRcdHByb21wdDogZ2xvYmFsVHJhbnNsYXRlLml2X1ZhbGlkYXRlRXh0ZW5zaW9uSXNEb3VibGUsXG5cdFx0XHRcdH0sXG5cdFx0XHRdLFxuXHRcdH0sXG5cdFx0dGltZW91dF9leHRlbnNpb246IHtcblx0XHRcdGlkZW50aWZpZXI6ICd0aW1lb3V0X2V4dGVuc2lvbicsXG5cdFx0XHRydWxlczogW1xuXHRcdFx0XHR7XG5cdFx0XHRcdFx0dHlwZTogJ2VtcHR5Jyxcblx0XHRcdFx0XHRwcm9tcHQ6IGdsb2JhbFRyYW5zbGF0ZS5pdl9WYWxpZGF0ZVRpbWVvdXRFeHRlbnNpb25Jc0VtcHR5LFxuXHRcdFx0XHR9LFxuXHRcdFx0XSxcblx0XHR9LFxuXHRcdGF1ZGlvX21lc3NhZ2VfaWQ6IHtcblx0XHRcdGlkZW50aWZpZXI6ICdhdWRpb19tZXNzYWdlX2lkJyxcblx0XHRcdHJ1bGVzOiBbXG5cdFx0XHRcdHtcblx0XHRcdFx0XHR0eXBlOiAnZW1wdHknLFxuXHRcdFx0XHRcdHByb21wdDogZ2xvYmFsVHJhbnNsYXRlLml2X1ZhbGlkYXRlQXVkaW9GaWxlSXNFbXB0eSxcblx0XHRcdFx0fSxcblx0XHRcdF0sXG5cdFx0fSxcblx0XHR0aW1lb3V0OiB7XG5cdFx0XHRpZGVudGlmaWVyOiAndGltZW91dCcsXG5cdFx0XHRydWxlczogW1xuXHRcdFx0XHR7XG5cdFx0XHRcdFx0dHlwZTogJ2ludGVnZXJbMC4uOTldJyxcblx0XHRcdFx0XHRwcm9tcHQ6IGdsb2JhbFRyYW5zbGF0ZS5pdl9WYWxpZGF0ZVRpbWVvdXRPdXRPZlJhbmdlLFxuXHRcdFx0XHR9LFxuXHRcdFx0XSxcblx0XHR9LFxuXHRcdG51bWJlcl9vZl9yZXBlYXQ6IHtcblx0XHRcdGlkZW50aWZpZXI6ICdudW1iZXJfb2ZfcmVwZWF0Jyxcblx0XHRcdHJ1bGVzOiBbXG5cdFx0XHRcdHtcblx0XHRcdFx0XHR0eXBlOiAnaW50ZWdlclswLi45OV0nLFxuXHRcdFx0XHRcdHByb21wdDogZ2xvYmFsVHJhbnNsYXRlLml2X1ZhbGlkYXRlUmVwZWF0TnVtYmVyT3V0T2ZSYW5nZSxcblx0XHRcdFx0fSxcblx0XHRcdF0sXG5cdFx0fSxcblx0fSxcblxuXHRpbml0aWFsaXplKCkge1xuXHRcdCQoJy51aS5kcm9wZG93bicpLmRyb3Bkb3duKCk7XG5cblx0XHQvLyDQlNC40L3QsNC80LjRh9C10YHQutCw0Y8g0L/RgNC+0LLQvtCy0LXRgNC60LAg0YHQstC+0LHQvtC00LXQvSDQu9C4INCy0YvQsdGA0LDQvdC90YvQuSDQvdC+0LzQtdGAXG5cdFx0aXZyTWVudS4kbnVtYmVyLm9uKCdjaGFuZ2UnLCAoKSA9PiB7XG5cdFx0XHRjb25zdCBuZXdOdW1iZXIgPSBpdnJNZW51LiRmb3JtT2JqLmZvcm0oJ2dldCB2YWx1ZScsICdleHRlbnNpb24nKTtcblx0XHRcdEV4dGVuc2lvbnMuY2hlY2tBdmFpbGFiaWxpdHkoaXZyTWVudS5kZWZhdWx0TnVtYmVyLCBuZXdOdW1iZXIpO1xuXHRcdH0pO1xuXG5cdFx0JCgnI2FkZC1uZXctaXZyLWFjdGlvbicpLm9uKCdjbGljaycsIChlbCkgPT4ge1xuXHRcdFx0aXZyTWVudS5hZGROZXdBY3Rpb25Sb3coKTtcblx0XHRcdGl2ck1lbnUucmVidWlsZEFjdGlvbkV4dGVuc2lvbnNEcm9wZG93bigpO1xuXHRcdFx0aXZyTWVudS4kZGlycnR5RmllbGQudmFsKE1hdGgucmFuZG9tKCkpO1xuXHRcdFx0aXZyTWVudS4kZGlycnR5RmllbGQudHJpZ2dlcignY2hhbmdlJyk7XG5cdFx0XHRlbC5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdH0pO1xuXHRcdGl2ck1lbnUuaW5pdGlhbGl6ZUZvcm0oKTtcblxuXHRcdGl2ck1lbnUuYnVpbGRJdnJNZW51QWN0aW9ucygpO1xuXG5cdFx0aXZyTWVudS5kZWZhdWx0RXh0ZW5zaW9uID0gaXZyTWVudS4kZm9ybU9iai5mb3JtKCdnZXQgdmFsdWUnLCAnZXh0ZW5zaW9uJyk7XG5cdH0sXG5cdGJ1aWxkSXZyTWVudUFjdGlvbnMoKSB7XG5cdFx0Y29uc3Qgb2JqQWN0aW9ucyA9IEpTT04ucGFyc2UoaXZyQWN0aW9ucyk7XG5cdFx0b2JqQWN0aW9ucy5mb3JFYWNoKChlbGVtZW50KSA9PiB7XG5cdFx0XHRpdnJNZW51LmFkZE5ld0FjdGlvblJvdyhlbGVtZW50KTtcblx0XHR9KTtcblx0XHRpZiAob2JqQWN0aW9ucy5sZW5ndGggPT09IDApIGl2ck1lbnUuYWRkTmV3QWN0aW9uUm93KCk7XG5cblx0XHRpdnJNZW51LnJlYnVpbGRBY3Rpb25FeHRlbnNpb25zRHJvcGRvd24oKTtcblx0fSxcblx0YWRkTmV3Rm9ybVJ1bGVzKG5ld1Jvd0lkKSB7XG5cdFx0Y29uc3QgJGRpZ2l0c0NsYXNzID0gYGRpZ2l0cy0ke25ld1Jvd0lkfWA7XG5cdFx0aXZyTWVudS52YWxpZGF0ZVJ1bGVzWyRkaWdpdHNDbGFzc10gPSB7XG5cdFx0XHRpZGVudGlmaWVyOiAkZGlnaXRzQ2xhc3MsXG5cdFx0XHRydWxlczogW1xuXHRcdFx0XHR7XG5cdFx0XHRcdFx0dHlwZTogJ3JlZ0V4cFsvXlswLTldezEsN30kL10nLFxuXHRcdFx0XHRcdHByb21wdDogZ2xvYmFsVHJhbnNsYXRlLml2X1ZhbGlkYXRlRGlnaXRzSXNOb3RDb3JyZWN0LFxuXHRcdFx0XHR9LFxuXHRcdFx0XHR7XG5cdFx0XHRcdFx0dHlwZTogJ2NoZWNrRG91Ymxlc0RpZ2l0cycsXG5cdFx0XHRcdFx0cHJvbXB0OiBnbG9iYWxUcmFuc2xhdGUuaXZfVmFsaWRhdGVEaWdpdHNJc05vdENvcnJlY3QsXG5cdFx0XHRcdH0sXG5cdFx0XHRdLFxuXG5cdFx0fTtcblx0XHRjb25zdCAkZXh0ZW5zaW9uQ2xhc3MgPSBgZXh0ZW5zaW9uLSR7bmV3Um93SWR9YDtcblx0XHRpdnJNZW51LnZhbGlkYXRlUnVsZXNbJGV4dGVuc2lvbkNsYXNzXSA9IHtcblx0XHRcdGlkZW50aWZpZXI6ICRleHRlbnNpb25DbGFzcyxcblx0XHRcdHJ1bGVzOiBbXG5cdFx0XHRcdHtcblx0XHRcdFx0XHR0eXBlOiAnZW1wdHknLFxuXHRcdFx0XHRcdHByb21wdDogZ2xvYmFsVHJhbnNsYXRlLml2X1ZhbGlkYXRlRXh0ZW5zaW9uSXNOb3RDb3JyZWN0LFxuXHRcdFx0XHR9LFxuXHRcdFx0XSxcblxuXHRcdH07XG5cdH0sXG5cdGFkZE5ld0FjdGlvblJvdyhwYXJhbU9iaikge1xuXHRcdGxldCBwYXJhbSA9IHtcblx0XHRcdGlkOiAnJyxcblx0XHRcdGV4dGVuc2lvbjogJycsXG5cdFx0XHRleHRlbnNpb25SZXByZXNlbnQ6ICcnLFxuXHRcdFx0ZGlnaXRzOiAnJyxcblx0XHR9O1xuXHRcdGlmIChwYXJhbU9iaiAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0XHRwYXJhbSA9IHBhcmFtT2JqO1xuXHRcdH1cblx0XHRpdnJNZW51LmFjdGlvbnNSb3dzQ291bnQgKz0gMTtcblx0XHRjb25zdCAkYWN0aW9uVGVtcGxhdGUgPSBpdnJNZW51LiRyb3dUZW1wbGF0ZS5jbG9uZSgpO1xuXHRcdCRhY3Rpb25UZW1wbGF0ZVxuXHRcdFx0LnJlbW92ZUNsYXNzKCdoaWRkZW4nKVxuXHRcdFx0LmF0dHIoJ2lkJywgYHJvdy0ke2l2ck1lbnUuYWN0aW9uc1Jvd3NDb3VudH1gKVxuXHRcdFx0LmF0dHIoJ2RhdGEtdmFsdWUnLCBpdnJNZW51LmFjdGlvbnNSb3dzQ291bnQpXG5cdFx0XHQuYXR0cignc3R5bGUnLCAnJyk7XG5cblx0XHQkYWN0aW9uVGVtcGxhdGUuZmluZCgnaW5wdXRbbmFtZT1cImRpZ2l0cy1pZFwiXScpXG5cdFx0XHQuYXR0cignaWQnLCBgZGlnaXRzLSR7aXZyTWVudS5hY3Rpb25zUm93c0NvdW50fWApXG5cdFx0XHQuYXR0cignbmFtZScsIGBkaWdpdHMtJHtpdnJNZW51LmFjdGlvbnNSb3dzQ291bnR9YClcblx0XHRcdC5hdHRyKCd2YWx1ZScsIHBhcmFtLmRpZ2l0cyk7XG5cblx0XHQkYWN0aW9uVGVtcGxhdGUuZmluZCgnaW5wdXRbbmFtZT1cImV4dGVuc2lvbi1pZFwiXScpXG5cdFx0XHQuYXR0cignaWQnLCBgZXh0ZW5zaW9uLSR7aXZyTWVudS5hY3Rpb25zUm93c0NvdW50fWApXG5cdFx0XHQuYXR0cignbmFtZScsIGBleHRlbnNpb24tJHtpdnJNZW51LmFjdGlvbnNSb3dzQ291bnR9YClcblx0XHRcdC5hdHRyKCd2YWx1ZScsIHBhcmFtLmV4dGVuc2lvbik7XG5cdFx0JGFjdGlvblRlbXBsYXRlLmZpbmQoJ2Rpdi5kZWxldGUtYWN0aW9uLXJvdycpXG5cdFx0XHQuYXR0cignZGF0YS12YWx1ZScsIGl2ck1lbnUuYWN0aW9uc1Jvd3NDb3VudCk7XG5cblx0XHRpZiAocGFyYW0uZXh0ZW5zaW9uUmVwcmVzZW50Lmxlbmd0aCA+IDApIHtcblx0XHRcdCRhY3Rpb25UZW1wbGF0ZS5maW5kKCdkaXYuZGVmYXVsdC50ZXh0JykucmVtb3ZlQ2xhc3MoJ2RlZmF1bHQnKS5odG1sKHBhcmFtLmV4dGVuc2lvblJlcHJlc2VudCk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdCRhY3Rpb25UZW1wbGF0ZS5maW5kKCdkaXYuZGVmYXVsdC50ZXh0JykuaHRtbChnbG9iYWxUcmFuc2xhdGUuZXhfU2VsZWN0TnVtYmVyKTtcblx0XHR9XG5cblx0XHQkKCcjYWN0aW9ucy1wbGFjZScpLmFwcGVuZCgkYWN0aW9uVGVtcGxhdGUpO1xuXHRcdGl2ck1lbnUuYWRkTmV3Rm9ybVJ1bGVzKGl2ck1lbnUuYWN0aW9uc1Jvd3NDb3VudCk7XG5cdH0sXG5cdHJlYnVpbGRBY3Rpb25FeHRlbnNpb25zRHJvcGRvd24oKSB7XG5cdFx0JCgnLmZvcndhcmRpbmctc2VsZWN0JykuZHJvcGRvd24oRXh0ZW5zaW9ucy5nZXREcm9wZG93blNldHRpbmdzV2l0aG91dEVtcHR5KGl2ck1lbnUuY2JPbkV4dGVuc2lvblNlbGVjdCkpO1xuXHRcdEV4dGVuc2lvbnMuZml4QnVnRHJvcGRvd25JY29uKCk7XG5cdFx0JCgnLmRlbGV0ZS1hY3Rpb24tcm93Jykub24oJ2NsaWNrJywgZnVuY3Rpb24gKGUpIHtcblx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdGNvbnN0IGlkID0gJCh0aGlzKS5hdHRyKCdkYXRhLXZhbHVlJyk7XG5cdFx0XHRkZWxldGUgaXZyTWVudS52YWxpZGF0ZVJ1bGVzW2BkaWdpdHMtJHtpZH1gXTtcblx0XHRcdGRlbGV0ZSBpdnJNZW51LnZhbGlkYXRlUnVsZXNbYGV4dGVuc2lvbi0ke2lkfWBdO1xuXHRcdFx0JChgI3Jvdy0ke2lkfWApLnJlbW92ZSgpO1xuXHRcdFx0aXZyTWVudS4kZGlycnR5RmllbGQudmFsKE1hdGgucmFuZG9tKCkpO1xuXHRcdFx0aXZyTWVudS4kZGlycnR5RmllbGQudHJpZ2dlcignY2hhbmdlJyk7XG5cdFx0fSk7XG5cdH0sXG5cdGNiQmVmb3JlU2VuZEZvcm0oc2V0dGluZ3MpIHtcblx0XHRsZXQgcmVzdWx0ID0gc2V0dGluZ3M7XG5cblx0XHRyZXN1bHQuZGF0YSA9IGl2ck1lbnUuJGZvcm1PYmouZm9ybSgnZ2V0IHZhbHVlcycpO1xuXHRcdGNvbnN0IGFyckFjdGlvbnMgPSBbXTtcblxuXHRcdCQoJy5hY3Rpb24tcm93JykuZWFjaCgoaW5kZXgsIG9iaikgPT4ge1xuXHRcdFx0Y29uc3Qgcm93SWQgPSAkKG9iaikuYXR0cignZGF0YS12YWx1ZScpO1xuXHRcdFx0aWYgKHJvd0lkID4gMCkge1xuXHRcdFx0XHRhcnJBY3Rpb25zLnB1c2goe1xuXHRcdFx0XHRcdGRpZ2l0czogaXZyTWVudS4kZm9ybU9iai5mb3JtKCdnZXQgdmFsdWUnLCBgZGlnaXRzLSR7cm93SWR9YCksXG5cdFx0XHRcdFx0ZXh0ZW5zaW9uOiBpdnJNZW51LiRmb3JtT2JqLmZvcm0oJ2dldCB2YWx1ZScsIGBleHRlbnNpb24tJHtyb3dJZH1gKSxcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdFx0aWYgKGFyckFjdGlvbnMubGVuZ3RoID09PSAwKSB7XG5cdFx0XHRyZXN1bHQgPSBmYWxzZTtcblx0XHRcdGl2ck1lbnUuJGVycm9yTWVzc2FnZXMuaHRtbChnbG9iYWxUcmFuc2xhdGUuaXZfVmFsaWRhdGVOb0lWUkV4dGVuc2lvbnMpO1xuXHRcdFx0aXZyTWVudS4kZm9ybU9iai5hZGRDbGFzcygnZXJyb3InKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmVzdWx0LmRhdGEuYWN0aW9ucyA9IEpTT04uc3RyaW5naWZ5KGFyckFjdGlvbnMpO1xuXHRcdH1cblx0XHRyZXR1cm4gcmVzdWx0O1xuXHR9LFxuXHQvKipcblx0ICog0KHRgNCw0LHQsNGC0YvQstCw0LXRgiDQv9GA0Lgg0LLRi9Cx0L7RgNC1INC90L7QvNC10YDQsCDQuNC3INCy0YvQv9Cw0LTQsNGO0YnQtdCz0L4g0YHQv9C40YHQutCwXG5cdCAqL1xuXHRjYk9uRXh0ZW5zaW9uU2VsZWN0KCkge1xuXHRcdGl2ck1lbnUuJGRpcnJ0eUZpZWxkLnZhbChNYXRoLnJhbmRvbSgpKTtcblx0XHRpdnJNZW51LiRkaXJydHlGaWVsZC50cmlnZ2VyKCdjaGFuZ2UnKTtcblx0fSxcblx0Y2JBZnRlclNlbmRGb3JtKCkge1xuXG5cdH0sXG5cdGluaXRpYWxpemVGb3JtKCkge1xuXHRcdEZvcm0uJGZvcm1PYmogPSBpdnJNZW51LiRmb3JtT2JqO1xuXHRcdEZvcm0udXJsID0gYCR7Z2xvYmFsUm9vdFVybH1pdnItbWVudS9zYXZlYDtcblx0XHRGb3JtLnZhbGlkYXRlUnVsZXMgPSBpdnJNZW51LnZhbGlkYXRlUnVsZXM7XG5cdFx0Rm9ybS5jYkJlZm9yZVNlbmRGb3JtID0gaXZyTWVudS5jYkJlZm9yZVNlbmRGb3JtO1xuXHRcdEZvcm0uY2JBZnRlclNlbmRGb3JtID0gaXZyTWVudS5jYkFmdGVyU2VuZEZvcm07XG5cdFx0Rm9ybS5pbml0aWFsaXplKCk7XG5cdH0sXG59O1xuXG4kLmZuLmZvcm0uc2V0dGluZ3MucnVsZXMuY2hlY2tEb3VibGVzRGlnaXRzID0gKHZhbHVlKSA9PiB7XG5cdGxldCBjb3VudCA9IDA7XG5cdCQoXCJpbnB1dFtpZF49J2RpZ2l0cyddXCIpLmVhY2goKGluZGV4LCBvYmopID0+IHtcblx0XHRpZiAoaXZyTWVudS4kZm9ybU9iai5mb3JtKCdnZXQgdmFsdWUnLCBgJHtvYmouaWR9YCkgPT09IHZhbHVlKSBjb3VudCArPSAxO1xuXHR9KTtcblxuXHRyZXR1cm4gKGNvdW50ID09PSAxKTtcbn07XG5cbiQoZG9jdW1lbnQpLnJlYWR5KCgpID0+IHtcblx0aXZyTWVudS5pbml0aWFsaXplKCk7XG59KTtcblxuIl19