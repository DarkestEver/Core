{"version":3,"sources":["../../src/main/form.js"],"names":["Form","$formObj","validateRules","url","cbBeforeSendForm","cbAfterSendForm","$submitButton","$","$dropdownSubmit","$submitModeInput","processData","contentType","keyboardShortcuts","enableDirrity","configWorkerEnabled","oldFormValues","initialize","initializeDirrity","on","e","preventDefault","hasClass","form","fields","onSuccess","submitForm","onFailure","removeClass","addClass","length","dropdown","onChange","value","translateKey","val","html","globalTranslate","click","saveInitialValues","setEvents","find","change","checkValues","newFormValues","JSON","stringify","api","method","beforeSend","settings","cbBeforeSendResult","transition","each","data","index","indexOf","trim","response","remove","requestWithoutErrors","message","after","event","document","createEvent","initEvent","window","dispatchEvent","ConfigWorker","restartWorker","success","reload","location","globalRootUrl","emptyUrl","href","split"],"mappings":"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","sourcesContent":["/*\n * Copyright (C) MIKO LLC - All Rights Reserved\n * Unauthorized copying of this file, via any medium is strictly prohibited\n * Proprietary and confidential\n * Written by Nikolay Beketov, 7 2018\n *\n */\n\n/* global globalRootUrl , ConfigWorker, globalTranslate */\n\nconst Form = {\n\t$formObj: '',\n\tvalidateRules: {},\n\turl: '',\n\tcbBeforeSendForm: '',\n\tcbAfterSendForm: '',\n\t$submitButton: $('#submitbutton'),\n\t$dropdownSubmit: $('#dropdownSubmit'),\n\t$submitModeInput: $('input[name=\"submitMode\"]'),\n\tprocessData: true,\n\tcontentType: 'application/x-www-form-urlencoded; charset=UTF-8',\n\tkeyboardShortcuts: true,\n\tenableDirrity: true,\n\tconfigWorkerEnabled: true,\n\toldFormValues: [],\n\tinitialize() {\n\t\tif (Form.enableDirrity) Form.initializeDirrity();\n\n\t\tForm.$submitButton.on('click', (e) => {\n\t\t\te.preventDefault();\n\t\t\tif (Form.$submitButton.hasClass('loading')) return;\n\t\t\tif (Form.$submitButton.hasClass('disabled')) return;\n\t\t\tForm.$formObj\n\t\t\t\t.form({\n\t\t\t\t\ton: 'blur',\n\t\t\t\t\tfields: Form.validateRules,\n\t\t\t\t\tonSuccess() {\n\t\t\t\t\t\tForm.submitForm();\n\t\t\t\t\t},\n\t\t\t\t\tonFailure() {\n\t\t\t\t\t\tForm.$formObj.removeClass('error').addClass('error');\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\tForm.$formObj.form('validate form');\n\t\t});\n\t\tif (Form.$dropdownSubmit.length > 0) {\n\t\t\tForm.$dropdownSubmit.dropdown({\n\t\t\t\tonChange: (value) => {\n\t\t\t\t\tconst translateKey = `bt_${value}`;\n\t\t\t\t\tForm.$submitModeInput.val(value);\n\t\t\t\t\tForm.$submitButton\n\t\t\t\t\t\t.html(`<i class=\"save icon\"></i> ${globalTranslate[translateKey]}`)\n\t\t\t\t\t\t.click();\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\t\tForm.$formObj.on('submit', (e) => {\n\t\t\te.preventDefault();\n\t\t});\n\t},\n\t/**\n\t * Инициализация отслеживания изменений формы\n\t */\n\tinitializeDirrity() {\n\t\tForm.saveInitialValues();\n\t\tForm.setEvents();\n\t\tForm.$submitButton.addClass('disabled');\n\t\tForm.$dropdownSubmit.addClass('disabled');\n\t},\n\t/**\n\t * Сохраняет первоначальные значения для проверки на изменения формы\n\t */\n\tsaveInitialValues() {\n\t\tForm.oldFormValues = Form.$formObj.form('get values');\n\t},\n\t/**\n\t * Запускает обработчики изменения объектов формы\n\t */\n\tsetEvents() {\n\t\tForm.$formObj.find('input, select').change(() => {\n\t\t\tForm.checkValues();\n\t\t});\n\t\tForm.$formObj.find('input, textarea').on('keyup keydown blur', () => {\n\t\t\tForm.checkValues();\n\t\t});\n\t\tForm.$formObj.find('.ui.checkbox').on('click', () => {\n\t\t\tForm.checkValues();\n\t\t});\n\t},\n\t/**\n\t * Сверяет изменения старых и новых значений формы\n\t */\n\tcheckValues() {\n\t\tconst newFormValues = Form.$formObj.form('get values');\n\t\tif (JSON.stringify(Form.oldFormValues) === JSON.stringify(newFormValues)) {\n\t\t\tForm.$submitButton.addClass('disabled');\n\t\t\tForm.$dropdownSubmit.addClass('disabled');\n\t\t} else {\n\t\t\tForm.$submitButton.removeClass('disabled');\n\t\t\tForm.$dropdownSubmit.removeClass('disabled');\n\t\t}\n\t},\n\t/**\n\t * Отправка формы на сервер\n\t */\n\tsubmitForm() {\n\t\t$.api({\n\t\t\turl: Form.url,\n\t\t\ton: 'now',\n\t\t\tmethod: 'POST',\n\t\t\tprocessData: Form.processData,\n\t\t\tcontentType: Form.contentType,\n\t\t\tkeyboardShortcuts: Form.keyboardShortcuts,\n\t\t\tbeforeSend(settings) {\n\t\t\t\tForm.$submitButton.addClass('loading');\n\t\t\t\tconst cbBeforeSendResult = Form.cbBeforeSendForm(settings);\n\t\t\t\tif (cbBeforeSendResult === false) {\n\t\t\t\t\tForm.$submitButton\n\t\t\t\t\t\t.transition('shake')\n\t\t\t\t\t\t.removeClass('loading');\n\t\t\t\t} else {\n\t\t\t\t\t$.each(cbBeforeSendResult.data, (index, value) => {\n\t\t\t\t\t\tif (index.indexOf('ecret') > -1 || index.indexOf('assword') > -1) return;\n\t\t\t\t\t\tif (typeof value === 'string') cbBeforeSendResult.data[index] = value.trim();\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\treturn cbBeforeSendResult;\n\t\t\t},\n\t\t\tonSuccess(response) {\n\t\t\t\t$('.ui.message.ajax').remove();\n\t\t\t\tlet requestWithoutErrors = true;\n\t\t\t\t$.each(response.message, (index, value) => {\n\t\t\t\t\tif (index === 'error') {\n\t\t\t\t\t\tForm.$submitButton.transition('shake').removeClass('loading');\n\t\t\t\t\t\tForm.$formObj.after(`<div class=\"ui ${index} message ajax\">${value}</div>`);\n\t\t\t\t\t\trequestWithoutErrors = false;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tconst event = document.createEvent('Event');\n\t\t\t\tevent.initEvent('ConfigDataChanged', false, true);\n\t\t\t\twindow.dispatchEvent(event);\n\t\t\t\tForm.cbAfterSendForm(response);\n\t\t\t\tif (Form.configWorkerEnabled && requestWithoutErrors) ConfigWorker.restartWorker();\n\t\t\t\tif (response.success\n\t\t\t\t\t&& response.reload.length > 0\n\t\t\t\t\t&& Form.$submitModeInput.val() === 'SaveSettings') {\n\t\t\t\t\twindow.location = globalRootUrl + response.reload;\n\t\t\t\t} else if (response.success && Form.$submitModeInput.val() === 'SaveSettingsAndAddNew') {\n\t\t\t\t\tconst emptyUrl = window.location.href.split('modify');\n\t\t\t\t\tif (emptyUrl.length > 1) {\n\t\t\t\t\t\twindow.location = `${emptyUrl[0]}modify/`;\n\t\t\t\t\t}\n\t\t\t\t} else if (response.success && Form.$submitModeInput.val() === 'SaveSettingsAndExit') {\n\t\t\t\t\tconst emptyUrl = window.location.href.split('modify');\n\t\t\t\t\tif (emptyUrl.length > 1) {\n\t\t\t\t\t\twindow.location = `${emptyUrl[0]}`;\n\t\t\t\t\t}\n\t\t\t\t} else if (response.success\n\t\t\t\t\t\t&& response.reload.length > 0) {\n\t\t\t\t\twindow.location = globalRootUrl + response.reload;\n\t\t\t\t} else if (Form.enableDirrity) {\n\t\t\t\t\tForm.initializeDirrity();\n\t\t\t\t}\n\t\t\t},\n\t\t\tonFailure(response) {\n\t\t\t\tForm.$formObj.after(response);\n\t\t\t\tForm.$submitButton\n\t\t\t\t\t.transition('shake')\n\t\t\t\t\t.removeClass('loading');\n\t\t\t},\n\n\t\t});\n\t},\n};\n\n// export default Form;\n"],"file":"form.js"}