{"version":3,"sources":["../../src/main/connection-check-worker.js"],"names":["connectionCheckWorker","timeOut","timeOutHandle","errorCounts","$connectionDimmer","$","initialize","restartWorker","window","clearTimeout","timeoutHandle","worker","PbxApi","PingPBX","cbAfterResponse","setTimeout","result","dimmer","location","reload","document","ready"],"mappings":";;AAAA;;;;;;;;AAQA;AAEA,IAAMA,qBAAqB,GAAG;AAC7BC,EAAAA,OAAO,EAAE,IADoB;AAE7BC,EAAAA,aAAa,EAAE,EAFc;AAG7BC,EAAAA,WAAW,EAAE,CAHgB;AAI7BC,EAAAA,iBAAiB,EAAEC,CAAC,CAAC,oBAAD,CAJS;AAK7BC,EAAAA,UAL6B;AAAA,0BAKhB;AACZ;AACAN,MAAAA,qBAAqB,CAACO,aAAtB;AACA;;AAR4B;AAAA;AAS7BA,EAAAA,aAT6B;AAAA,6BASb;AACfC,MAAAA,MAAM,CAACC,YAAP,CAAoBT,qBAAqB,CAACU,aAA1C;AACAV,MAAAA,qBAAqB,CAACW,MAAtB;AACA;;AAZ4B;AAAA;AAa7BA,EAAAA,MAb6B;AAAA,sBAapB;AACRC,MAAAA,MAAM,CAACC,OAAP,CAAeb,qBAAqB,CAACc,eAArC;AACAd,MAAAA,qBAAqB,CAACU,aAAtB,GAAsCF,MAAM,CAACO,UAAP,CACrCf,qBAAqB,CAACW,MADe,EAErCX,qBAAqB,CAACC,OAFe,CAAtC;AAIA;;AAnB4B;AAAA;AAoB7Ba,EAAAA,eApB6B;AAAA,6BAoBbE,MApBa,EAoBL;AACvB,UAAIA,MAAM,KAAK,IAAf,EAAqB;AACpBhB,QAAAA,qBAAqB,CAACI,iBAAtB,CAAwCa,MAAxC,CAA+C,MAA/C;AACAjB,QAAAA,qBAAqB,CAACC,OAAtB,GAAgC,IAAhC;AACA,YAAID,qBAAqB,CAACG,WAAtB,GAAoC,CAAxC,EAA2CK,MAAM,CAACU,QAAP,CAAgBC,MAAhB;AAC3CnB,QAAAA,qBAAqB,CAACG,WAAtB,GAAoC,CAApC;AACA,OALD,MAKO,IAAIH,qBAAqB,CAACG,WAAtB,GAAoC,CAAxC,EAA2C;AACjDH,QAAAA,qBAAqB,CAACI,iBAAtB,CAAwCa,MAAxC,CAA+C,MAA/C;AACAjB,QAAAA,qBAAqB,CAACC,OAAtB,GAAgC,IAAhC;AACAD,QAAAA,qBAAqB,CAACG,WAAtB,IAAqC,CAArC;AACA,OAJM,MAIA;AACNH,QAAAA,qBAAqB,CAACC,OAAtB,GAAgC,IAAhC;AACAD,QAAAA,qBAAqB,CAACG,WAAtB,IAAqC,CAArC;AACA;AACD;;AAlC4B;AAAA;AAAA,CAA9B;AAsCAE,CAAC,CAACe,QAAD,CAAD,CAAYC,KAAZ,CAAkB,YAAM;AACvBrB,EAAAA,qBAAqB,CAACM,UAAtB;AACA,CAFD","sourcesContent":["/*\n * Copyright (C) MIKO LLC - All Rights Reserved\n * Unauthorized copying of this file, via any medium is strictly prohibited\n * Proprietary and confidential\n * Written by Nikolay Beketov, 7 2018\n *\n */\n\n/* global PbxApi */\n\nconst connectionCheckWorker = {\n\ttimeOut: 1000,\n\ttimeOutHandle: '',\n\terrorCounts: 0,\n\t$connectionDimmer: $('#connection-dimmer'),\n\tinitialize() {\n\t\t// Запустим обновление статуса провайдера\n\t\tconnectionCheckWorker.restartWorker();\n\t},\n\trestartWorker() {\n\t\twindow.clearTimeout(connectionCheckWorker.timeoutHandle);\n\t\tconnectionCheckWorker.worker();\n\t},\n\tworker() {\n\t\tPbxApi.PingPBX(connectionCheckWorker.cbAfterResponse);\n\t\tconnectionCheckWorker.timeoutHandle = window.setTimeout(\n\t\t\tconnectionCheckWorker.worker,\n\t\t\tconnectionCheckWorker.timeOut,\n\t\t);\n\t},\n\tcbAfterResponse(result) {\n\t\tif (result === true) {\n\t\t\tconnectionCheckWorker.$connectionDimmer.dimmer('hide');\n\t\t\tconnectionCheckWorker.timeOut = 3000;\n\t\t\tif (connectionCheckWorker.errorCounts > 5) window.location.reload();\n\t\t\tconnectionCheckWorker.errorCounts = 0;\n\t\t} else if (connectionCheckWorker.errorCounts > 3) {\n\t\t\tconnectionCheckWorker.$connectionDimmer.dimmer('show');\n\t\t\tconnectionCheckWorker.timeOut = 1000;\n\t\t\tconnectionCheckWorker.errorCounts += 1;\n\t\t} else {\n\t\t\tconnectionCheckWorker.timeOut = 1000;\n\t\t\tconnectionCheckWorker.errorCounts += 1;\n\t\t}\n\t},\n\n};\n\n$(document).ready(() => {\n\tconnectionCheckWorker.initialize();\n});\n"],"file":"connection-check-worker.js"}