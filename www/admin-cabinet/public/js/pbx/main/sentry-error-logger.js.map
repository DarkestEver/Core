{"version":3,"sources":["../../src/main/sentry-error-logger.js"],"names":["Sentry","onLoad","globalShowSentryReportDialog","hash","sentryEventId","itIsKnownError","localStorage","getItem","globalTranslate","undefined","Object","keys","length","showReportDialog","eventId","title","sntry_Title","subtitle","sntry_Subtitle","subtitle2","sntry_Subtitle2","labelComments","sntry_LabelComments","labelClose","sntry_LabelClose","labelSubmit","sntry_LabelSubmit","errorGeneric","sntry_ErrorGeneric","errorFormEntry","sntry_ErrorFormEntry","successMessage","sntry_SuccessMessage","setItem","init","dsn","release","globalPBXVersion","beforeSend","event","hint","exception","error","originalException","message","s","i","chr","charCodeAt","configureScope","scope","setUser","id","globalPBXLicense","setTag","globalLastSentryEventId"],"mappings":";;AAAA;;;;;;;;AAOA;AAEAA,MAAM,CAACC,MAAP,CAAc,YAAM;AACnB,WAASC,4BAAT,CAAsCC,IAAtC,EAA4CC,aAA5C,EAA2D;AAC1D,QAAMC,cAAc,GAAGC,YAAY,CAACC,OAAb,2BAAwCJ,IAAxC,EAAvB;;AACA,QAAIE,cAAc,KAAK,IAAvB,EAA6B;AAC5B,UAAIG,eAAe,KAAKC,SAApB,IAAiCC,MAAM,CAACC,IAAP,CAAYH,eAAZ,EAA6BI,MAA7B,GAAsC,CAA3E,EAA8E;AAC7EZ,QAAAA,MAAM,CAACa,gBAAP,CAAwB;AACvBC,UAAAA,OAAO,EAAEV,aADc;AAEvBW,UAAAA,KAAK,EAAEP,eAAe,CAACQ,WAFA;AAGvBC,UAAAA,QAAQ,EAAET,eAAe,CAACU,cAHH;AAIvBC,UAAAA,SAAS,EAAEX,eAAe,CAACY,eAJJ;AAKvBC,UAAAA,aAAa,EAAEb,eAAe,CAACc,mBALR;AAMvBC,UAAAA,UAAU,EAAEf,eAAe,CAACgB,gBANL;AAOvBC,UAAAA,WAAW,EAAEjB,eAAe,CAACkB,iBAPN;AAQvBC,UAAAA,YAAY,EAAEnB,eAAe,CAACoB,kBARP;AASvBC,UAAAA,cAAc,EAAErB,eAAe,CAACsB,oBATT;AAUvBC,UAAAA,cAAc,EAAEvB,eAAe,CAACwB;AAVT,SAAxB;AAaA,OAdD,MAcO;AACNhC,QAAAA,MAAM,CAACa,gBAAP,CAAwB;AAAEC,UAAAA,OAAO,EAAEV;AAAX,SAAxB;AACA;;AACDE,MAAAA,YAAY,CAAC2B,OAAb,2BAAwC9B,IAAxC,GAAgD,uBAAhD;AACA;AACD;;AAEDH,EAAAA,MAAM,CAACkC,IAAP,CAAY;AACXC,IAAAA,GAAG,EAAE,2DADM;AAEXC,IAAAA,OAAO,oBAAaC,gBAAb,CAFI;AAGXC,IAAAA,UAHW;AAAA,0BAGAC,KAHA,EAGOC,IAHP,EAGa;AACvB;AACA,YAAID,KAAK,CAACE,SAAV,EAAqB;AACpB,cAAMC,KAAK,GAAGF,IAAI,CAACG,iBAAnB;;AACA,cAAID,KAAK,IAAIA,KAAK,CAACE,OAAf,IAA0BF,KAAK,CAACE,OAAN,CAAchC,MAAd,GAAuB,CAArD,EAAwD;AACvD,gBAAMiC,CAAC,GAAGH,KAAK,CAACE,OAAhB;AACA,gBAAIzC,IAAI,GAAG,CAAX;AACA,gBAAI2C,CAAJ;AACA,gBAAIC,GAAJ;;AACA,iBAAKD,CAAC,GAAG,CAAT,EAAYA,CAAC,GAAGD,CAAC,CAACjC,MAAlB,EAA0BkC,CAAC,EAA3B,EAA+B;AAC9BC,cAAAA,GAAG,GAAGF,CAAC,CAACG,UAAF,CAAaF,CAAb,CAAN;AACA3C,cAAAA,IAAI,GAAI,CAACA,IAAI,IAAI,CAAT,IAAcA,IAAf,GAAuB4C,GAA9B;AACA5C,cAAAA,IAAI,IAAI,CAAR,CAH8B,CAGnB;AACX;;AACDD,YAAAA,4BAA4B,CAACC,IAAD,EAAOqC,IAAI,CAAC1B,OAAZ,CAA5B;AACA;AAED;;AACD,eAAOyB,KAAP;AACA;;AAtBU;AAAA;AAAA,GAAZ;AAyBAvC,EAAAA,MAAM,CAACiD,cAAP,CAAsB,UAACC,KAAD,EAAW;AAChCA,IAAAA,KAAK,CAACC,OAAN,CAAc;AAAEC,MAAAA,EAAE,EAAEC;AAAN,KAAd;AACAH,IAAAA,KAAK,CAACI,MAAN,CAAa,SAAb,EAAwB,eAAxB;AACA,GAHD;;AAKA,MAAIC,uBAAJ,EAA6B;AAC5BrD,IAAAA,4BAA4B,CAACqD,uBAAD,CAA5B;AACA;AACD,CA1DD","sourcesContent":["/*\n * Copyright (C) MIKO LLC - All Rights Reserved\n * Unauthorized copying of this file, via any medium is strictly prohibited\n * Proprietary and confidential\n * Written by Nikolay Beketov, 5 2019\n *\n */\n/* global Sentry, globalPBXVersion, globalPBXLicense, globalLastSentryEventId, globalTranslate */\n\nSentry.onLoad(() => {\n\tfunction globalShowSentryReportDialog(hash, sentryEventId) {\n\t\tconst itIsKnownError = localStorage.getItem(`sentry_lastError${hash}`);\n\t\tif (itIsKnownError === null) {\n\t\t\tif (globalTranslate !== undefined && Object.keys(globalTranslate).length > 0) {\n\t\t\t\tSentry.showReportDialog({\n\t\t\t\t\teventId: sentryEventId,\n\t\t\t\t\ttitle: globalTranslate.sntry_Title,\n\t\t\t\t\tsubtitle: globalTranslate.sntry_Subtitle,\n\t\t\t\t\tsubtitle2: globalTranslate.sntry_Subtitle2,\n\t\t\t\t\tlabelComments: globalTranslate.sntry_LabelComments,\n\t\t\t\t\tlabelClose: globalTranslate.sntry_LabelClose,\n\t\t\t\t\tlabelSubmit: globalTranslate.sntry_LabelSubmit,\n\t\t\t\t\terrorGeneric: globalTranslate.sntry_ErrorGeneric,\n\t\t\t\t\terrorFormEntry: globalTranslate.sntry_ErrorFormEntry,\n\t\t\t\t\tsuccessMessage: globalTranslate.sntry_SuccessMessage,\n\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tSentry.showReportDialog({ eventId: sentryEventId });\n\t\t\t}\n\t\t\tlocalStorage.setItem(`sentry_lastError${hash}`, 'theFormHasAlreadySent');\n\t\t}\n\t}\n\n\tSentry.init({\n\t\tdsn: 'https://a8d729459beb446eb3cbb9df997dcc7b@centry.miko.ru/1',\n\t\trelease: `mikopbx@${globalPBXVersion}`,\n\t\tbeforeSend(event, hint) {\n\t\t\t// Check if it is an exception, and if so, show the report dialog\n\t\t\tif (event.exception) {\n\t\t\t\tconst error = hint.originalException;\n\t\t\t\tif (error && error.message && error.message.length > 0) {\n\t\t\t\t\tconst s = error.message;\n\t\t\t\t\tlet hash = 0;\n\t\t\t\t\tlet i;\n\t\t\t\t\tlet chr;\n\t\t\t\t\tfor (i = 0; i < s.length; i++) {\n\t\t\t\t\t\tchr = s.charCodeAt(i);\n\t\t\t\t\t\thash = ((hash << 5) - hash) + chr;\n\t\t\t\t\t\thash |= 0; // Convert to 32bit integer\n\t\t\t\t\t}\n\t\t\t\t\tglobalShowSentryReportDialog(hash, hint.eventId);\n\t\t\t\t}\n\n\t\t\t}\n\t\t\treturn event;\n\t\t},\n\t});\n\n\tSentry.configureScope((scope) => {\n\t\tscope.setUser({ id: globalPBXLicense });\n\t\tscope.setTag('library', 'web-interface');\n\t});\n\n\tif (globalLastSentryEventId) {\n\t\tglobalShowSentryReportDialog(globalLastSentryEventId);\n\t}\n});\n\n"],"file":"sentry-error-logger.js"}