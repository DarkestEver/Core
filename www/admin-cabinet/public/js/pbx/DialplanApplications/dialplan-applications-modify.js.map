{"version":3,"sources":["../../src/DialplanApplications/dialplan-applications-modify.js"],"names":["$","fn","form","settings","rules","existRule","value","parameter","hasClass","dialplanApplication","$number","defaultExtension","$formObj","$dirrtyField","editor","validateRules","name","identifier","type","prompt","globalTranslate","da_ValidateNameIsEmpty","extension","da_ValidateExtensionIsEmpty","da_ValidateExtensionDouble","initialize","tab","length","dropdown","onChange","changeAceMode","on","newNumber","Extensions","checkAvailability","initializeAce","initializeForm","ace","edit","setTheme","resize","getSession","val","Math","random","trigger","mode","NewMode","require","Mode","session","setMode","cbBeforeSendForm","result","data","applicationlogic","getValue","cbAfterSendForm","Form","url","globalRootUrl","document","ready"],"mappings":"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","sourcesContent":["/*\n * Copyright (C) MIKO LLC - All Rights Reserved\n * Unauthorized copying of this file, via any medium is strictly prohibited\n * Proprietary and confidential\n * Written by Nikolay Beketov, 5 2018\n *\n */\n\n/* global globalRootUrl,globalTranslate, ace, Form, Extensions */\n\n// Проверка нет ли ошибки занятого другой учеткой номера\n$.fn.form.settings.rules.existRule = (value, parameter) => $(`#${parameter}`).hasClass('hidden');\n\nconst dialplanApplication = {\n\t$number: $('#extension'),\n\tdefaultExtension: '',\n\t$formObj: $('#dialplan-application-form'),\n\t$dirrtyField: $('#dirrty'),\n\teditor: '',\n\tvalidateRules: {\n\t\tname: {\n\t\t\tidentifier: 'name',\n\t\t\trules: [\n\t\t\t\t{\n\t\t\t\t\ttype: 'empty',\n\t\t\t\t\tprompt: globalTranslate.da_ValidateNameIsEmpty,\n\t\t\t\t},\n\t\t\t],\n\t\t},\n\t\textension: {\n\t\t\tidentifier: 'extension',\n\t\t\trules: [\n\t\t\t\t{\n\t\t\t\t\ttype: 'empty',\n\t\t\t\t\tprompt: globalTranslate.da_ValidateExtensionIsEmpty,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttype: 'existRule[extension-error]',\n\t\t\t\t\tprompt: globalTranslate.da_ValidateExtensionDouble,\n\t\t\t\t},\n\t\t\t],\n\t\t},\n\t},\n\tinitialize() {\n\t\t$('#application-code-menu .item').tab();\n\t\tif (dialplanApplication.$formObj.form('get value', 'name').length === 0) {\n\t\t\t$('#application-code-menu .item').tab('change tab', 'main');\n\t\t}\n\t\t$('.type-select').dropdown({\n\t\t\tonChange: dialplanApplication.changeAceMode,\n\t\t});\n\t\t// Динамическая проверка свободен ли внутренний номер\n\t\tdialplanApplication.$number.on('change', () => {\n\t\t\tconst newNumber = dialplanApplication.$formObj.form('get value', 'extension');\n\t\t\tExtensions.checkAvailability(dialplanApplication.defaultExtension, newNumber);\n\t\t});\n\n\t\tdialplanApplication.initializeAce();\n\t\tdialplanApplication.initializeForm();\n\t\tdialplanApplication.changeAceMode();\n\t\tdialplanApplication.defaultExtension = dialplanApplication.$formObj.form('get value', 'extension');\n\t},\n\tinitializeAce() {\n\t\tdialplanApplication.editor = ace.edit('application-code');\n\t\tdialplanApplication.editor.setTheme('ace/theme/monokai');\n\t\tdialplanApplication.editor.resize();\n\t\tdialplanApplication.editor.getSession().on('change', () => {\n\t\t\tdialplanApplication.$dirrtyField.val(Math.random());\n\t\t\tdialplanApplication.$dirrtyField.trigger('change');\n\t\t});\n\t},\n\tchangeAceMode() {\n\t\tconst mode = dialplanApplication.$formObj.form('get value', 'type');\n\t\tlet NewMode;\n\t\tif (mode === 'php') {\n\t\t\tNewMode = ace.require('ace/mode/php').Mode;\n\t\t} else {\n\t\t\tNewMode = ace.require('ace/mode/julia').Mode;\n\t\t}\n\t\tdialplanApplication.editor.session.setMode(new NewMode());\n\t\tdialplanApplication.editor.setTheme('ace/theme/monokai');\n\t},\n\tcbBeforeSendForm(settings) {\n\t\tconst result = settings;\n\t\tresult.data = dialplanApplication.$formObj.form('get values');\n\t\tresult.data.applicationlogic = dialplanApplication.editor.getValue();\n\t\treturn result;\n\t},\n\tcbAfterSendForm() {\n\n\t},\n\tinitializeForm() {\n\t\tForm.$formObj = dialplanApplication.$formObj;\n\t\tForm.url = `${globalRootUrl}dialplan-applications/save`;\n\t\tForm.validateRules = dialplanApplication.validateRules;\n\t\tForm.cbBeforeSendForm = dialplanApplication.cbBeforeSendForm;\n\t\tForm.cbAfterSendForm = dialplanApplication.cbAfterSendForm;\n\t\tForm.initialize();\n\t},\n};\n\n$(document).ready(() => {\n\tdialplanApplication.initialize();\n});\n\n"],"file":"dialplan-applications-modify.js"}