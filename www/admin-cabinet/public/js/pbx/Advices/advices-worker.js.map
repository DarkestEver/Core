{"version":3,"sources":["../../src/Advices/advices-worker.js"],"names":["advicesWorker","timeOut","timeOutHandle","$advices","$","initialize","showPreviousAdvice","restartWorker","window","addEventListener","clearTimeout","timeoutHandle","worker","previousAdvice","localStorage","getItem","undefined","html","api","url","globalRootUrl","on","onSuccess","response","cbAfterResponse","onError","errorMessage","element","xhr","status","location","setTimeout","success","message","length","htmlMessages","globalTranslate","adv_MessagesHeader","each","key","value","setItem","removeItem","document","ready"],"mappings":"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","sourcesContent":["/*\n * Copyright (C) MIKO LLC - All Rights Reserved\n * Unauthorized copying of this file, via any medium is strictly prohibited\n * Proprietary and confidential\n * Written by Nikolay Beketov, 11 2018\n *\n */\n\n/* global globalRootUrl, globalTranslate */\n\nconst advicesWorker = {\n\ttimeOut: 300000,\n\ttimeOutHandle: '',\n\t$advices: $('#advices'),\n\tinitialize() {\n\t\tadvicesWorker.showPreviousAdvice();\n\t\t// Запустим получение новых советов\n\t\tadvicesWorker.restartWorker();\n\t\twindow.addEventListener('ConfigDataChanged', advicesWorker.restartWorker);\n\t},\n\trestartWorker() {\n\t\twindow.clearTimeout(advicesWorker.timeoutHandle);\n\t\tadvicesWorker.worker();\n\t},\n\t/**\n\t * Показывает старые советы до получения обвноления со станции\n\t */\n\tshowPreviousAdvice() {\n\t\tconst previousAdvice = localStorage.getItem('previousAdvice');\n\t\tif (previousAdvice !== undefined) {\n\t\t\tadvicesWorker.$advices.html(previousAdvice);\n\t\t}\n\t},\n\tworker() {\n\t\t$.api({\n\t\t\turl: `${globalRootUrl}advices/getAdvices`,\n\t\t\ton: 'now',\n\t\t\tonSuccess(response) {\n\t\t\t\tadvicesWorker.cbAfterResponse(response);\n\t\t\t},\n\t\t\tonError(errorMessage, element, xhr) {\n\t\t\t\tif (xhr.status === 403) {\n\t\t\t\t\twindow.location = `${globalRootUrl}session/index`;\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\t\tadvicesWorker.timeoutHandle = window.setTimeout(\n\t\t\tadvicesWorker.worker,\n\t\t\tadvicesWorker.timeOut,\n\t\t);\n\t},\n\tcbAfterResponse(response) {\n\t\tif (response === undefined) return;\n\t\tadvicesWorker.$advices.html('');\n\t\tif (response.success === true\n\t\t\t&& response.message !== undefined\n\t\t\t&& response.message.length > 0) {\n\t\t\tlet htmlMessages = '<div class=\"ui icon warning message\">';\n\t\t\thtmlMessages += '<i class=\"warning icon\"></i>';\n\t\t\thtmlMessages += '<div class=\"content\">';\n\t\t\thtmlMessages += `<div class=\"header\">${globalTranslate.adv_MessagesHeader}</div>`;\n\t\t\thtmlMessages += '<ul class=\"list\">';\n\t\t\t$.each(response.message, (key, value) => {\n\t\t\t\thtmlMessages += `<li>${value}</li>`;\n\t\t\t});\n\t\t\thtmlMessages += '</ul>';\n\t\t\thtmlMessages += '</div>';\n\t\t\thtmlMessages += '</div>';\n\t\t\tadvicesWorker.$advices.html(htmlMessages);\n\t\t\tlocalStorage.setItem('previousAdvice', htmlMessages);\n\t\t} else if (response.success === true\n\t\t\t&& response.message !== undefined\n\t\t\t&& response.message.length === 0) {\n\t\t\tlocalStorage.removeItem('previousAdvice');\n\t\t}\n\t},\n};\n\n$(document).ready(() => {\n\tadvicesWorker.initialize();\n});\n"],"file":"advices-worker.js"}