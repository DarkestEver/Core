{"version":3,"sources":["../../src/Advices/advices-worker.js"],"names":["advicesWorker","timeOut","timeOutHandle","$advices","$","initialize","showPreviousAdvice","restartWorker","window","addEventListener","clearTimeout","timeoutHandle","worker","previousAdvice","localStorage","getItem","undefined","html","api","url","globalRootUrl","on","onSuccess","response","cbAfterResponse","onError","errorMessage","element","xhr","status","location","setTimeout","success","message","htmlMessages","error","length","globalTranslate","adv_MessagesHeaderError","each","key","value","warning","adv_MessagesHeader","info","setItem","indexOf","addClass","removeItem","document","ready"],"mappings":"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","sourcesContent":["/*\n * Copyright (C) MIKO LLC - All Rights Reserved\n * Unauthorized copying of this file, via any medium is strictly prohibited\n * Proprietary and confidential\n * Written by Nikolay Beketov, 11 2018\n *\n */\n\n/* global globalRootUrl, globalTranslate */\n\nconst advicesWorker = {\n\ttimeOut: 300000,\n\ttimeOutHandle: '',\n\t$advices: $('#advices'),\n\tinitialize() {\n\t\tadvicesWorker.showPreviousAdvice();\n\t\t// Запустим получение новых советов\n\t\tadvicesWorker.restartWorker();\n\t\twindow.addEventListener('ConfigDataChanged', advicesWorker.restartWorker);\n\t},\n\trestartWorker() {\n\t\twindow.clearTimeout(advicesWorker.timeoutHandle);\n\t\tadvicesWorker.worker();\n\t},\n\t/**\n\t * Показывает старые советы до получения обвноления со станции\n\t */\n\tshowPreviousAdvice() {\n\t\tconst previousAdvice = localStorage.getItem('previousAdvice');\n\t\tif (previousAdvice !== undefined) {\n\t\t\tadvicesWorker.$advices.html(previousAdvice);\n\t\t}\n\t},\n\tworker() {\n\t\t$.api({\n\t\t\turl: `${globalRootUrl}advices/getAdvices`,\n\t\t\ton: 'now',\n\t\t\tonSuccess(response) {\n\t\t\t\tadvicesWorker.cbAfterResponse(response);\n\t\t\t},\n\t\t\tonError(errorMessage, element, xhr) {\n\t\t\t\tif (xhr.status === 403) {\n\t\t\t\t\twindow.location = `${globalRootUrl}session/index`;\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\t\tadvicesWorker.timeoutHandle = window.setTimeout(\n\t\t\tadvicesWorker.worker,\n\t\t\tadvicesWorker.timeOut,\n\t\t);\n\t},\n\tcbAfterResponse(response) {\n\t\tif (response === undefined) return;\n\t\tadvicesWorker.$advices.html('');\n\t\tif (response.success === true\n\t\t\t&& response.message !== undefined) {\n\t\t\tlet htmlMessages = '';\n\t\t\tif (response.message.error !== undefined\n\t\t\t\t&& response.message.error.length > 0) {\n\t\t\t\thtmlMessages += '<div class=\"ui icon error message\">';\n\t\t\t\thtmlMessages += '<i class=\"x icon\"></i>';\n\t\t\t\thtmlMessages += '<div class=\"content\">';\n\t\t\t\thtmlMessages += `<div class=\"header\">${globalTranslate.adv_MessagesHeaderError}</div>`;\n\t\t\t\thtmlMessages += '<ul class=\"list\">';\n\t\t\t\t$.each(response.message.error, (key, value) => {\n\t\t\t\t\thtmlMessages += `<li>${value}</li>`;\n\t\t\t\t});\n\t\t\t\thtmlMessages += '</ul>';\n\t\t\t\thtmlMessages += '</div>';\n\t\t\t\thtmlMessages += '</div>';\n\t\t\t} else if (response.message.warning !== undefined\n\t\t\t\t&& response.message.warning.length > 0) {\n\t\t\t\thtmlMessages += '<div class=\"ui icon warning message\">';\n\t\t\t\thtmlMessages += '<i class=\"warning icon\"></i>';\n\t\t\t\thtmlMessages += '<div class=\"content\">';\n\t\t\t\thtmlMessages += `<div class=\"header\">${globalTranslate.adv_MessagesHeader}</div>`;\n\t\t\t\thtmlMessages += '<ul class=\"list\">';\n\t\t\t\t$.each(response.message.warning, (key, value) => {\n\t\t\t\t\thtmlMessages += `<li>${value}</li>`;\n\t\t\t\t});\n\t\t\t\thtmlMessages += '</ul>';\n\t\t\t\thtmlMessages += '</div>';\n\t\t\t\thtmlMessages += '</div>';\n\t\t\t} else if (response.message.info !== undefined\n\t\t\t\t&& response.message.info.length > 0) {\n\t\t\t\thtmlMessages += '<div class=\"ui icon info message\">';\n\t\t\t\thtmlMessages += '<i class=\"info icon\"></i>';\n\t\t\t\thtmlMessages += '<div class=\"content\">';\n\t\t\t\thtmlMessages += `<div class=\"header\">${globalTranslate.adv_MessagesHeader}</div>`;\n\t\t\t\thtmlMessages += '<ul class=\"list\">';\n\t\t\t\t$.each(response.message.info, (key, value) => {\n\t\t\t\t\thtmlMessages += `<li>${value}</li>`;\n\t\t\t\t});\n\t\t\t\thtmlMessages += '</ul>';\n\t\t\t\thtmlMessages += '</div>';\n\t\t\t\thtmlMessages += '</div>';\n\t\t\t}\n\t\t\tadvicesWorker.$advices.html(htmlMessages);\n\t\t\tlocalStorage.setItem('previousAdvice', htmlMessages);\n\n\t\t\t// Проверим есть ли обновление системы\n\t\t\tif (response.message.info !== undefined\n\t\t\t\t&& response.message.info.length > 0) {\n\t\t\t\t$.each(response.message.info, (key, value) => {\n\t\t\t\t\tif (value.indexOf('/admin-cabinet/update/index/') > -1) {\n\t\t\t\t\t\t$('a[href=\"/admin-cabinet/update/index/\"] > i').addClass('loading');\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t} else if (response.success === true\n\t\t\t&& response.message !== undefined\n\t\t\t&& response.message.length === 0) {\n\t\t\tlocalStorage.removeItem('previousAdvice');\n\t\t}\n\t},\n};\n\n$(document).ready(() => {\n\tadvicesWorker.initialize();\n});\n"],"file":"advices-worker.js"}