"use strict";

/*
 * Copyright (C) MIKO LLC - All Rights Reserved
 * Unauthorized copying of this file, via any medium is strictly prohibited
 * Proprietary and confidential
 * Written by Nikolay Beketov, 12 2019
 *
 */

/* global globalRootUrl, ivrActions, globalTranslate, Form, Extensions */
$.fn.form.settings.rules.existRule = function () {
  return $('#extension-error').hasClass('hidden');
};

var ivrMenu = {
  $formObj: $('#ivr-menu-form'),
  $dropDowns: $('#ivr-menu-form .ui.dropdown'),
  $number: $('#extension'),
  $dirrtyField: $('#dirrty'),
  $errorMessages: $('#form-error-messages'),
  $rowTemplate: $('#row-template'),
  defaultExtension: '',
  actionsRowsCount: 0,
  validateRules: {
    name: {
      identifier: 'name',
      rules: [{
        type: 'empty',
        prompt: globalTranslate.iv_ValidateNameIsEmpty
      }]
    },
    extension: {
      identifier: 'extension',
      rules: [{
        type: 'empty',
        prompt: globalTranslate.iv_ValidateExtensionIsEmpty
      }, {
        type: 'existRule',
        prompt: globalTranslate.iv_ValidateExtensionIsDouble
      }]
    },
    timeout_extension: {
      identifier: 'timeout_extension',
      rules: [{
        type: 'empty',
        prompt: globalTranslate.iv_ValidateTimeoutExtensionIsEmpty
      }]
    },
    audio_message_id: {
      identifier: 'audio_message_id',
      rules: [{
        type: 'empty',
        prompt: globalTranslate.iv_ValidateAudioFileIsEmpty
      }]
    },
    timeout: {
      identifier: 'timeout',
      rules: [{
        type: 'integer[0..99]',
        prompt: globalTranslate.iv_ValidateTimeoutOutOfRange
      }]
    },
    number_of_repeat: {
      identifier: 'number_of_repeat',
      rules: [{
        type: 'integer[0..99]',
        prompt: globalTranslate.iv_ValidateRepeatNumberOutOfRange
      }]
    }
  },
  initialize: function () {
    function initialize() {
      Extensions.initialize();
      ivrMenu.$dropDowns.dropdown(); // Динамическая прововерка свободен ли выбранный номер

      ivrMenu.$number.on('change', function () {
        var newNumber = ivrMenu.$formObj.form('get value', 'extension');
        Extensions.checkAvailability(ivrMenu.defaultNumber, newNumber);
      });
      $('#add-new-ivr-action').on('click', function (el) {
        ivrMenu.addNewActionRow();
        ivrMenu.rebuildActionExtensionsDropdown();
        ivrMenu.$dirrtyField.val(Math.random());
        ivrMenu.$dirrtyField.trigger('change');
        el.preventDefault();
      });
      ivrMenu.initializeForm();
      ivrMenu.buildIvrMenuActions();
      ivrMenu.defaultExtension = ivrMenu.$formObj.form('get value', 'extension');
    }

    return initialize;
  }(),

  /**
   * Create ivr menu items on the form
   */
  buildIvrMenuActions: function () {
    function buildIvrMenuActions() {
      var objActions = JSON.parse(ivrActions);
      objActions.forEach(function (element) {
        ivrMenu.addNewActionRow(element);
      });
      if (objActions.length === 0) ivrMenu.addNewActionRow();
      ivrMenu.rebuildActionExtensionsDropdown();
    }

    return buildIvrMenuActions;
  }(),
  addNewFormRules: function () {
    function addNewFormRules(newRowId) {
      var $digitsClass = "digits-".concat(newRowId);
      ivrMenu.validateRules[$digitsClass] = {
        identifier: $digitsClass,
        rules: [{
          type: 'regExp[/^[0-9]{1,7}$/]',
          prompt: globalTranslate.iv_ValidateDigitsIsNotCorrect
        }, {
          type: 'checkDoublesDigits',
          prompt: globalTranslate.iv_ValidateDigitsIsNotCorrect
        }]
      };
      var $extensionClass = "extension-".concat(newRowId);
      ivrMenu.validateRules[$extensionClass] = {
        identifier: $extensionClass,
        rules: [{
          type: 'empty',
          prompt: globalTranslate.iv_ValidateExtensionIsNotCorrect
        }]
      };
    }

    return addNewFormRules;
  }(),
  addNewActionRow: function () {
    function addNewActionRow(paramObj) {
      var param = {
        id: '',
        extension: '',
        extensionRepresent: '',
        digits: ''
      };

      if (paramObj !== undefined) {
        param = paramObj;
      }

      ivrMenu.actionsRowsCount += 1;
      var $actionTemplate = ivrMenu.$rowTemplate.clone();
      $actionTemplate.removeClass('hidden').attr('id', "row-".concat(ivrMenu.actionsRowsCount)).attr('data-value', ivrMenu.actionsRowsCount).attr('style', '');
      $actionTemplate.find('input[name="digits-id"]').attr('id', "digits-".concat(ivrMenu.actionsRowsCount)).attr('name', "digits-".concat(ivrMenu.actionsRowsCount)).attr('value', param.digits);
      $actionTemplate.find('input[name="extension-id"]').attr('id', "extension-".concat(ivrMenu.actionsRowsCount)).attr('name', "extension-".concat(ivrMenu.actionsRowsCount)).attr('value', param.extension);
      $actionTemplate.find('div.delete-action-row').attr('data-value', ivrMenu.actionsRowsCount);

      if (param.extensionRepresent.length > 0) {
        $actionTemplate.find('div.default.text').removeClass('default').html(param.extensionRepresent);
      } else {
        $actionTemplate.find('div.default.text').html(globalTranslate.ex_SelectNumber);
      }

      $('#actions-place').append($actionTemplate);
      ivrMenu.addNewFormRules(ivrMenu.actionsRowsCount);
    }

    return addNewActionRow;
  }(),
  rebuildActionExtensionsDropdown: function () {
    function rebuildActionExtensionsDropdown() {
      $('#ivr-menu-form .forwarding-select').dropdown(Extensions.getDropdownSettingsWithoutEmpty(ivrMenu.cbOnExtensionSelect));
      Extensions.fixBugDropdownIcon();
      $('.delete-action-row').on('click', function (e) {
        e.preventDefault();
        var id = $(this).attr('data-value');
        delete ivrMenu.validateRules["digits-".concat(id)];
        delete ivrMenu.validateRules["extension-".concat(id)];
        $("#row-".concat(id)).remove();
        ivrMenu.$dirrtyField.val(Math.random());
        ivrMenu.$dirrtyField.trigger('change');
      });
    }

    return rebuildActionExtensionsDropdown;
  }(),
  cbBeforeSendForm: function () {
    function cbBeforeSendForm(settings) {
      var result = settings;
      result.data = ivrMenu.$formObj.form('get values');
      var arrActions = [];
      $('.action-row').each(function (index, obj) {
        var rowId = $(obj).attr('data-value');

        if (rowId > 0) {
          arrActions.push({
            digits: ivrMenu.$formObj.form('get value', "digits-".concat(rowId)),
            extension: ivrMenu.$formObj.form('get value', "extension-".concat(rowId))
          });
        }
      });

      if (arrActions.length === 0) {
        result = false;
        ivrMenu.$errorMessages.html(globalTranslate.iv_ValidateNoIVRExtensions);
        ivrMenu.$formObj.addClass('error');
      } else {
        result.data.actions = JSON.stringify(arrActions);
      }

      return result;
    }

    return cbBeforeSendForm;
  }(),

  /**
   * Срабатывает при выборе номера из выпадающего списка
   */
  cbOnExtensionSelect: function () {
    function cbOnExtensionSelect() {
      ivrMenu.$dirrtyField.val(Math.random());
      ivrMenu.$dirrtyField.trigger('change');
    }

    return cbOnExtensionSelect;
  }(),
  cbAfterSendForm: function () {
    function cbAfterSendForm() {}

    return cbAfterSendForm;
  }(),
  initializeForm: function () {
    function initializeForm() {
      Form.$formObj = ivrMenu.$formObj;
      Form.url = "".concat(globalRootUrl, "ivr-menu/save");
      Form.validateRules = ivrMenu.validateRules;
      Form.cbBeforeSendForm = ivrMenu.cbBeforeSendForm;
      Form.cbAfterSendForm = ivrMenu.cbAfterSendForm;
      Form.initialize();
    }

    return initializeForm;
  }()
};

$.fn.form.settings.rules.checkDoublesDigits = function (value) {
  var count = 0;
  $("input[id^='digits']").each(function (index, obj) {
    if (ivrMenu.$formObj.form('get value', "".concat(obj.id)) === value) count += 1;
  });
  return count === 1;
};

$(document).ready(function () {
  ivrMenu.initialize();
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9JdnJNZW51L2l2cm1lbnUtbW9kaWZ5LmpzIl0sIm5hbWVzIjpbIiQiLCJmbiIsImZvcm0iLCJzZXR0aW5ncyIsInJ1bGVzIiwiZXhpc3RSdWxlIiwiaGFzQ2xhc3MiLCJpdnJNZW51IiwiJGZvcm1PYmoiLCIkZHJvcERvd25zIiwiJG51bWJlciIsIiRkaXJydHlGaWVsZCIsIiRlcnJvck1lc3NhZ2VzIiwiJHJvd1RlbXBsYXRlIiwiZGVmYXVsdEV4dGVuc2lvbiIsImFjdGlvbnNSb3dzQ291bnQiLCJ2YWxpZGF0ZVJ1bGVzIiwibmFtZSIsImlkZW50aWZpZXIiLCJ0eXBlIiwicHJvbXB0IiwiZ2xvYmFsVHJhbnNsYXRlIiwiaXZfVmFsaWRhdGVOYW1lSXNFbXB0eSIsImV4dGVuc2lvbiIsIml2X1ZhbGlkYXRlRXh0ZW5zaW9uSXNFbXB0eSIsIml2X1ZhbGlkYXRlRXh0ZW5zaW9uSXNEb3VibGUiLCJ0aW1lb3V0X2V4dGVuc2lvbiIsIml2X1ZhbGlkYXRlVGltZW91dEV4dGVuc2lvbklzRW1wdHkiLCJhdWRpb19tZXNzYWdlX2lkIiwiaXZfVmFsaWRhdGVBdWRpb0ZpbGVJc0VtcHR5IiwidGltZW91dCIsIml2X1ZhbGlkYXRlVGltZW91dE91dE9mUmFuZ2UiLCJudW1iZXJfb2ZfcmVwZWF0IiwiaXZfVmFsaWRhdGVSZXBlYXROdW1iZXJPdXRPZlJhbmdlIiwiaW5pdGlhbGl6ZSIsIkV4dGVuc2lvbnMiLCJkcm9wZG93biIsIm9uIiwibmV3TnVtYmVyIiwiY2hlY2tBdmFpbGFiaWxpdHkiLCJkZWZhdWx0TnVtYmVyIiwiZWwiLCJhZGROZXdBY3Rpb25Sb3ciLCJyZWJ1aWxkQWN0aW9uRXh0ZW5zaW9uc0Ryb3Bkb3duIiwidmFsIiwiTWF0aCIsInJhbmRvbSIsInRyaWdnZXIiLCJwcmV2ZW50RGVmYXVsdCIsImluaXRpYWxpemVGb3JtIiwiYnVpbGRJdnJNZW51QWN0aW9ucyIsIm9iakFjdGlvbnMiLCJKU09OIiwicGFyc2UiLCJpdnJBY3Rpb25zIiwiZm9yRWFjaCIsImVsZW1lbnQiLCJsZW5ndGgiLCJhZGROZXdGb3JtUnVsZXMiLCJuZXdSb3dJZCIsIiRkaWdpdHNDbGFzcyIsIml2X1ZhbGlkYXRlRGlnaXRzSXNOb3RDb3JyZWN0IiwiJGV4dGVuc2lvbkNsYXNzIiwiaXZfVmFsaWRhdGVFeHRlbnNpb25Jc05vdENvcnJlY3QiLCJwYXJhbU9iaiIsInBhcmFtIiwiaWQiLCJleHRlbnNpb25SZXByZXNlbnQiLCJkaWdpdHMiLCJ1bmRlZmluZWQiLCIkYWN0aW9uVGVtcGxhdGUiLCJjbG9uZSIsInJlbW92ZUNsYXNzIiwiYXR0ciIsImZpbmQiLCJodG1sIiwiZXhfU2VsZWN0TnVtYmVyIiwiYXBwZW5kIiwiZ2V0RHJvcGRvd25TZXR0aW5nc1dpdGhvdXRFbXB0eSIsImNiT25FeHRlbnNpb25TZWxlY3QiLCJmaXhCdWdEcm9wZG93bkljb24iLCJlIiwicmVtb3ZlIiwiY2JCZWZvcmVTZW5kRm9ybSIsInJlc3VsdCIsImRhdGEiLCJhcnJBY3Rpb25zIiwiZWFjaCIsImluZGV4Iiwib2JqIiwicm93SWQiLCJwdXNoIiwiaXZfVmFsaWRhdGVOb0lWUkV4dGVuc2lvbnMiLCJhZGRDbGFzcyIsImFjdGlvbnMiLCJzdHJpbmdpZnkiLCJjYkFmdGVyU2VuZEZvcm0iLCJGb3JtIiwidXJsIiwiZ2xvYmFsUm9vdFVybCIsImNoZWNrRG91Ymxlc0RpZ2l0cyIsInZhbHVlIiwiY291bnQiLCJkb2N1bWVudCIsInJlYWR5Il0sIm1hcHBpbmdzIjoiOztBQUFBOzs7Ozs7OztBQVFBO0FBRUFBLENBQUMsQ0FBQ0MsRUFBRixDQUFLQyxJQUFMLENBQVVDLFFBQVYsQ0FBbUJDLEtBQW5CLENBQXlCQyxTQUF6QixHQUFxQztBQUFBLFNBQU1MLENBQUMsQ0FBQyxrQkFBRCxDQUFELENBQXNCTSxRQUF0QixDQUErQixRQUEvQixDQUFOO0FBQUEsQ0FBckM7O0FBRUEsSUFBTUMsT0FBTyxHQUFHO0FBQ2ZDLEVBQUFBLFFBQVEsRUFBRVIsQ0FBQyxDQUFDLGdCQUFELENB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OztBQTFOYztBQUFBO0FBMk5mL0MsRUFBQUEsY0EzTmU7QUFBQSw4QkEyTkU7QUFDaEJnRCxNQUFBQSxJQUFJLENBQUN6RixRQUFMLEdBQWdCRCxPQUFPLENBQUNDLFFBQXhCO0FBQ0F5RixNQUFBQSxJQUFJLENBQUNDLEdBQUwsYUFBY0MsYUFBZDtBQUNBRixNQUFBQSxJQUFJLENBQUNqRixhQUFMLEdBQXFCVCxPQUFPLENBQUNTLGFBQTdCO0FBQ0FpRixNQUFBQSxJQUFJLENBQUNkLGdCQUFMLEdBQXdCNUUsT0FBTyxDQUFDNEUsZ0JBQWhDO0FBQ0FjLE1BQUFBLElBQUksQ0FBQ0QsZUFBTCxHQUF1QnpGLE9BQU8sQ0FBQ3lGLGVBQS9CO0FBQ0FDLE1BQUFBLElBQUksQ0FBQy9ELFVBQUw7QUFDQTs7QUFsT2M7QUFBQTtBQUFBLENBQWhCOztBQXFPQWxDLENBQUMsQ0FBQ0MsRUFBRixDQUFLQyxJQUFMLENBQVVDLFFBQVYsQ0FBbUJDLEtBQW5CLENBQXlCZ0csa0JBQXpCLEdBQThDLFVBQUNDLEtBQUQsRUFBVztBQUN4RCxNQUFJQyxLQUFLLEdBQUcsQ0FBWjtBQUNBdEcsRUFBQUEsQ0FBQyxDQUFDLHFCQUFELENBQUQsQ0FBeUJ1RixJQUF6QixDQUE4QixVQUFDQyxLQUFELEVBQVFDLEdBQVIsRUFBZ0I7QUFDN0MsUUFBSWxGLE9BQU8sQ0FBQ0MsUUFBUixDQUFpQk4sSUFBakIsQ0FBc0IsV0FBdEIsWUFBc0N1RixHQUFHLENBQUN2QixFQUExQyxPQUFvRG1DLEtBQXhELEVBQStEQyxLQUFLLElBQUksQ0FBVDtBQUMvRCxHQUZEO0FBSUEsU0FBUUEsS0FBSyxLQUFLLENBQWxCO0FBQ0EsQ0FQRDs7QUFTQXRHLENBQUMsQ0FBQ3VHLFFBQUQsQ0FBRCxDQUFZQyxLQUFaLENBQWtCLFlBQU07QUFDdkJqRyxFQUFBQSxPQUFPLENBQUMyQixVQUFSO0FBQ0EsQ0FGRCIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4gKiBDb3B5cmlnaHQgKEMpIE1JS08gTExDIC0gQWxsIFJpZ2h0cyBSZXNlcnZlZFxuICogVW5hdXRob3JpemVkIGNvcHlpbmcgb2YgdGhpcyBmaWxlLCB2aWEgYW55IG1lZGl1bSBpcyBzdHJpY3RseSBwcm9oaWJpdGVkXG4gKiBQcm9wcmlldGFyeSBhbmQgY29uZmlkZW50aWFsXG4gKiBXcml0dGVuIGJ5IE5pa29sYXkgQmVrZXRvdiwgMTIgMjAxOVxuICpcbiAqL1xuXG4vKiBnbG9iYWwgZ2xvYmFsUm9vdFVybCwgaXZyQWN0aW9ucywgZ2xvYmFsVHJhbnNsYXRlLCBGb3JtLCBFeHRlbnNpb25zICovXG5cbiQuZm4uZm9ybS5zZXR0aW5ncy5ydWxlcy5leGlzdFJ1bGUgPSAoKSA9PiAkKCcjZXh0ZW5zaW9uLWVycm9yJykuaGFzQ2xhc3MoJ2hpZGRlbicpO1xuXG5jb25zdCBpdnJNZW51ID0ge1xuXHQkZm9ybU9iajogJCgnI2l2ci1tZW51LWZvcm0nKSxcblx0JGRyb3BEb3duczogJCgnI2l2ci1tZW51LWZvcm0gLnVpLmRyb3Bkb3duJyksXG5cdCRudW1iZXI6ICQoJyNleHRlbnNpb24nKSxcblx0JGRpcnJ0eUZpZWxkOiAkKCcjZGlycnR5JyksXG5cdCRlcnJvck1lc3NhZ2VzOiAkKCcjZm9ybS1lcnJvci1tZXNzYWdlcycpLFxuXHQkcm93VGVtcGxhdGU6ICQoJyNyb3ctdGVtcGxhdGUnKSxcblx0ZGVmYXVsdEV4dGVuc2lvbjogJycsXG5cdGFjdGlvbnNSb3dzQ291bnQ6IDAsXG5cdHZhbGlkYXRlUnVsZXM6IHtcblx0XHRuYW1lOiB7XG5cdFx0XHRpZGVudGlmaWVyOiAnbmFtZScsXG5cdFx0XHRydWxlczogW1xuXHRcdFx0XHR7XG5cdFx0XHRcdFx0dHlwZTogJ2VtcHR5Jyxcblx0XHRcdFx0XHRwcm9tcHQ6IGdsb2JhbFRyYW5zbGF0ZS5pdl9WYWxpZGF0ZU5hbWVJc0VtcHR5LFxuXHRcdFx0XHR9LFxuXHRcdFx0XSxcblx0XHR9LFxuXHRcdGV4dGVuc2lvbjoge1xuXHRcdFx0aWRlbnRpZmllcjogJ2V4dGVuc2lvbicsXG5cdFx0XHRydWxlczogW1xuXHRcdFx0XHR7XG5cdFx0XHRcdFx0dHlwZTogJ2VtcHR5Jyxcblx0XHRcdFx0XHRwcm9tcHQ6IGdsb2JhbFRyYW5zbGF0ZS5pdl9WYWxpZGF0ZUV4dGVuc2lvbklzRW1wdHksXG5cdFx0XHRcdH0sXG5cdFx0XHRcdHtcblx0XHRcdFx0XHR0eXBlOiAnZXhpc3RSdWxlJyxcblx0XHRcdFx0XHRwcm9tcHQ6IGdsb2JhbFRyYW5zbGF0ZS5pdl9WYWxpZGF0ZUV4dGVuc2lvbklzRG91YmxlLFxuXHRcdFx0XHR9LFxuXHRcdFx0XSxcblx0XHR9LFxuXHRcdHRpbWVvdXRfZXh0ZW5zaW9uOiB7XG5cdFx0XHRpZGVudGlmaWVyOiAndGltZW91dF9leHRlbnNpb24nLFxuXHRcdFx0cnVsZXM6IFtcblx0XHRcdFx0e1xuXHRcdFx0XHRcdHR5cGU6ICdlbXB0eScsXG5cdFx0XHRcdFx0cHJvbXB0OiBnbG9iYWxUcmFuc2xhdGUuaXZfVmFsaWRhdGVUaW1lb3V0RXh0ZW5zaW9uSXNFbXB0eSxcblx0XHRcdFx0fSxcblx0XHRcdF0sXG5cdFx0fSxcblx0XHRhdWRpb19tZXNzYWdlX2lkOiB7XG5cdFx0XHRpZGVudGlmaWVyOiAnYXVkaW9fbWVzc2FnZV9pZCcsXG5cdFx0XHRydWxlczogW1xuXHRcdFx0XHR7XG5cdFx0XHRcdFx0dHlwZTogJ2VtcHR5Jyxcblx0XHRcdFx0XHRwcm9tcHQ6IGdsb2JhbFRyYW5zbGF0ZS5pdl9WYWxpZGF0ZUF1ZGlvRmlsZUlzRW1wdHksXG5cdFx0XHRcdH0sXG5cdFx0XHRdLFxuXHRcdH0sXG5cdFx0dGltZW91dDoge1xuXHRcdFx0aWRlbnRpZmllcjogJ3RpbWVvdXQnLFxuXHRcdFx0cnVsZXM6IFtcblx0XHRcdFx0e1xuXHRcdFx0XHRcdHR5cGU6ICdpbnRlZ2VyWzAuLjk5XScsXG5cdFx0XHRcdFx0cHJvbXB0OiBnbG9iYWxUcmFuc2xhdGUuaXZfVmFsaWRhdGVUaW1lb3V0T3V0T2ZSYW5nZSxcblx0XHRcdFx0fSxcblx0XHRcdF0sXG5cdFx0fSxcblx0XHRudW1iZXJfb2ZfcmVwZWF0OiB7XG5cdFx0XHRpZGVudGlmaWVyOiAnbnVtYmVyX29mX3JlcGVhdCcsXG5cdFx0XHRydWxlczogW1xuXHRcdFx0XHR7XG5cdFx0XHRcdFx0dHlwZTogJ2ludGVnZXJbMC4uOTldJyxcblx0XHRcdFx0XHRwcm9tcHQ6IGdsb2JhbFRyYW5zbGF0ZS5pdl9WYWxpZGF0ZVJlcGVhdE51bWJlck91dE9mUmFuZ2UsXG5cdFx0XHRcdH0sXG5cdFx0XHRdLFxuXHRcdH0sXG5cdH0sXG5cblx0aW5pdGlhbGl6ZSgpIHtcblx0XHRFeHRlbnNpb25zLmluaXRpYWxpemUoKTtcblx0XHRpdnJNZW51LiRkcm9wRG93bnMuZHJvcGRvd24oKTtcblxuXHRcdC8vINCU0LjQvdCw0LzQuNGH0LXRgdC60LDRjyDQv9GA0L7QstC+0LLQtdGA0LrQsCDRgdCy0L7QsdC+0LTQtdC9INC70Lgg0LLRi9Cx0YDQsNC90L3Ri9C5INC90L7QvNC10YBcblx0XHRpdnJNZW51LiRudW1iZXIub24oJ2NoYW5nZScsICgpID0+IHtcblx0XHRcdGNvbnN0IG5ld051bWJlciA9IGl2ck1lbnUuJGZvcm1PYmouZm9ybSgnZ2V0IHZhbHVlJywgJ2V4dGVuc2lvbicpO1xuXHRcdFx0RXh0ZW5zaW9ucy5jaGVja0F2YWlsYWJpbGl0eShpdnJNZW51LmRlZmF1bHROdW1iZXIsIG5ld051bWJlcik7XG5cdFx0fSk7XG5cblx0XHQkKCcjYWRkLW5ldy1pdnItYWN0aW9uJykub24oJ2NsaWNrJywgKGVsKSA9PiB7XG5cdFx0XHRpdnJNZW51LmFkZE5ld0FjdGlvblJvdygpO1xuXHRcdFx0aXZyTWVudS5yZWJ1aWxkQWN0aW9uRXh0ZW5zaW9uc0Ryb3Bkb3duKCk7XG5cdFx0XHRpdnJNZW51LiRkaXJydHlGaWVsZC52YWwoTWF0aC5yYW5kb20oKSk7XG5cdFx0XHRpdnJNZW51LiRkaXJydHlGaWVsZC50cmlnZ2VyKCdjaGFuZ2UnKTtcblx0XHRcdGVsLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0fSk7XG5cdFx0aXZyTWVudS5pbml0aWFsaXplRm9ybSgpO1xuXG5cdFx0aXZyTWVudS5idWlsZEl2ck1lbnVBY3Rpb25zKCk7XG5cblx0XHRpdnJNZW51LmRlZmF1bHRFeHRlbnNpb24gPSBpdnJNZW51LiRmb3JtT2JqLmZvcm0oJ2dldCB2YWx1ZScsICdleHRlbnNpb24nKTtcblx0fSxcblx0LyoqXG5cdCAqIENyZWF0ZSBpdnIgbWVudSBpdGVtcyBvbiB0aGUgZm9ybVxuXHQgKi9cblx0YnVpbGRJdnJNZW51QWN0aW9ucygpIHtcblx0XHRjb25zdCBvYmpBY3Rpb25zID0gSlNPTi5wYXJzZShpdnJBY3Rpb25zKTtcblx0XHRvYmpBY3Rpb25zLmZvckVhY2goKGVsZW1lbnQpID0+IHtcblx0XHRcdGl2ck1lbnUuYWRkTmV3QWN0aW9uUm93KGVsZW1lbnQpO1xuXHRcdH0pO1xuXHRcdGlmIChvYmpBY3Rpb25zLmxlbmd0aCA9PT0gMCkgaXZyTWVudS5hZGROZXdBY3Rpb25Sb3coKTtcblxuXHRcdGl2ck1lbnUucmVidWlsZEFjdGlvbkV4dGVuc2lvbnNEcm9wZG93bigpO1xuXHR9LFxuXHRhZGROZXdGb3JtUnVsZXMobmV3Um93SWQpIHtcblx0XHRjb25zdCAkZGlnaXRzQ2xhc3MgPSBgZGlnaXRzLSR7bmV3Um93SWR9YDtcblx0XHRpdnJNZW51LnZhbGlkYXRlUnVsZXNbJGRpZ2l0c0NsYXNzXSA9IHtcblx0XHRcdGlkZW50aWZpZXI6ICRkaWdpdHNDbGFzcyxcblx0XHRcdHJ1bGVzOiBbXG5cdFx0XHRcdHtcblx0XHRcdFx0XHR0eXBlOiAncmVnRXhwWy9eWzAtOV17MSw3fSQvXScsXG5cdFx0XHRcdFx0cHJvbXB0OiBnbG9iYWxUcmFuc2xhdGUuaXZfVmFsaWRhdGVEaWdpdHNJc05vdENvcnJlY3QsXG5cdFx0XHRcdH0sXG5cdFx0XHRcdHtcblx0XHRcdFx0XHR0eXBlOiAnY2hlY2tEb3VibGVzRGlnaXRzJyxcblx0XHRcdFx0XHRwcm9tcHQ6IGdsb2JhbFRyYW5zbGF0ZS5pdl9WYWxpZGF0ZURpZ2l0c0lzTm90Q29ycmVjdCxcblx0XHRcdFx0fSxcblx0XHRcdF0sXG5cblx0XHR9O1xuXHRcdGNvbnN0ICRleHRlbnNpb25DbGFzcyA9IGBleHRlbnNpb24tJHtuZXdSb3dJZH1gO1xuXHRcdGl2ck1lbnUudmFsaWRhdGVSdWxlc1skZXh0ZW5zaW9uQ2xhc3NdID0ge1xuXHRcdFx0aWRlbnRpZmllcjogJGV4dGVuc2lvbkNsYXNzLFxuXHRcdFx0cnVsZXM6IFtcblx0XHRcdFx0e1xuXHRcdFx0XHRcdHR5cGU6ICdlbXB0eScsXG5cdFx0XHRcdFx0cHJvbXB0OiBnbG9iYWxUcmFuc2xhdGUuaXZfVmFsaWRhdGVFeHRlbnNpb25Jc05vdENvcnJlY3QsXG5cdFx0XHRcdH0sXG5cdFx0XHRdLFxuXG5cdFx0fTtcblx0fSxcblx0YWRkTmV3QWN0aW9uUm93KHBhcmFtT2JqKSB7XG5cdFx0bGV0IHBhcmFtID0ge1xuXHRcdFx0aWQ6ICcnLFxuXHRcdFx0ZXh0ZW5zaW9uOiAnJyxcblx0XHRcdGV4dGVuc2lvblJlcHJlc2VudDogJycsXG5cdFx0XHRkaWdpdHM6ICcnLFxuXHRcdH07XG5cdFx0aWYgKHBhcmFtT2JqICE9PSB1bmRlZmluZWQpIHtcblx0XHRcdHBhcmFtID0gcGFyYW1PYmo7XG5cdFx0fVxuXHRcdGl2ck1lbnUuYWN0aW9uc1Jvd3NDb3VudCArPSAxO1xuXHRcdGNvbnN0ICRhY3Rpb25UZW1wbGF0ZSA9IGl2ck1lbnUuJHJvd1RlbXBsYXRlLmNsb25lKCk7XG5cdFx0JGFjdGlvblRlbXBsYXRlXG5cdFx0XHQucmVtb3ZlQ2xhc3MoJ2hpZGRlbicpXG5cdFx0XHQuYXR0cignaWQnLCBgcm93LSR7aXZyTWVudS5hY3Rpb25zUm93c0NvdW50fWApXG5cdFx0XHQuYXR0cignZGF0YS12YWx1ZScsIGl2ck1lbnUuYWN0aW9uc1Jvd3NDb3VudClcblx0XHRcdC5hdHRyKCdzdHlsZScsICcnKTtcblxuXHRcdCRhY3Rpb25UZW1wbGF0ZS5maW5kKCdpbnB1dFtuYW1lPVwiZGlnaXRzLWlkXCJdJylcblx0XHRcdC5hdHRyKCdpZCcsIGBkaWdpdHMtJHtpdnJNZW51LmFjdGlvbnNSb3dzQ291bnR9YClcblx0XHRcdC5hdHRyKCduYW1lJywgYGRpZ2l0cy0ke2l2ck1lbnUuYWN0aW9uc1Jvd3NDb3VudH1gKVxuXHRcdFx0LmF0dHIoJ3ZhbHVlJywgcGFyYW0uZGlnaXRzKTtcblxuXHRcdCRhY3Rpb25UZW1wbGF0ZS5maW5kKCdpbnB1dFtuYW1lPVwiZXh0ZW5zaW9uLWlkXCJdJylcblx0XHRcdC5hdHRyKCdpZCcsIGBleHRlbnNpb24tJHtpdnJNZW51LmFjdGlvbnNSb3dzQ291bnR9YClcblx0XHRcdC5hdHRyKCduYW1lJywgYGV4dGVuc2lvbi0ke2l2ck1lbnUuYWN0aW9uc1Jvd3NDb3VudH1gKVxuXHRcdFx0LmF0dHIoJ3ZhbHVlJywgcGFyYW0uZXh0ZW5zaW9uKTtcblx0XHQkYWN0aW9uVGVtcGxhdGUuZmluZCgnZGl2LmRlbGV0ZS1hY3Rpb24tcm93Jylcblx0XHRcdC5hdHRyKCdkYXRhLXZhbHVlJywgaXZyTWVudS5hY3Rpb25zUm93c0NvdW50KTtcblxuXHRcdGlmIChwYXJhbS5leHRlbnNpb25SZXByZXNlbnQubGVuZ3RoID4gMCkge1xuXHRcdFx0JGFjdGlvblRlbXBsYXRlLmZpbmQoJ2Rpdi5kZWZhdWx0LnRleHQnKS5yZW1vdmVDbGFzcygnZGVmYXVsdCcpLmh0bWwocGFyYW0uZXh0ZW5zaW9uUmVwcmVzZW50KTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0JGFjdGlvblRlbXBsYXRlLmZpbmQoJ2Rpdi5kZWZhdWx0LnRleHQnKS5odG1sKGdsb2JhbFRyYW5zbGF0ZS5leF9TZWxlY3ROdW1iZXIpO1xuXHRcdH1cblxuXHRcdCQoJyNhY3Rpb25zLXBsYWNlJykuYXBwZW5kKCRhY3Rpb25UZW1wbGF0ZSk7XG5cdFx0aXZyTWVudS5hZGROZXdGb3JtUnVsZXMoaXZyTWVudS5hY3Rpb25zUm93c0NvdW50KTtcblx0fSxcblx0cmVidWlsZEFjdGlvbkV4dGVuc2lvbnNEcm9wZG93bigpIHtcblx0XHQkKCcjaXZyLW1lbnUtZm9ybSAuZm9yd2FyZGluZy1zZWxlY3QnKS5kcm9wZG93bihFeHRlbnNpb25zLmdldERyb3Bkb3duU2V0dGluZ3NXaXRob3V0RW1wdHkoaXZyTWVudS5jYk9uRXh0ZW5zaW9uU2VsZWN0KSk7XG5cdFx0RXh0ZW5zaW9ucy5maXhCdWdEcm9wZG93bkljb24oKTtcblx0XHQkKCcuZGVsZXRlLWFjdGlvbi1yb3cnKS5vbignY2xpY2snLCBmdW5jdGlvbiAoZSkge1xuXHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0Y29uc3QgaWQgPSAkKHRoaXMpLmF0dHIoJ2RhdGEtdmFsdWUnKTtcblx0XHRcdGRlbGV0ZSBpdnJNZW51LnZhbGlkYXRlUnVsZXNbYGRpZ2l0cy0ke2lkfWBdO1xuXHRcdFx0ZGVsZXRlIGl2ck1lbnUudmFsaWRhdGVSdWxlc1tgZXh0ZW5zaW9uLSR7aWR9YF07XG5cdFx0XHQkKGAjcm93LSR7aWR9YCkucmVtb3ZlKCk7XG5cdFx0XHRpdnJNZW51LiRkaXJydHlGaWVsZC52YWwoTWF0aC5yYW5kb20oKSk7XG5cdFx0XHRpdnJNZW51LiRkaXJydHlGaWVsZC50cmlnZ2VyKCdjaGFuZ2UnKTtcblx0XHR9KTtcblx0fSxcblx0Y2JCZWZvcmVTZW5kRm9ybShzZXR0aW5ncykge1xuXHRcdGxldCByZXN1bHQgPSBzZXR0aW5ncztcblxuXHRcdHJlc3VsdC5kYXRhID0gaXZyTWVudS4kZm9ybU9iai5mb3JtKCdnZXQgdmFsdWVzJyk7XG5cdFx0Y29uc3QgYXJyQWN0aW9ucyA9IFtdO1xuXG5cdFx0JCgnLmFjdGlvbi1yb3cnKS5lYWNoKChpbmRleCwgb2JqKSA9PiB7XG5cdFx0XHRjb25zdCByb3dJZCA9ICQob2JqKS5hdHRyKCdkYXRhLXZhbHVlJyk7XG5cdFx0XHRpZiAocm93SWQgPiAwKSB7XG5cdFx0XHRcdGFyckFjdGlvbnMucHVzaCh7XG5cdFx0XHRcdFx0ZGlnaXRzOiBpdnJNZW51LiRmb3JtT2JqLmZvcm0oJ2dldCB2YWx1ZScsIGBkaWdpdHMtJHtyb3dJZH1gKSxcblx0XHRcdFx0XHRleHRlbnNpb246IGl2ck1lbnUuJGZvcm1PYmouZm9ybSgnZ2V0IHZhbHVlJywgYGV4dGVuc2lvbi0ke3Jvd0lkfWApLFxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHR9KTtcblx0XHRpZiAoYXJyQWN0aW9ucy5sZW5ndGggPT09IDApIHtcblx0XHRcdHJlc3VsdCA9IGZhbHNlO1xuXHRcdFx0aXZyTWVudS4kZXJyb3JNZXNzYWdlcy5odG1sKGdsb2JhbFRyYW5zbGF0ZS5pdl9WYWxpZGF0ZU5vSVZSRXh0ZW5zaW9ucyk7XG5cdFx0XHRpdnJNZW51LiRmb3JtT2JqLmFkZENsYXNzKCdlcnJvcicpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXN1bHQuZGF0YS5hY3Rpb25zID0gSlNPTi5zdHJpbmdpZnkoYXJyQWN0aW9ucyk7XG5cdFx0fVxuXHRcdHJldHVybiByZXN1bHQ7XG5cdH0sXG5cdC8qKlxuXHQgKiDQodGA0LDQsdCw0YLRi9Cy0LDQtdGCINC/0YDQuCDQstGL0LHQvtGA0LUg0L3QvtC80LXRgNCwINC40Lcg0LLRi9C/0LDQtNCw0Y7RidC10LPQviDRgdC/0LjRgdC60LBcblx0ICovXG5cdGNiT25FeHRlbnNpb25TZWxlY3QoKSB7XG5cdFx0aXZyTWVudS4kZGlycnR5RmllbGQudmFsKE1hdGgucmFuZG9tKCkpO1xuXHRcdGl2ck1lbnUuJGRpcnJ0eUZpZWxkLnRyaWdnZXIoJ2NoYW5nZScpO1xuXHR9LFxuXHRjYkFmdGVyU2VuZEZvcm0oKSB7XG5cblx0fSxcblx0aW5pdGlhbGl6ZUZvcm0oKSB7XG5cdFx0Rm9ybS4kZm9ybU9iaiA9IGl2ck1lbnUuJGZvcm1PYmo7XG5cdFx0Rm9ybS51cmwgPSBgJHtnbG9iYWxSb290VXJsfWl2ci1tZW51L3NhdmVgO1xuXHRcdEZvcm0udmFsaWRhdGVSdWxlcyA9IGl2ck1lbnUudmFsaWRhdGVSdWxlcztcblx0XHRGb3JtLmNiQmVmb3JlU2VuZEZvcm0gPSBpdnJNZW51LmNiQmVmb3JlU2VuZEZvcm07XG5cdFx0Rm9ybS5jYkFmdGVyU2VuZEZvcm0gPSBpdnJNZW51LmNiQWZ0ZXJTZW5kRm9ybTtcblx0XHRGb3JtLmluaXRpYWxpemUoKTtcblx0fSxcbn07XG5cbiQuZm4uZm9ybS5zZXR0aW5ncy5ydWxlcy5jaGVja0RvdWJsZXNEaWdpdHMgPSAodmFsdWUpID0+IHtcblx0bGV0IGNvdW50ID0gMDtcblx0JChcImlucHV0W2lkXj0nZGlnaXRzJ11cIikuZWFjaCgoaW5kZXgsIG9iaikgPT4ge1xuXHRcdGlmIChpdnJNZW51LiRmb3JtT2JqLmZvcm0oJ2dldCB2YWx1ZScsIGAke29iai5pZH1gKSA9PT0gdmFsdWUpIGNvdW50ICs9IDE7XG5cdH0pO1xuXG5cdHJldHVybiAoY291bnQgPT09IDEpO1xufTtcblxuJChkb2N1bWVudCkucmVhZHkoKCkgPT4ge1xuXHRpdnJNZW51LmluaXRpYWxpemUoKTtcbn0pO1xuXG4iXX0=