"use strict";

/*
 * Copyright (C) MIKO LLC - All Rights Reserved
 * Unauthorized copying of this file, via any medium is strictly prohibited
 * Proprietary and confidential
 * Written by Nikolay Beketov, 12 2019
 *
 */

/* global globalRootUrl,globalTranslate, ace, Form, Extensions */
// Проверка нет ли ошибки занятого другой учеткой номера
$.fn.form.settings.rules.existRule = function (value, parameter) {
  return $("#".concat(parameter)).hasClass('hidden');
};

var dialplanApplication = {
  $number: $('#extension'),
  defaultExtension: '',
  $formObj: $('#dialplan-application-form'),
  $typeSelectDropDown: $('#dialplan-application-form .type-select'),
  $dirrtyField: $('#dirrty'),
  $tabMenuItems: $('#application-code-menu .item'),
  editor: '',
  validateRules: {
    name: {
      identifier: 'name',
      rules: [{
        type: 'empty',
        prompt: globalTranslate.da_ValidateNameIsEmpty
      }]
    },
    extension: {
      identifier: 'extension',
      rules: [{
        type: 'empty',
        prompt: globalTranslate.da_ValidateExtensionIsEmpty
      }, {
        type: 'existRule[extension-error]',
        prompt: globalTranslate.da_ValidateExtensionDouble
      }]
    }
  },
  initialize: function () {
    function initialize() {
      dialplanApplication.$tabMenuItems.tab();

      if (dialplanApplication.$formObj.form('get value', 'name').length === 0) {
        dialplanApplication.$tabMenuItems.tab('change tab', 'main');
      }

      dialplanApplication.$typeSelectDropDown.dropdown({
        onChange: dialplanApplication.changeAceMode
      }); // Динамическая проверка свободен ли внутренний номер

      dialplanApplication.$number.on('change', function () {
        var newNumber = dialplanApplication.$formObj.form('get value', 'extension');
        Extensions.checkAvailability(dialplanApplication.defaultExtension, newNumber);
      });
      dialplanApplication.initializeAce();
      dialplanApplication.initializeForm();
      dialplanApplication.changeAceMode();
      dialplanApplication.defaultExtension = dialplanApplication.$formObj.form('get value', 'extension');
    }

    return initialize;
  }(),
  initializeAce: function () {
    function initializeAce() {
      dialplanApplication.editor = ace.edit('application-code');
      dialplanApplication.editor.setTheme('ace/theme/monokai');
      dialplanApplication.editor.resize();
      dialplanApplication.editor.getSession().on('change', function () {
        dialplanApplication.$dirrtyField.val(Math.random());
        dialplanApplication.$dirrtyField.trigger('change');
      });
    }

    return initializeAce;
  }(),
  changeAceMode: function () {
    function changeAceMode() {
      var mode = dialplanApplication.$formObj.form('get value', 'type');
      var NewMode;

      if (mode === 'php') {
        NewMode = ace.require('ace/mode/php').Mode;
      } else {
        NewMode = ace.require('ace/mode/julia').Mode;
      }

      dialplanApplication.editor.session.setMode(new NewMode());
      dialplanApplication.editor.setTheme('ace/theme/monokai');
    }

    return changeAceMode;
  }(),
  cbBeforeSendForm: function () {
    function cbBeforeSendForm(settings) {
      var result = settings;
      result.data = dialplanApplication.$formObj.form('get values');
      result.data.applicationlogic = dialplanApplication.editor.getValue();
      return result;
    }

    return cbBeforeSendForm;
  }(),
  cbAfterSendForm: function () {
    function cbAfterSendForm() {}

    return cbAfterSendForm;
  }(),
  initializeForm: function () {
    function initializeForm() {
      Form.$formObj = dialplanApplication.$formObj;
      Form.url = "".concat(globalRootUrl, "dialplan-applications/save");
      Form.validateRules = dialplanApplication.validateRules;
      Form.cbBeforeSendForm = dialplanApplication.cbBeforeSendForm;
      Form.cbAfterSendForm = dialplanApplication.cbAfterSendForm;
      Form.initialize();
    }

    return initializeForm;
  }()
};
$(document).ready(function () {
  dialplanApplication.initialize();
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9EaWFscGxhbkFwcGxpY2F0aW9ucy9kaWFscGxhbi1hcHBsaWNhdGlvbnMtbW9kaWZ5LmpzIl0sIm5hbWVzIjpbIiQiLCJmbiIsImZvcm0iLCJzZXR0aW5ncyIsInJ1bGVzIiwiZXhpc3RSdWxlIiwidmFsdWUiLCJwYXJhbWV0ZXIiLCJoYXNDbGFzcyIsImRpYWxwbGFuQXBwbGljYXRpb24iLCIkbnVtYmVyIiwiZGVmYXVsdEV4dGVuc2lvbiIsIiRmb3JtT2JqIiwiJHR5cGVTZWxlY3REcm9wRG93biIsIiRkaXJydHlGaWVsZCIsIiR0YWJNZW51SXRlbXMiLCJlZGl0b3IiLCJ2YWxpZGF0ZVJ1bGVzIiwibmFtZSIsImlkZW50aWZpZXIiLCJ0eXBlIiwicHJvbXB0IiwiZ2xvYmFsVHJhbnNsYXRlIiwiZGFfVmFsaWRhdGVOYW1lSXNFbXB0eSIsImV4dGVuc2lvbiIsImRhX1ZhbGlkYXRlRXh0ZW5zaW9uSXNFbXB0eSIsImRhX1ZhbGlkYXRlRXh0ZW5zaW9uRG91YmxlIiwiaW5pdGlhbGl6ZSIsInRhYiIsImxlbmd0aCIsImRyb3Bkb3duIiwib25DaGFuZ2UiLCJjaGFuZ2VBY2VNb2RlIiwib24iLCJuZXdOdW1iZXIiLCJFeHRlbnNpb25zIiwiY2hlY2tBdmFpbGFiaWxpdHkiLCJpbml0aWFsaXplQWNlIiwiaW5pdGlhbGl6ZUZvcm0iLCJhY2UiLCJlZGl0Iiwic2V0VGhlbWUiLCJyZXNpemUiLCJnZXRTZXNzaW9uIiwidmFsIiwiTWF0aCIsInJhbmRvbSIsInRyaWdnZXIiLCJtb2RlIiwiTmV3TW9kZSIsInJlcXVpcmUiLCJNb2RlIiwic2Vzc2lvbiIsInNldE1vZGUiLCJjYkJlZm9yZVNlbmRGb3JtIiwicmVzdWx0IiwiZGF0YSIsImFwcGxpY2F0aW9ubG9naWMiLCJnZXRWYWx1ZSIsImNiQWZ0ZXJTZW5kRm9ybSIsIkZvcm0iLCJ1cmwiLCJnbG9iYWxSb290VXJsIiwiZG9jdW1lbnQiLCJyZWFkeSJdLCJtYXBwaW5ncyI6Ijs7QUFBQTs7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QjtBQUFBLDhCQXVFVm5ELFFBdkVVLEVBdUVBO0FBQzFCLFVBQU1vRCxNQUFNLEdBQUdwRCxRQUFmO0FBQ0FvRCxNQUFBQSxNQUFNLENBQUNDLElBQVAsR0FBYy9DLG1CQUFtQixDQUFDRyxRQUFwQixDQUE2QlYsSUFBN0IsQ0FBa0MsWUFBbEMsQ0FBZDtBQUNBcUQsTUFBQUEsTUFBTSxDQUFDQyxJQUFQLENBQVlDLGdCQUFaLEdBQStCaEQsbUJBQW1CLENBQUNPLE1BQXBCLENBQTJCMEMsUUFBM0IsRUFBL0I7QUFDQSxhQUFPSCxNQUFQO0FBQ0E7O0FBNUUwQjtBQUFBO0FBNkUzQkksRUFBQUEsZUE3RTJCO0FBQUEsK0JBNkVULENBRWpCOztBQS9FMEI7QUFBQTtBQWdGM0JyQixFQUFBQSxjQWhGMkI7QUFBQSw4QkFnRlY7QUFDaEJzQixNQUFBQSxJQUFJLENBQUNoRCxRQUFMLEdBQWdCSCxtQkFBbUIsQ0FBQ0csUUFBcEM7QUFDQWdELE1BQUFBLElBQUksQ0FBQ0MsR0FBTCxhQUFjQyxhQUFkO0FBQ0FGLE1BQUFBLElBQUksQ0FBQzNDLGFBQUwsR0FBcUJSLG1CQUFtQixDQUFDUSxhQUF6QztBQUNBMkMsTUFBQUEsSUFBSSxDQUFDTixnQkFBTCxHQUF3QjdDLG1CQUFtQixDQUFDNkMsZ0JBQTVDO0FBQ0FNLE1BQUFBLElBQUksQ0FBQ0QsZUFBTCxHQUF1QmxELG1CQUFtQixDQUFDa0QsZUFBM0M7QUFDQUMsTUFBQUEsSUFBSSxDQUFDakMsVUFBTDtBQUNBOztBQXZGMEI7QUFBQTtBQUFBLENBQTVCO0FBMEZBM0IsQ0FBQyxDQUFDK0QsUUFBRCxDQUFELENBQVlDLEtBQVosQ0FBa0IsWUFBTTtBQUN2QnZELEVBQUFBLG1CQUFtQixDQUFDa0IsVUFBcEI7QUFDQSxDQUZEIiwic291cmNlc0NvbnRlbnQiOlsiLypcbiAqIENvcHlyaWdodCAoQykgTUlLTyBMTEMgLSBBbGwgUmlnaHRzIFJlc2VydmVkXG4gKiBVbmF1dGhvcml6ZWQgY29weWluZyBvZiB0aGlzIGZpbGUsIHZpYSBhbnkgbWVkaXVtIGlzIHN0cmljdGx5IHByb2hpYml0ZWRcbiAqIFByb3ByaWV0YXJ5IGFuZCBjb25maWRlbnRpYWxcbiAqIFdyaXR0ZW4gYnkgTmlrb2xheSBCZWtldG92LCAxMiAyMDE5XG4gKlxuICovXG5cbi8qIGdsb2JhbCBnbG9iYWxSb290VXJsLGdsb2JhbFRyYW5zbGF0ZSwgYWNlLCBGb3JtLCBFeHRlbnNpb25zICovXG5cbi8vINCf0YDQvtCy0LXRgNC60LAg0L3QtdGCINC70Lgg0L7RiNC40LHQutC4INC30LDQvdGP0YLQvtCz0L4g0LTRgNGD0LPQvtC5INGD0YfQtdGC0LrQvtC5INC90L7QvNC10YDQsFxuJC5mbi5mb3JtLnNldHRpbmdzLnJ1bGVzLmV4aXN0UnVsZSA9ICh2YWx1ZSwgcGFyYW1ldGVyKSA9PiAkKGAjJHtwYXJhbWV0ZXJ9YCkuaGFzQ2xhc3MoJ2hpZGRlbicpO1xuXG5jb25zdCBkaWFscGxhbkFwcGxpY2F0aW9uID0ge1xuXHQkbnVtYmVyOiAkKCcjZXh0ZW5zaW9uJyksXG5cdGRlZmF1bHRFeHRlbnNpb246ICcnLFxuXHQkZm9ybU9iajogJCgnI2RpYWxwbGFuLWFwcGxpY2F0aW9uLWZvcm0nKSxcblx0JHR5cGVTZWxlY3REcm9wRG93bjogJCgnI2RpYWxwbGFuLWFwcGxpY2F0aW9uLWZvcm0gLnR5cGUtc2VsZWN0JyksXG5cdCRkaXJydHlGaWVsZDogJCgnI2RpcnJ0eScpLFxuXHQkdGFiTWVudUl0ZW1zOiAkKCcjYXBwbGljYXRpb24tY29kZS1tZW51IC5pdGVtJyksXG5cdGVkaXRvcjogJycsXG5cdHZhbGlkYXRlUnVsZXM6IHtcblx0XHRuYW1lOiB7XG5cdFx0XHRpZGVudGlmaWVyOiAnbmFtZScsXG5cdFx0XHRydWxlczogW1xuXHRcdFx0XHR7XG5cdFx0XHRcdFx0dHlwZTogJ2VtcHR5Jyxcblx0XHRcdFx0XHRwcm9tcHQ6IGdsb2JhbFRyYW5zbGF0ZS5kYV9WYWxpZGF0ZU5hbWVJc0VtcHR5LFxuXHRcdFx0XHR9LFxuXHRcdFx0XSxcblx0XHR9LFxuXHRcdGV4dGVuc2lvbjoge1xuXHRcdFx0aWRlbnRpZmllcjogJ2V4dGVuc2lvbicsXG5cdFx0XHRydWxlczogW1xuXHRcdFx0XHR7XG5cdFx0XHRcdFx0dHlwZTogJ2VtcHR5Jyxcblx0XHRcdFx0XHRwcm9tcHQ6IGdsb2JhbFRyYW5zbGF0ZS5kYV9WYWxpZGF0ZUV4dGVuc2lvbklzRW1wdHksXG5cdFx0XHRcdH0sXG5cdFx0XHRcdHtcblx0XHRcdFx0XHR0eXBlOiAnZXhpc3RSdWxlW2V4dGVuc2lvbi1lcnJvcl0nLFxuXHRcdFx0XHRcdHByb21wdDogZ2xvYmFsVHJhbnNsYXRlLmRhX1ZhbGlkYXRlRXh0ZW5zaW9uRG91YmxlLFxuXHRcdFx0XHR9LFxuXHRcdFx0XSxcblx0XHR9LFxuXHR9LFxuXHRpbml0aWFsaXplKCkge1xuXHRcdGRpYWxwbGFuQXBwbGljYXRpb24uJHRhYk1lbnVJdGVtcy50YWIoKTtcblx0XHRpZiAoZGlhbHBsYW5BcHBsaWNhdGlvbi4kZm9ybU9iai5mb3JtKCdnZXQgdmFsdWUnLCAnbmFtZScpLmxlbmd0aCA9PT0gMCkge1xuXHRcdFx0ZGlhbHBsYW5BcHBsaWNhdGlvbi4kdGFiTWVudUl0ZW1zLnRhYignY2hhbmdlIHRhYicsICdtYWluJyk7XG5cdFx0fVxuXHRcdGRpYWxwbGFuQXBwbGljYXRpb24uJHR5cGVTZWxlY3REcm9wRG93bi5kcm9wZG93bih7XG5cdFx0XHRvbkNoYW5nZTogZGlhbHBsYW5BcHBsaWNhdGlvbi5jaGFuZ2VBY2VNb2RlLFxuXHRcdH0pO1xuXHRcdC8vINCU0LjQvdCw0LzQuNGH0LXRgdC60LDRjyDQv9GA0L7QstC10YDQutCwINGB0LLQvtCx0L7QtNC10L0g0LvQuCDQstC90YPRgtGA0LXQvdC90LjQuSDQvdC+0LzQtdGAXG5cdFx0ZGlhbHBsYW5BcHBsaWNhdGlvbi4kbnVtYmVyLm9uKCdjaGFuZ2UnLCAoKSA9PiB7XG5cdFx0XHRjb25zdCBuZXdOdW1iZXIgPSBkaWFscGxhbkFwcGxpY2F0aW9uLiRmb3JtT2JqLmZvcm0oJ2dldCB2YWx1ZScsICdleHRlbnNpb24nKTtcblx0XHRcdEV4dGVuc2lvbnMuY2hlY2tBdmFpbGFiaWxpdHkoZGlhbHBsYW5BcHBsaWNhdGlvbi5kZWZhdWx0RXh0ZW5zaW9uLCBuZXdOdW1iZXIpO1xuXHRcdH0pO1xuXG5cdFx0ZGlhbHBsYW5BcHBsaWNhdGlvbi5pbml0aWFsaXplQWNlKCk7XG5cdFx0ZGlhbHBsYW5BcHBsaWNhdGlvbi5pbml0aWFsaXplRm9ybSgpO1xuXHRcdGRpYWxwbGFuQXBwbGljYXRpb24uY2hhbmdlQWNlTW9kZSgpO1xuXHRcdGRpYWxwbGFuQXBwbGljYXRpb24uZGVmYXVsdEV4dGVuc2lvbiA9IGRpYWxwbGFuQXBwbGljYXRpb24uJGZvcm1PYmouZm9ybSgnZ2V0IHZhbHVlJywgJ2V4dGVuc2lvbicpO1xuXHR9LFxuXHRpbml0aWFsaXplQWNlKCkge1xuXHRcdGRpYWxwbGFuQXBwbGljYXRpb24uZWRpdG9yID0gYWNlLmVkaXQoJ2FwcGxpY2F0aW9uLWNvZGUnKTtcblx0XHRkaWFscGxhbkFwcGxpY2F0aW9uLmVkaXRvci5zZXRUaGVtZSgnYWNlL3RoZW1lL21vbm9rYWknKTtcblx0XHRkaWFscGxhbkFwcGxpY2F0aW9uLmVkaXRvci5yZXNpemUoKTtcblx0XHRkaWFscGxhbkFwcGxpY2F0aW9uLmVkaXRvci5nZXRTZXNzaW9uKCkub24oJ2NoYW5nZScsICgpID0+IHtcblx0XHRcdGRpYWxwbGFuQXBwbGljYXRpb24uJGRpcnJ0eUZpZWxkLnZhbChNYXRoLnJhbmRvbSgpKTtcblx0XHRcdGRpYWxwbGFuQXBwbGljYXRpb24uJGRpcnJ0eUZpZWxkLnRyaWdnZXIoJ2NoYW5nZScpO1xuXHRcdH0pO1xuXHR9LFxuXHRjaGFuZ2VBY2VNb2RlKCkge1xuXHRcdGNvbnN0IG1vZGUgPSBkaWFscGxhbkFwcGxpY2F0aW9uLiRmb3JtT2JqLmZvcm0oJ2dldCB2YWx1ZScsICd0eXBlJyk7XG5cdFx0bGV0IE5ld01vZGU7XG5cdFx0aWYgKG1vZGUgPT09ICdwaHAnKSB7XG5cdFx0XHROZXdNb2RlID0gYWNlLnJlcXVpcmUoJ2FjZS9tb2RlL3BocCcpLk1vZGU7XG5cdFx0fSBlbHNlIHtcblx0XHRcdE5ld01vZGUgPSBhY2UucmVxdWlyZSgnYWNlL21vZGUvanVsaWEnKS5Nb2RlO1xuXHRcdH1cblx0XHRkaWFscGxhbkFwcGxpY2F0aW9uLmVkaXRvci5zZXNzaW9uLnNldE1vZGUobmV3IE5ld01vZGUoKSk7XG5cdFx0ZGlhbHBsYW5BcHBsaWNhdGlvbi5lZGl0b3Iuc2V0VGhlbWUoJ2FjZS90aGVtZS9tb25va2FpJyk7XG5cdH0sXG5cdGNiQmVmb3JlU2VuZEZvcm0oc2V0dGluZ3MpIHtcblx0XHRjb25zdCByZXN1bHQgPSBzZXR0aW5ncztcblx0XHRyZXN1bHQuZGF0YSA9IGRpYWxwbGFuQXBwbGljYXRpb24uJGZvcm1PYmouZm9ybSgnZ2V0IHZhbHVlcycpO1xuXHRcdHJlc3VsdC5kYXRhLmFwcGxpY2F0aW9ubG9naWMgPSBkaWFscGxhbkFwcGxpY2F0aW9uLmVkaXRvci5nZXRWYWx1ZSgpO1xuXHRcdHJldHVybiByZXN1bHQ7XG5cdH0sXG5cdGNiQWZ0ZXJTZW5kRm9ybSgpIHtcblxuXHR9LFxuXHRpbml0aWFsaXplRm9ybSgpIHtcblx0XHRGb3JtLiRmb3JtT2JqID0gZGlhbHBsYW5BcHBsaWNhdGlvbi4kZm9ybU9iajtcblx0XHRGb3JtLnVybCA9IGAke2dsb2JhbFJvb3RVcmx9ZGlhbHBsYW4tYXBwbGljYXRpb25zL3NhdmVgO1xuXHRcdEZvcm0udmFsaWRhdGVSdWxlcyA9IGRpYWxwbGFuQXBwbGljYXRpb24udmFsaWRhdGVSdWxlcztcblx0XHRGb3JtLmNiQmVmb3JlU2VuZEZvcm0gPSBkaWFscGxhbkFwcGxpY2F0aW9uLmNiQmVmb3JlU2VuZEZvcm07XG5cdFx0Rm9ybS5jYkFmdGVyU2VuZEZvcm0gPSBkaWFscGxhbkFwcGxpY2F0aW9uLmNiQWZ0ZXJTZW5kRm9ybTtcblx0XHRGb3JtLmluaXRpYWxpemUoKTtcblx0fSxcbn07XG5cbiQoZG9jdW1lbnQpLnJlYWR5KCgpID0+IHtcblx0ZGlhbHBsYW5BcHBsaWNhdGlvbi5pbml0aWFsaXplKCk7XG59KTtcblxuIl19