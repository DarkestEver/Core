"use strict";

/*
 * Copyright (C) MIKO LLC - All Rights Reserved
 * Unauthorized copying of this file, via any medium is strictly prohibited
 * Proprietary and confidential
 * Written by Nikolay Beketov, 12 2019
 *
 */

/* global globalRootUrl,globalTranslate, Form, PasswordScore */
var generalSettingsModify = {
  $dirrtyField: $('#dirrty'),
  $formObj: $('#general-settings-form'),
  $webAdminPassword: $('#WebAdminPassword'),
  $sshPassword: $('#SSHPassword'),
  validateRules: {
    pbxname: {
      identifier: 'PBXName',
      rules: [{
        type: 'empty',
        prompt: globalTranslate.gs_ValidateEmptyPBXName
      }]
    },
    WebAdminPassword: {
      identifier: 'WebAdminPassword',
      rules: [{
        type: 'empty',
        prompt: globalTranslate.gs_ValidateEmptyWebPassword
      }, {
        type: 'minLength[5]',
        prompt: globalTranslate.gs_ValidateWeakWebPassword
      }]
    },
    WebAdminPasswordRepeat: {
      identifier: 'WebAdminPasswordRepeat',
      rules: [{
        type: 'match[WebAdminPassword]',
        prompt: globalTranslate.gs_ValidateWebPasswordsFieldDifferent
      }]
    },
    SSHPassword: {
      identifier: 'SSHPassword',
      rules: [{
        type: 'empty',
        prompt: globalTranslate.gs_ValidateEmptySSHPassword
      }, {
        type: 'minLength[5]',
        prompt: globalTranslate.gs_ValidateWeakSSHPassword
      }]
    },
    SSHPasswordRepeat: {
      identifier: 'SSHPasswordRepeat',
      rules: [{
        type: 'match[SSHPassword]',
        prompt: globalTranslate.gs_ValidateSSHPasswordsFieldDifferent
      }]
    }
  },
  initialize: function () {
    function initialize() {
      generalSettingsModify.$webAdminPassword.on('keyup', function () {
        PasswordScore.checkPassStrength({
          pass: generalSettingsModify.$webAdminPassword.val(),
          bar: $('.password-score'),
          section: $('.password-score-section')
        });
      });
      generalSettingsModify.$sshPassword.on('keyup', function () {
        PasswordScore.checkPassStrength({
          pass: generalSettingsModify.$sshPassword.val(),
          bar: $('.ssh-password-score'),
          section: $('.ssh-password-score-section')
        });
      });
      $('#general-settings-menu').find('.item').tab({
        history: true,
        historyType: 'hash'
      });
      $('#general-settings-form .checkbox').checkbox();
      $('#general-settings-form .dropdown').dropdown();
      $('#audio-codecs-table, #video-codecs-table').tableDnD({
        onDrop: function () {
          function onDrop() {
            generalSettingsModify.$dirrtyField.val(Math.random());
            generalSettingsModify.$dirrtyField.trigger('change');
          }

          return onDrop;
        }(),
        onDragClass: 'hoveringRow',
        dragHandle: '.dragHandle'
      });
      generalSettingsModify.initializeForm();
    }

    return initialize;
  }(),
  cbBeforeSendForm: function () {
    function cbBeforeSendForm(settings) {
      var result = settings;
      result.data = generalSettingsModify.$formObj.form('get values');
      var arrCodecs = [];
      $('#audio-codecs-table .codec-row, #video-codecs-table .codec-row').each(function (index, obj) {
        if ($(obj).attr('id')) {
          arrCodecs.push({
            codecId: $(obj).attr('id'),
            disabled: $(obj).find('.checkbox').checkbox('is unchecked'),
            priority: index
          });
        }
      });
      result.data.codecs = JSON.stringify(arrCodecs);
      return result;
    }

    return cbBeforeSendForm;
  }(),
  cbAfterSendForm: function () {
    function cbAfterSendForm() {}

    return cbAfterSendForm;
  }(),
  initializeForm: function () {
    function initializeForm() {
      Form.$formObj = generalSettingsModify.$formObj;
      Form.url = "".concat(globalRootUrl, "general-settings/save");
      Form.validateRules = generalSettingsModify.validateRules;
      Form.cbBeforeSendForm = generalSettingsModify.cbBeforeSendForm;
      Form.cbAfterSendForm = generalSettingsModify.cbAfterSendForm;
      Form.initialize();
    }

    return initializeForm;
  }()
};
$(document).ready(function () {
  generalSettingsModify.initialize();
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9HZW5lcmFsU2V0dGluZ3MvZ2VuZXJhbC1zZXR0aW5ncy1tb2RpZnkuanMiXSwibmFtZXMiOlsiZ2VuZXJhbFNldHRpbmdzTW9kaWZ5IiwiJGRpcnJ0eUZpZWxkIiwiJCIsIiRmb3JtT2JqIiwiJHdlYkFkbWluUGFzc3dvcmQiLCIkc3NoUGFzc3dvcmQiLCJ2YWxpZGF0ZVJ1bGVzIiwicGJ4bmFtZSIsImlkZW50aWZpZXIiLCJydWxlcyIsInR5cGUiLCJwcm9tcHQiLCJnbG9iYWxUcmFuc2xhdGUiLCJnc19WYWxpZGF0ZUVtcHR5UEJYTmFtZSIsIldlYkFkbWluUGFzc3dvcmQiLCJnc19WYWxpZGF0ZUVtcHR5V2ViUGFzc3dvcmQiLCJnc19WYWxpZGF0ZVdlYWtXZWJQYXNzd29yZCIsIldlYkFkbWluUGFzc3dvcmRSZXBlYXQiLCJnc19WYWxpZGF0ZVdlYlBhc3N3b3Jkc0ZpZWxkRGlmZmVyZW50IiwiU1NIUGFzc3dvcmQiLCJnc19WYWxpZGF0ZUVtcHR5U1NIUGFzc3dvcmQiLCJnc19WYWxpZGF0ZVdlYWtTU0hQYXNzd29yZCIsIlNTSFBhc3N3b3JkUmVwZWF0IiwiZ3NfVmFsaWRhdGVTU0hQYXNzd29yZHNGaWVsZERpZmZlcmVudCIsImluaXRpYWxpemUiLCJvbiIsIlBhc3N3b3JkU2NvcmUiLCJjaGVja1Bhc3NTdHJlbmd0aCIsInBhc3MiLCJ2YWwiLCJiYXIiLCJzZWN0aW9uIiwiZmluZCIsInRhYiIsImhpc3RvcnkiLCJoaXN0b3J5VHlwZSIsImNoZWNrYm94IiwiZHJvcGRvd24iLCJ0YWJsZURuRCIsIm9uRHJvcCIsIk1hdGgiLCJyYW5kb20iLCJ0cmlnZ2VyIiwib25EcmFnQ2xhc3MiLCJkcmFnSGFuZGxlIiwiaW5pdGlhbGl6ZUZvcm0iLCJjYkJlZm9yZVNlbmRGb3JtIiwic2V0dGluZ3MiLCJyZXN1bHQiLCJkYXRhIiwiZm9ybSIsImFyckNvZGVjcyIsImVhY2giLCJpbmRleCIsIm9iaiIsImF0dHIiLCJwdXNoIiwiY29kZWNJZCIsImRpc2FibGVkIiwicHJpb3JpdHkiLCJjb2RlY3MiLCJKU09OIiwic3RyaW5naWZ5IiwiY2JBZnRlclNlbmRGb3JtIiwiRm9ybSIsInVybCIsImdsb2JhbFJvb3RVcmwiLCJkb2N1bWVudCIsInJlYWR5Il0sIm1hcHBpbmdzIjoiOztBQUFBOzs7Ozs7OztBQVNBO0FBRUEsSUFBTUEscUJBQXFCLEdBQUc7QUFDN0JDLEVBQUFBLFlBQVksRUFBRUMsQ0FBQyxDQUFDLFNBQUQsQ0FEYztBQUU3QkMsRUFBQUEsUUFBUSxFQUFFRCxDQUFDLENBQUMsd0JBQUQsQ0FGa0I7QUFHN0JFLEVBQUFBLGlCQUFpQixFQUFFRixDQUFDLENBQUMsbUJBQUQsQ0FIUztBQUk3QkcsRUFBQUEsWUFBWSxFQUFFSCxDQUFDLENBQUMsY0FBRCxDQUpjO0FBSzdCSSxFQUFBQSxhQUFhLEVBQUU7QUFDZEMsSUFBQUEsT0FBTyxFQUFFO0FBQ1JDLE1BQUFBLFVBQVUsRUFBRSxTQURKO0FBRVJDLE1BQUFBLEtBQUssRUFBRSxDQUNOO0FBQ0NDLFFBQUFBLElBQUksRUFBRSxPQURQO0FBRUNDLFFBQUFBLE1BQU0sRUFBRUMsZUFBZSxDQUFDQztBQUZ6QixPQURNO0FBRkMsS0FESztBQVVkQyxJQUFBQSxnQkFBZ0IsRUFBRTtBQUNqQk4sTUFBQUEsVUFBVSxFQUFFLGtCQURLO0FBRWpCQyxNQUFBQSxLQUFLLEVBQUUsQ0FDTjtBQUNDQyxRQUFBQSxJQUFJLEVBQUUsT0FEUDtBQUVDQyxRQUFBQSxNQUFNLEVBQUVDLGVBQWUsQ0FBQ0c7QUFGekIsT0FETSxFQUtOO0FBQ0NMLFFBQUFBLElBQUksRUFBRSxjQURQO0FBRUNDLFFBQUFBLE1BQU0sRUFBRUMsZUFBZSxDQUFDSTtBQUZ6QixPQUxNO0FBRlUsS0FWSjtBQXVCZEMsSUFBQUEsc0JBQXNCLEVBQUU7QUFDdkJULE1BQUFBLFVBQVUsRUFBRSx3QkFEVztBQUV2QkMsTUFBQUEsS0FBSyxFQUFFLENBQ047QUFDQ0MsUUFBQUEsSUFBSSxFQUFFLHlCQURQO0FBRUNDLFFBQUFBLE1B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QUEsSUFBSSxDQUFDeEMsVUFBTDtBQUNBOztBQXZINEI7QUFBQTtBQUFBLENBQTlCO0FBMEhBdEIsQ0FBQyxDQUFDaUUsUUFBRCxDQUFELENBQVlDLEtBQVosQ0FBa0IsWUFBTTtBQUN2QnBFLEVBQUFBLHFCQUFxQixDQUFDd0IsVUFBdEI7QUFDQSxDQUZEIiwic291cmNlc0NvbnRlbnQiOlsiLypcbiAqIENvcHlyaWdodCAoQykgTUlLTyBMTEMgLSBBbGwgUmlnaHRzIFJlc2VydmVkXG4gKiBVbmF1dGhvcml6ZWQgY29weWluZyBvZiB0aGlzIGZpbGUsIHZpYSBhbnkgbWVkaXVtIGlzIHN0cmljdGx5IHByb2hpYml0ZWRcbiAqIFByb3ByaWV0YXJ5IGFuZCBjb25maWRlbnRpYWxcbiAqIFdyaXR0ZW4gYnkgTmlrb2xheSBCZWtldG92LCAxMiAyMDE5XG4gKlxuICovXG5cblxuLyogZ2xvYmFsIGdsb2JhbFJvb3RVcmwsZ2xvYmFsVHJhbnNsYXRlLCBGb3JtLCBQYXNzd29yZFNjb3JlICovXG5cbmNvbnN0IGdlbmVyYWxTZXR0aW5nc01vZGlmeSA9IHtcblx0JGRpcnJ0eUZpZWxkOiAkKCcjZGlycnR5JyksXG5cdCRmb3JtT2JqOiAkKCcjZ2VuZXJhbC1zZXR0aW5ncy1mb3JtJyksXG5cdCR3ZWJBZG1pblBhc3N3b3JkOiAkKCcjV2ViQWRtaW5QYXNzd29yZCcpLFxuXHQkc3NoUGFzc3dvcmQ6ICQoJyNTU0hQYXNzd29yZCcpLFxuXHR2YWxpZGF0ZVJ1bGVzOiB7XG5cdFx0cGJ4bmFtZToge1xuXHRcdFx0aWRlbnRpZmllcjogJ1BCWE5hbWUnLFxuXHRcdFx0cnVsZXM6IFtcblx0XHRcdFx0e1xuXHRcdFx0XHRcdHR5cGU6ICdlbXB0eScsXG5cdFx0XHRcdFx0cHJvbXB0OiBnbG9iYWxUcmFuc2xhdGUuZ3NfVmFsaWRhdGVFbXB0eVBCWE5hbWUsXG5cdFx0XHRcdH0sXG5cdFx0XHRdLFxuXHRcdH0sXG5cdFx0V2ViQWRtaW5QYXNzd29yZDoge1xuXHRcdFx0aWRlbnRpZmllcjogJ1dlYkFkbWluUGFzc3dvcmQnLFxuXHRcdFx0cnVsZXM6IFtcblx0XHRcdFx0e1xuXHRcdFx0XHRcdHR5cGU6ICdlbXB0eScsXG5cdFx0XHRcdFx0cHJvbXB0OiBnbG9iYWxUcmFuc2xhdGUuZ3NfVmFsaWRhdGVFbXB0eVdlYlBhc3N3b3JkLFxuXHRcdFx0XHR9LFxuXHRcdFx0XHR7XG5cdFx0XHRcdFx0dHlwZTogJ21pbkxlbmd0aFs1XScsXG5cdFx0XHRcdFx0cHJvbXB0OiBnbG9iYWxUcmFuc2xhdGUuZ3NfVmFsaWRhdGVXZWFrV2ViUGFzc3dvcmQsXG5cdFx0XHRcdH0sXG5cdFx0XHRdLFxuXHRcdH0sXG5cdFx0V2ViQWRtaW5QYXNzd29yZFJlcGVhdDoge1xuXHRcdFx0aWRlbnRpZmllcjogJ1dlYkFkbWluUGFzc3dvcmRSZXBlYXQnLFxuXHRcdFx0cnVsZXM6IFtcblx0XHRcdFx0e1xuXHRcdFx0XHRcdHR5cGU6ICdtYXRjaFtXZWJBZG1pblBhc3N3b3JkXScsXG5cdFx0XHRcdFx0cHJvbXB0OiBnbG9iYWxUcmFuc2xhdGUuZ3NfVmFsaWRhdGVXZWJQYXNzd29yZHNGaWVsZERpZmZlcmVudCxcblx0XHRcdFx0fSxcblx0XHRcdF0sXG5cdFx0fSxcblx0XHRTU0hQYXNzd29yZDoge1xuXHRcdFx0aWRlbnRpZmllcjogJ1NTSFBhc3N3b3JkJyxcblx0XHRcdHJ1bGVzOiBbXG5cdFx0XHRcdHtcblx0XHRcdFx0XHR0eXBlOiAnZW1wdHknLFxuXHRcdFx0XHRcdHByb21wdDogZ2xvYmFsVHJhbnNsYXRlLmdzX1ZhbGlkYXRlRW1wdHlTU0hQYXNzd29yZCxcblx0XHRcdFx0fSxcblx0XHRcdFx0e1xuXHRcdFx0XHRcdHR5cGU6ICdtaW5MZW5ndGhbNV0nLFxuXHRcdFx0XHRcdHByb21wdDogZ2xvYmFsVHJhbnNsYXRlLmdzX1ZhbGlkYXRlV2Vha1NTSFBhc3N3b3JkLFxuXHRcdFx0XHR9LFxuXHRcdFx0XSxcblx0XHR9LFxuXHRcdFNTSFBhc3N3b3JkUmVwZWF0OiB7XG5cdFx0XHRpZGVudGlmaWVyOiAnU1NIUGFzc3dvcmRSZXBlYXQnLFxuXHRcdFx0cnVsZXM6IFtcblx0XHRcdFx0e1xuXHRcdFx0XHRcdHR5cGU6ICdtYXRjaFtTU0hQYXNzd29yZF0nLFxuXHRcdFx0XHRcdHByb21wdDogZ2xvYmFsVHJhbnNsYXRlLmdzX1ZhbGlkYXRlU1NIUGFzc3dvcmRzRmllbGREaWZmZXJlbnQsXG5cdFx0XHRcdH0sXG5cdFx0XHRdLFxuXHRcdH0sXG5cdH0sXG5cdGluaXRpYWxpemUoKSB7XG5cdFx0Z2VuZXJhbFNldHRpbmdzTW9kaWZ5LiR3ZWJBZG1pblBhc3N3b3JkLm9uKCdrZXl1cCcsICgpID0+IHtcblx0XHRcdFBhc3N3b3JkU2NvcmUuY2hlY2tQYXNzU3RyZW5ndGgoe1xuXHRcdFx0XHRwYXNzOiBnZW5lcmFsU2V0dGluZ3NNb2RpZnkuJHdlYkFkbWluUGFzc3dvcmQudmFsKCksXG5cdFx0XHRcdGJhcjogJCgnLnBhc3N3b3JkLXNjb3JlJyksXG5cdFx0XHRcdHNlY3Rpb246ICQoJy5wYXNzd29yZC1zY29yZS1zZWN0aW9uJyksXG5cdFx0XHR9KTtcblx0XHR9KTtcblx0XHRnZW5lcmFsU2V0dGluZ3NNb2RpZnkuJHNzaFBhc3N3b3JkLm9uKCdrZXl1cCcsICgpID0+IHtcblx0XHRcdFBhc3N3b3JkU2NvcmUuY2hlY2tQYXNzU3RyZW5ndGgoe1xuXHRcdFx0XHRwYXNzOiBnZW5lcmFsU2V0dGluZ3NNb2RpZnkuJHNzaFBhc3N3b3JkLnZhbCgpLFxuXHRcdFx0XHRiYXI6ICQoJy5zc2gtcGFzc3dvcmQtc2NvcmUnKSxcblx0XHRcdFx0c2VjdGlvbjogJCgnLnNzaC1wYXNzd29yZC1zY29yZS1zZWN0aW9uJyksXG5cdFx0XHR9KTtcblx0XHR9KTtcblx0XHQkKCcjZ2VuZXJhbC1zZXR0aW5ncy1tZW51JykuZmluZCgnLml0ZW0nKS50YWIoe1xuXHRcdFx0aGlzdG9yeTogdHJ1ZSxcblx0XHRcdGhpc3RvcnlUeXBlOiAnaGFzaCcsXG5cdFx0fSk7XG5cdFx0JCgnI2dlbmVyYWwtc2V0dGluZ3MtZm9ybSAuY2hlY2tib3gnKS5jaGVja2JveCgpO1xuXHRcdCQoJyNnZW5lcmFsLXNldHRpbmdzLWZvcm0gLmRyb3Bkb3duJykuZHJvcGRvd24oKTtcblxuXHRcdCQoJyNhdWRpby1jb2RlY3MtdGFibGUsICN2aWRlby1jb2RlY3MtdGFibGUnKS50YWJsZURuRCh7XG5cdFx0XHRvbkRyb3AoKSB7XG5cdFx0XHRcdGdlbmVyYWxTZXR0aW5nc01vZGlmeS4kZGlycnR5RmllbGQudmFsKE1hdGgucmFuZG9tKCkpO1xuXHRcdFx0XHRnZW5lcmFsU2V0dGluZ3NNb2RpZnkuJGRpcnJ0eUZpZWxkLnRyaWdnZXIoJ2NoYW5nZScpO1xuXHRcdFx0fSxcblx0XHRcdG9uRHJhZ0NsYXNzOiAnaG92ZXJpbmdSb3cnLFxuXHRcdFx0ZHJhZ0hhbmRsZTogJy5kcmFnSGFuZGxlJyxcblx0XHR9KTtcblx0XHRnZW5lcmFsU2V0dGluZ3NNb2RpZnkuaW5pdGlhbGl6ZUZvcm0oKTtcblx0fSxcblx0Y2JCZWZvcmVTZW5kRm9ybShzZXR0aW5ncykge1xuXHRcdGNvbnN0IHJlc3VsdCA9IHNldHRpbmdzO1xuXHRcdHJlc3VsdC5kYXRhID0gZ2VuZXJhbFNldHRpbmdzTW9kaWZ5LiRmb3JtT2JqLmZvcm0oJ2dldCB2YWx1ZXMnKTtcblx0XHRjb25zdCBhcnJDb2RlY3MgPSBbXTtcblx0XHQkKCcjYXVkaW8tY29kZWNzLXRhYmxlIC5jb2RlYy1yb3csICN2aWRlby1jb2RlY3MtdGFibGUgLmNvZGVjLXJvdycpLmVhY2goKGluZGV4LCBvYmopID0+IHtcblx0XHRcdGlmICgkKG9iaikuYXR0cignaWQnKSkge1xuXHRcdFx0XHRhcnJDb2RlY3MucHVzaCh7XG5cdFx0XHRcdFx0Y29kZWNJZDogJChvYmopLmF0dHIoJ2lkJyksXG5cdFx0XHRcdFx0ZGlzYWJsZWQ6ICQob2JqKS5maW5kKCcuY2hlY2tib3gnKS5jaGVja2JveCgnaXMgdW5jaGVja2VkJyksXG5cdFx0XHRcdFx0cHJpb3JpdHk6IGluZGV4LFxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHR9KTtcblx0XHRyZXN1bHQuZGF0YS5jb2RlY3MgPSBKU09OLnN0cmluZ2lmeShhcnJDb2RlY3MpO1xuXG5cdFx0cmV0dXJuIHJlc3VsdDtcblx0fSxcblx0Y2JBZnRlclNlbmRGb3JtKCkge1xuXG5cdH0sXG5cdGluaXRpYWxpemVGb3JtKCkge1xuXHRcdEZvcm0uJGZvcm1PYmogPSBnZW5lcmFsU2V0dGluZ3NNb2RpZnkuJGZvcm1PYmo7XG5cdFx0Rm9ybS51cmwgPSBgJHtnbG9iYWxSb290VXJsfWdlbmVyYWwtc2V0dGluZ3Mvc2F2ZWA7XG5cdFx0Rm9ybS52YWxpZGF0ZVJ1bGVzID0gZ2VuZXJhbFNldHRpbmdzTW9kaWZ5LnZhbGlkYXRlUnVsZXM7XG5cdFx0Rm9ybS5jYkJlZm9yZVNlbmRGb3JtID0gZ2VuZXJhbFNldHRpbmdzTW9kaWZ5LmNiQmVmb3JlU2VuZEZvcm07XG5cdFx0Rm9ybS5jYkFmdGVyU2VuZEZvcm0gPSBnZW5lcmFsU2V0dGluZ3NNb2RpZnkuY2JBZnRlclNlbmRGb3JtO1xuXHRcdEZvcm0uaW5pdGlhbGl6ZSgpO1xuXHR9LFxufTtcblxuJChkb2N1bWVudCkucmVhZHkoKCkgPT4ge1xuXHRnZW5lcmFsU2V0dGluZ3NNb2RpZnkuaW5pdGlhbGl6ZSgpO1xufSk7Il19